import { Component, EventEmitter, Output } from '@angular/core';
import { VideoType } from '../../../models/video-type.model';
import * as i0 from "@angular/core";
import * as i1 from "../../../services/openvidu/openvidu.service";
import * as i2 from "../../../services/device/device.service";
import * as i3 from "../../../services/storage/storage.service";
import * as i4 from "../../../services/participant/participant.service";
import * as i5 from "@angular/common";
import * as i6 from "@angular/material/button";
import * as i7 from "@angular/material/icon";
import * as i8 from "@angular/material/form-field";
import * as i9 from "@angular/material/tooltip";
import * as i10 from "@angular/material/select";
import * as i11 from "@angular/material/core";
import * as i12 from "../../../pipes/translate.pipe";
/**
 * @internal
 */
export class AudioDevicesComponent {
    constructor(openviduService, deviceSrv, storageSrv, participantService) {
        this.openviduService = openviduService;
        this.deviceSrv = deviceSrv;
        this.storageSrv = storageSrv;
        this.participantService = participantService;
        this.onDeviceSelectorClicked = new EventEmitter();
        this.onAudioMutedClicked = new EventEmitter();
        this.microphones = [];
    }
    async ngOnInit() {
        this.subscribeToParticipantMediaProperties();
        if (this.openviduService.isSessionConnected()) {
            // Updating devices only with session connected
            await this.deviceSrv.refreshDevices();
        }
        this.hasAudioDevices = this.deviceSrv.hasAudioDeviceAvailable();
        if (this.hasAudioDevices) {
            this.microphones = this.deviceSrv.getMicrophones();
            this.microphoneSelected = this.deviceSrv.getMicrophoneSelected();
        }
        this.isAudioMuted = this.deviceSrv.isAudioMuted();
        if (this.openviduService.isSessionConnected()) {
            this.isAudioMuted = !this.participantService.isMyAudioActive();
        }
        else {
            this.isAudioMuted = this.deviceSrv.isAudioMuted();
        }
    }
    ngOnDestroy() {
        if (this.localParticipantSubscription)
            this.localParticipantSubscription.unsubscribe();
    }
    toggleMic() {
        const publish = this.isAudioMuted;
        this.openviduService.publishAudio(publish);
        this.onAudioMutedClicked.emit(publish);
    }
    async onMicrophoneSelected(event) {
        const audioSource = event?.value;
        if (this.deviceSrv.needUpdateAudioTrack(audioSource)) {
            const pp = { audioSource, videoSource: false };
            await this.openviduService.replaceTrack(VideoType.CAMERA, pp);
            this.deviceSrv.setMicSelected(audioSource);
            this.microphoneSelected = this.deviceSrv.getMicrophoneSelected();
        }
    }
    subscribeToParticipantMediaProperties() {
        this.localParticipantSubscription = this.participantService.localParticipantObs.subscribe((p) => {
            if (p) {
                this.isAudioMuted = !p.hasAudioActive();
                this.storageSrv.setAudioMuted(this.isAudioMuted);
            }
        });
    }
}
AudioDevicesComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: AudioDevicesComponent, deps: [{ token: i1.OpenViduService }, { token: i2.DeviceService }, { token: i3.StorageService }, { token: i4.ParticipantService }], target: i0.ɵɵFactoryTarget.Component });
AudioDevicesComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.8", type: AudioDevicesComponent, selector: "ov-audio-devices-select", outputs: { onDeviceSelectorClicked: "onDeviceSelectorClicked", onAudioMutedClicked: "onAudioMutedClicked" }, ngImport: i0, template: "<div class=\"device-container-element\">\n\t<button mat-icon-button id=\"microphone-button\" [disabled]=\"!hasAudioDevices\" [class.warn-btn]=\"isAudioMuted\" (click)=\"toggleMic()\">\n\t\t<mat-icon\n\t\t\t*ngIf=\"!isAudioMuted\"\n\t\t\t[matTooltipDisabled]=\"!hasAudioDevices\"\n\t\t\tmatTooltip=\"{{ 'TOOLBAR.MUTE_AUDIO' | translate }}\"\n\t\t\tid=\"mic\"\n\t\t>\n\t\t\tmic\n\t\t</mat-icon>\n\t\t<mat-icon\n\t\t\t*ngIf=\"isAudioMuted\"\n\t\t\t[matTooltipDisabled]=\"!hasAudioDevices\"\n\t\t\tmatTooltip=\"{{ 'TOOLBAR.UNMUTE_AUDIO' | translate }}\"\n\t\t\tid=\"mic_off\"\n\t\t>\n\t\t\tmic_off\n\t\t</mat-icon>\n\t</button>\n\t<mat-form-field>\n\t\t<mat-label *ngIf=\"hasAudioDevices\">{{ 'PREJOIN.AUDIO_DEVICE' | translate }}</mat-label>\n\t\t<mat-label *ngIf=\"!hasAudioDevices\">{{ 'PREJOIN.NO_AUDIO_DEVICE' | translate }}</mat-label>\n\t\t<mat-select\n\t\t\t[disabled]=\"isAudioMuted || !hasAudioDevices\"\n\t\t\t[value]=\"microphoneSelected?.device\"\n\t\t\t(click)=\"onDeviceSelectorClicked.emit()\"\n\t\t\t(selectionChange)=\"onMicrophoneSelected($event)\"\n\t\t>\n\t\t\t<mat-option *ngFor=\"let microphone of microphones\" [value]=\"microphone.device\">\n\t\t\t\t{{ microphone.label }}\n\t\t\t</mat-option>\n\t\t</mat-select>\n\t</mat-form-field>\n</div>\n", styles: [".device-container-element mat-form-field{width:100%;margin-top:10px;color:#000}.device-container-element button{margin:auto 10px auto auto}.device-container-element{display:flex}.warn-btn{color:var(--ov-text-color);background-color:var(--ov-warn-color)!important}\n"], dependencies: [{ kind: "directive", type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i6.MatButton, selector: "button[mat-button], button[mat-raised-button], button[mat-icon-button],             button[mat-fab], button[mat-mini-fab], button[mat-stroked-button],             button[mat-flat-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "component", type: i7.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "component", type: i8.MatFormField, selector: "mat-form-field", inputs: ["color", "appearance", "hideRequiredMarker", "hintLabel", "floatLabel"], exportAs: ["matFormField"] }, { kind: "directive", type: i8.MatLabel, selector: "mat-label" }, { kind: "directive", type: i9.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }, { kind: "component", type: i10.MatSelect, selector: "mat-select", inputs: ["disabled", "disableRipple", "tabIndex"], exportAs: ["matSelect"] }, { kind: "component", type: i11.MatOption, selector: "mat-option", exportAs: ["matOption"] }, { kind: "pipe", type: i12.TranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: AudioDevicesComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ov-audio-devices-select', template: "<div class=\"device-container-element\">\n\t<button mat-icon-button id=\"microphone-button\" [disabled]=\"!hasAudioDevices\" [class.warn-btn]=\"isAudioMuted\" (click)=\"toggleMic()\">\n\t\t<mat-icon\n\t\t\t*ngIf=\"!isAudioMuted\"\n\t\t\t[matTooltipDisabled]=\"!hasAudioDevices\"\n\t\t\tmatTooltip=\"{{ 'TOOLBAR.MUTE_AUDIO' | translate }}\"\n\t\t\tid=\"mic\"\n\t\t>\n\t\t\tmic\n\t\t</mat-icon>\n\t\t<mat-icon\n\t\t\t*ngIf=\"isAudioMuted\"\n\t\t\t[matTooltipDisabled]=\"!hasAudioDevices\"\n\t\t\tmatTooltip=\"{{ 'TOOLBAR.UNMUTE_AUDIO' | translate }}\"\n\t\t\tid=\"mic_off\"\n\t\t>\n\t\t\tmic_off\n\t\t</mat-icon>\n\t</button>\n\t<mat-form-field>\n\t\t<mat-label *ngIf=\"hasAudioDevices\">{{ 'PREJOIN.AUDIO_DEVICE' | translate }}</mat-label>\n\t\t<mat-label *ngIf=\"!hasAudioDevices\">{{ 'PREJOIN.NO_AUDIO_DEVICE' | translate }}</mat-label>\n\t\t<mat-select\n\t\t\t[disabled]=\"isAudioMuted || !hasAudioDevices\"\n\t\t\t[value]=\"microphoneSelected?.device\"\n\t\t\t(click)=\"onDeviceSelectorClicked.emit()\"\n\t\t\t(selectionChange)=\"onMicrophoneSelected($event)\"\n\t\t>\n\t\t\t<mat-option *ngFor=\"let microphone of microphones\" [value]=\"microphone.device\">\n\t\t\t\t{{ microphone.label }}\n\t\t\t</mat-option>\n\t\t</mat-select>\n\t</mat-form-field>\n</div>\n", styles: [".device-container-element mat-form-field{width:100%;margin-top:10px;color:#000}.device-container-element button{margin:auto 10px auto auto}.device-container-element{display:flex}.warn-btn{color:var(--ov-text-color);background-color:var(--ov-warn-color)!important}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.OpenViduService }, { type: i2.DeviceService }, { type: i3.StorageService }, { type: i4.ParticipantService }]; }, propDecorators: { onDeviceSelectorClicked: [{
                type: Output
            }], onAudioMutedClicked: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVkaW8tZGV2aWNlcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9vcGVudmlkdS1hbmd1bGFyL3NyYy9saWIvY29tcG9uZW50cy9zZXR0aW5ncy9hdWRpby1kZXZpY2VzL2F1ZGlvLWRldmljZXMuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvb3BlbnZpZHUtYW5ndWxhci9zcmMvbGliL2NvbXBvbmVudHMvc2V0dGluZ3MvYXVkaW8tZGV2aWNlcy9hdWRpby1kZXZpY2VzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFxQixNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFLbkYsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7Ozs7Ozs7Ozs7OztBQU03RDs7R0FFRztBQU1ILE1BQU0sT0FBTyxxQkFBcUI7SUFTakMsWUFDUyxlQUFnQyxFQUNoQyxTQUF3QixFQUN4QixVQUEwQixFQUMxQixrQkFBc0M7UUFIdEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ2hDLGNBQVMsR0FBVCxTQUFTLENBQWU7UUFDeEIsZUFBVSxHQUFWLFVBQVUsQ0FBZ0I7UUFDMUIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQVpyQyw0QkFBdUIsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBQ25ELHdCQUFtQixHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7UUFJNUQsZ0JBQVcsR0FBbUIsRUFBRSxDQUFDO0lBUTlCLENBQUM7SUFFSixLQUFLLENBQUMsUUFBUTtRQUNiLElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxDQUFDO1FBQzdDLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxrQkFBa0IsRUFBRSxFQUFFO1lBQzlDLCtDQUErQztZQUMvQyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdEM7UUFDRCxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztRQUNoRSxJQUFHLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ25ELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLHFCQUFxQixFQUFFLENBQUM7U0FDakU7UUFDRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDbEQsSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDLGtCQUFrQixFQUFFLEVBQUU7WUFDOUMsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUMvRDthQUFNO1lBQ04sSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ2xEO0lBQ0YsQ0FBQztJQUVELFdBQVc7UUFDVixJQUFJLElBQUksQ0FBQyw0QkFBNEI7WUFBRSxJQUFJLENBQUMsNEJBQTRCLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDeEYsQ0FBQztJQUVELFNBQVM7UUFDUixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVELEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxLQUFVO1FBQ3BDLE1BQU0sV0FBVyxHQUFHLEtBQUssRUFBRSxLQUFLLENBQUM7UUFDakMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQ3JELE1BQU0sRUFBRSxHQUF3QixFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLENBQUM7WUFDcEUsTUFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzlELElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzNDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLHFCQUFxQixFQUFFLENBQUM7U0FDakU7SUFDRixDQUFDO0lBRU8scUNBQXFDO1FBQzVDLElBQUksQ0FBQyw0QkFBNEIsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsbUJBQW1CLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBMkIsRUFBRSxFQUFFO1lBQ3pILElBQUksQ0FBQyxFQUFFO2dCQUNOLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBQ3hDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUNqRDtRQUNGLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQzs7a0hBOURXLHFCQUFxQjtzR0FBckIscUJBQXFCLDRLQ25CbEMsa3ZDQWtDQTsyRkRmYSxxQkFBcUI7a0JBTGpDLFNBQVM7K0JBQ0MseUJBQXlCO2dNQUt6Qix1QkFBdUI7c0JBQWhDLE1BQU07Z0JBQ0csbUJBQW1CO3NCQUE1QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIE9uRGVzdHJveSwgT25Jbml0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFB1Ymxpc2hlclByb3BlcnRpZXMgfSBmcm9tICdvcGVudmlkdS1icm93c2VyJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQ3VzdG9tRGV2aWNlIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL2RldmljZS5tb2RlbCc7XG5pbXBvcnQgeyBQYXJ0aWNpcGFudEFic3RyYWN0TW9kZWwgfSBmcm9tICcuLi8uLi8uLi9tb2RlbHMvcGFydGljaXBhbnQubW9kZWwnO1xuaW1wb3J0IHsgVmlkZW9UeXBlIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL3ZpZGVvLXR5cGUubW9kZWwnO1xuaW1wb3J0IHsgRGV2aWNlU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL2RldmljZS9kZXZpY2Uuc2VydmljZSc7XG5pbXBvcnQgeyBPcGVuVmlkdVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9vcGVudmlkdS9vcGVudmlkdS5zZXJ2aWNlJztcbmltcG9ydCB7IFBhcnRpY2lwYW50U2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BhcnRpY2lwYW50L3BhcnRpY2lwYW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgU3RvcmFnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9zdG9yYWdlL3N0b3JhZ2Uuc2VydmljZSc7XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbkBDb21wb25lbnQoe1xuXHRzZWxlY3RvcjogJ292LWF1ZGlvLWRldmljZXMtc2VsZWN0Jyxcblx0dGVtcGxhdGVVcmw6ICcuL2F1ZGlvLWRldmljZXMuY29tcG9uZW50Lmh0bWwnLFxuXHRzdHlsZVVybHM6IFsnLi9hdWRpby1kZXZpY2VzLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBBdWRpb0RldmljZXNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG5cdEBPdXRwdXQoKSBvbkRldmljZVNlbGVjdG9yQ2xpY2tlZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblx0QE91dHB1dCgpIG9uQXVkaW9NdXRlZENsaWNrZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cdGhhc0F1ZGlvRGV2aWNlczogYm9vbGVhbjtcblx0aXNBdWRpb011dGVkOiBib29sZWFuO1xuXHRtaWNyb3Bob25lU2VsZWN0ZWQ6IEN1c3RvbURldmljZSB8IG51bGw7XG5cdG1pY3JvcGhvbmVzOiBDdXN0b21EZXZpY2VbXSA9IFtdO1xuXHRwcml2YXRlIGxvY2FsUGFydGljaXBhbnRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuXHRjb25zdHJ1Y3Rvcihcblx0XHRwcml2YXRlIG9wZW52aWR1U2VydmljZTogT3BlblZpZHVTZXJ2aWNlLFxuXHRcdHByaXZhdGUgZGV2aWNlU3J2OiBEZXZpY2VTZXJ2aWNlLFxuXHRcdHByaXZhdGUgc3RvcmFnZVNydjogU3RvcmFnZVNlcnZpY2UsXG5cdFx0cHJpdmF0ZSBwYXJ0aWNpcGFudFNlcnZpY2U6IFBhcnRpY2lwYW50U2VydmljZVxuXHQpIHt9XG5cblx0YXN5bmMgbmdPbkluaXQoKSB7XG5cdFx0dGhpcy5zdWJzY3JpYmVUb1BhcnRpY2lwYW50TWVkaWFQcm9wZXJ0aWVzKCk7XG5cdFx0aWYgKHRoaXMub3BlbnZpZHVTZXJ2aWNlLmlzU2Vzc2lvbkNvbm5lY3RlZCgpKSB7XG5cdFx0XHQvLyBVcGRhdGluZyBkZXZpY2VzIG9ubHkgd2l0aCBzZXNzaW9uIGNvbm5lY3RlZFxuXHRcdFx0YXdhaXQgdGhpcy5kZXZpY2VTcnYucmVmcmVzaERldmljZXMoKTtcblx0XHR9XG5cdFx0dGhpcy5oYXNBdWRpb0RldmljZXMgPSB0aGlzLmRldmljZVNydi5oYXNBdWRpb0RldmljZUF2YWlsYWJsZSgpO1xuXHRcdGlmKHRoaXMuaGFzQXVkaW9EZXZpY2VzKSB7XG5cdFx0XHR0aGlzLm1pY3JvcGhvbmVzID0gdGhpcy5kZXZpY2VTcnYuZ2V0TWljcm9waG9uZXMoKTtcblx0XHRcdHRoaXMubWljcm9waG9uZVNlbGVjdGVkID0gdGhpcy5kZXZpY2VTcnYuZ2V0TWljcm9waG9uZVNlbGVjdGVkKCk7XG5cdFx0fVxuXHRcdHRoaXMuaXNBdWRpb011dGVkID0gdGhpcy5kZXZpY2VTcnYuaXNBdWRpb011dGVkKCk7XG5cdFx0aWYgKHRoaXMub3BlbnZpZHVTZXJ2aWNlLmlzU2Vzc2lvbkNvbm5lY3RlZCgpKSB7XG5cdFx0XHR0aGlzLmlzQXVkaW9NdXRlZCA9ICF0aGlzLnBhcnRpY2lwYW50U2VydmljZS5pc015QXVkaW9BY3RpdmUoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5pc0F1ZGlvTXV0ZWQgPSB0aGlzLmRldmljZVNydi5pc0F1ZGlvTXV0ZWQoKTtcblx0XHR9XG5cdH1cblxuXHRuZ09uRGVzdHJveSgpIHtcblx0XHRpZiAodGhpcy5sb2NhbFBhcnRpY2lwYW50U3Vic2NyaXB0aW9uKSB0aGlzLmxvY2FsUGFydGljaXBhbnRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcblx0fVxuXG5cdHRvZ2dsZU1pYygpIHtcblx0XHRjb25zdCBwdWJsaXNoID0gdGhpcy5pc0F1ZGlvTXV0ZWQ7XG5cdFx0dGhpcy5vcGVudmlkdVNlcnZpY2UucHVibGlzaEF1ZGlvKHB1Ymxpc2gpO1xuXHRcdHRoaXMub25BdWRpb011dGVkQ2xpY2tlZC5lbWl0KHB1Ymxpc2gpO1xuXHR9XG5cblx0YXN5bmMgb25NaWNyb3Bob25lU2VsZWN0ZWQoZXZlbnQ6IGFueSkge1xuXHRcdGNvbnN0IGF1ZGlvU291cmNlID0gZXZlbnQ/LnZhbHVlO1xuXHRcdGlmICh0aGlzLmRldmljZVNydi5uZWVkVXBkYXRlQXVkaW9UcmFjayhhdWRpb1NvdXJjZSkpIHtcblx0XHRcdGNvbnN0IHBwOiBQdWJsaXNoZXJQcm9wZXJ0aWVzID0geyBhdWRpb1NvdXJjZSwgdmlkZW9Tb3VyY2U6IGZhbHNlIH07XG5cdFx0XHRhd2FpdCB0aGlzLm9wZW52aWR1U2VydmljZS5yZXBsYWNlVHJhY2soVmlkZW9UeXBlLkNBTUVSQSwgcHApO1xuXHRcdFx0dGhpcy5kZXZpY2VTcnYuc2V0TWljU2VsZWN0ZWQoYXVkaW9Tb3VyY2UpO1xuXHRcdFx0dGhpcy5taWNyb3Bob25lU2VsZWN0ZWQgPSB0aGlzLmRldmljZVNydi5nZXRNaWNyb3Bob25lU2VsZWN0ZWQoKTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHN1YnNjcmliZVRvUGFydGljaXBhbnRNZWRpYVByb3BlcnRpZXMoKSB7XG5cdFx0dGhpcy5sb2NhbFBhcnRpY2lwYW50U3Vic2NyaXB0aW9uID0gdGhpcy5wYXJ0aWNpcGFudFNlcnZpY2UubG9jYWxQYXJ0aWNpcGFudE9icy5zdWJzY3JpYmUoKHA6IFBhcnRpY2lwYW50QWJzdHJhY3RNb2RlbCkgPT4ge1xuXHRcdFx0aWYgKHApIHtcblx0XHRcdFx0dGhpcy5pc0F1ZGlvTXV0ZWQgPSAhcC5oYXNBdWRpb0FjdGl2ZSgpO1xuXHRcdFx0XHR0aGlzLnN0b3JhZ2VTcnYuc2V0QXVkaW9NdXRlZCh0aGlzLmlzQXVkaW9NdXRlZCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJkZXZpY2UtY29udGFpbmVyLWVsZW1lbnRcIj5cblx0PGJ1dHRvbiBtYXQtaWNvbi1idXR0b24gaWQ9XCJtaWNyb3Bob25lLWJ1dHRvblwiIFtkaXNhYmxlZF09XCIhaGFzQXVkaW9EZXZpY2VzXCIgW2NsYXNzLndhcm4tYnRuXT1cImlzQXVkaW9NdXRlZFwiIChjbGljayk9XCJ0b2dnbGVNaWMoKVwiPlxuXHRcdDxtYXQtaWNvblxuXHRcdFx0Km5nSWY9XCIhaXNBdWRpb011dGVkXCJcblx0XHRcdFttYXRUb29sdGlwRGlzYWJsZWRdPVwiIWhhc0F1ZGlvRGV2aWNlc1wiXG5cdFx0XHRtYXRUb29sdGlwPVwie3sgJ1RPT0xCQVIuTVVURV9BVURJTycgfCB0cmFuc2xhdGUgfX1cIlxuXHRcdFx0aWQ9XCJtaWNcIlxuXHRcdD5cblx0XHRcdG1pY1xuXHRcdDwvbWF0LWljb24+XG5cdFx0PG1hdC1pY29uXG5cdFx0XHQqbmdJZj1cImlzQXVkaW9NdXRlZFwiXG5cdFx0XHRbbWF0VG9vbHRpcERpc2FibGVkXT1cIiFoYXNBdWRpb0RldmljZXNcIlxuXHRcdFx0bWF0VG9vbHRpcD1cInt7ICdUT09MQkFSLlVOTVVURV9BVURJTycgfCB0cmFuc2xhdGUgfX1cIlxuXHRcdFx0aWQ9XCJtaWNfb2ZmXCJcblx0XHQ+XG5cdFx0XHRtaWNfb2ZmXG5cdFx0PC9tYXQtaWNvbj5cblx0PC9idXR0b24+XG5cdDxtYXQtZm9ybS1maWVsZD5cblx0XHQ8bWF0LWxhYmVsICpuZ0lmPVwiaGFzQXVkaW9EZXZpY2VzXCI+e3sgJ1BSRUpPSU4uQVVESU9fREVWSUNFJyB8IHRyYW5zbGF0ZSB9fTwvbWF0LWxhYmVsPlxuXHRcdDxtYXQtbGFiZWwgKm5nSWY9XCIhaGFzQXVkaW9EZXZpY2VzXCI+e3sgJ1BSRUpPSU4uTk9fQVVESU9fREVWSUNFJyB8IHRyYW5zbGF0ZSB9fTwvbWF0LWxhYmVsPlxuXHRcdDxtYXQtc2VsZWN0XG5cdFx0XHRbZGlzYWJsZWRdPVwiaXNBdWRpb011dGVkIHx8ICFoYXNBdWRpb0RldmljZXNcIlxuXHRcdFx0W3ZhbHVlXT1cIm1pY3JvcGhvbmVTZWxlY3RlZD8uZGV2aWNlXCJcblx0XHRcdChjbGljayk9XCJvbkRldmljZVNlbGVjdG9yQ2xpY2tlZC5lbWl0KClcIlxuXHRcdFx0KHNlbGVjdGlvbkNoYW5nZSk9XCJvbk1pY3JvcGhvbmVTZWxlY3RlZCgkZXZlbnQpXCJcblx0XHQ+XG5cdFx0XHQ8bWF0LW9wdGlvbiAqbmdGb3I9XCJsZXQgbWljcm9waG9uZSBvZiBtaWNyb3Bob25lc1wiIFt2YWx1ZV09XCJtaWNyb3Bob25lLmRldmljZVwiPlxuXHRcdFx0XHR7eyBtaWNyb3Bob25lLmxhYmVsIH19XG5cdFx0XHQ8L21hdC1vcHRpb24+XG5cdFx0PC9tYXQtc2VsZWN0PlxuXHQ8L21hdC1mb3JtLWZpZWxkPlxuPC9kaXY+XG4iXX0=