import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';
import { Signal } from '../../models/signal.model';
import { PanelType } from '../../models/panel.model';
import * as i0 from "@angular/core";
import * as i1 from "../logger/logger.service";
import * as i2 from "../openvidu/openvidu.service";
import * as i3 from "../participant/participant.service";
import * as i4 from "../panel/panel.service";
import * as i5 from "../action/action.service";
/**
 * @internal
 */
export class ChatService {
    constructor(loggerSrv, openviduService, participantService, panelService, actionService) {
        this.loggerSrv = loggerSrv;
        this.openviduService = openviduService;
        this.participantService = participantService;
        this.panelService = panelService;
        this.actionService = actionService;
        this._messageList = new BehaviorSubject([]);
        this.messageList = [];
        this.log = this.loggerSrv.get('ChatService');
        this.messagesObs = this._messageList.asObservable();
        this.messageSound = new Audio('data:audio/wav;base64,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');
        this.messageSound.volume = 0.6;
    }
    subscribeToChat() {
        const session = this.openviduService.getWebcamSession();
        session.on(`signal:${Signal.CHAT}`, (event) => {
            const connectionId = event.from.connectionId;
            const data = JSON.parse(event.data);
            const isMyOwnConnection = this.openviduService.isMyOwnConnection(connectionId);
            this.messageList.push({
                isLocal: isMyOwnConnection,
                nickname: data.nickname,
                message: data.message
            });
            if (!this.panelService.isChatPanelOpened()) {
                const notificationOptions = {
                    message: `${data.nickname.toUpperCase()} sent a message`,
                    cssClassName: 'messageSnackbar',
                    buttonActionText: 'READ'
                };
                this.launchNotification(notificationOptions);
                this.messageSound.play().catch(() => { });
            }
            this._messageList.next(this.messageList);
        });
    }
    sendMessage(message) {
        message = message.replace(/ +(?= )/g, '');
        if (message !== '' && message !== ' ') {
            const data = {
                message: message,
                nickname: this.participantService.getMyNickname()
            };
            this.openviduService.sendSignal(Signal.CHAT, undefined, data);
        }
    }
    launchNotification(options) {
        this.actionService.launchNotification(options, this.panelService.togglePanel.bind(this.panelService, PanelType.CHAT));
    }
}
ChatService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: ChatService, deps: [{ token: i1.LoggerService }, { token: i2.OpenViduService }, { token: i3.ParticipantService }, { token: i4.PanelService }, { token: i5.ActionService }], target: i0.ɵɵFactoryTarget.Injectable });
ChatService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: ChatService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: ChatService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.LoggerService }, { type: i2.OpenViduService }, { type: i3.ParticipantService }, { type: i4.PanelService }, { type: i5.ActionService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhdC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvb3BlbnZpZHUtYW5ndWxhci9zcmMvbGliL3NlcnZpY2VzL2NoYXQvY2hhdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBU2hFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUduRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7Ozs7Ozs7QUFFckQ7O0dBRUc7QUFJSCxNQUFNLE9BQU8sV0FBVztJQU12QixZQUNXLFNBQXdCLEVBQ3hCLGVBQWdDLEVBQ2hDLGtCQUFzQyxFQUN0QyxZQUEwQixFQUMxQixhQUE0QjtRQUo1QixjQUFTLEdBQVQsU0FBUyxDQUFlO1FBQ3hCLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBQ3RDLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQzFCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBUjdCLGlCQUFZLEdBQW1DLElBQUksZUFBZSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZFLGdCQUFXLEdBQWtCLEVBQUUsQ0FBQztRQVN6QyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNwRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksS0FBSyxDQUFDLHc3SEFBdzdILENBQUMsQ0FBQztRQUN4OUgsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDO0lBQ2hDLENBQUM7SUFFRCxlQUFlO1FBQ2QsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3hELE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxLQUFVLEVBQUUsRUFBRTtZQUNsRCxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQztZQUM3QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwQyxNQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDL0UsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUM7Z0JBQ3JCLE9BQU8sRUFBRSxpQkFBaUI7Z0JBQzFCLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTtnQkFDdkIsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO2FBQ3JCLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGlCQUFpQixFQUFFLEVBQUU7Z0JBQzNDLE1BQU0sbUJBQW1CLEdBQXlCO29CQUNqRCxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxpQkFBaUI7b0JBQ3hELFlBQVksRUFBRSxpQkFBaUI7b0JBQy9CLGdCQUFnQixFQUFFLE1BQU07aUJBQ3hCLENBQUM7Z0JBQ0YsSUFBSSxDQUFDLGtCQUFrQixDQUFDLG1CQUFtQixDQUFDLENBQUM7Z0JBQzdDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxDQUFDO2FBRXpDO1lBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFlO1FBQzFCLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMxQyxJQUFJLE9BQU8sS0FBSyxFQUFFLElBQUksT0FBTyxLQUFLLEdBQUcsRUFBRTtZQUN0QyxNQUFNLElBQUksR0FBRztnQkFDWixPQUFPLEVBQUUsT0FBTztnQkFDaEIsUUFBUSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLEVBQUU7YUFDakQsQ0FBQztZQUVGLElBQUksQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQzlEO0lBQ0YsQ0FBQztJQUVTLGtCQUFrQixDQUFDLE9BQTZCO1FBQ3pELElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3ZILENBQUM7O3dHQTFEVyxXQUFXOzRHQUFYLFdBQVcsY0FGWCxNQUFNOzJGQUVOLFdBQVc7a0JBSHZCLFVBQVU7bUJBQUM7b0JBQ1gsVUFBVSxFQUFFLE1BQU07aUJBQ2xCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvaW50ZXJuYWwvT2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzL2ludGVybmFsL0JlaGF2aW9yU3ViamVjdCc7XG5cbmltcG9ydCB7IElMb2dnZXIgfSBmcm9tICcuLi8uLi9tb2RlbHMvbG9nZ2VyLm1vZGVsJztcbmltcG9ydCB7IENoYXRNZXNzYWdlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2NoYXQubW9kZWwnO1xuaW1wb3J0IHsgSU5vdGlmaWNhdGlvbk9wdGlvbnMgfSBmcm9tICcuLi8uLi9tb2RlbHMvbm90aWZpY2F0aW9uLW9wdGlvbnMubW9kZWwnO1xuXG5pbXBvcnQgeyBBY3Rpb25TZXJ2aWNlIH0gZnJvbSAnLi4vYWN0aW9uL2FjdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IE9wZW5WaWR1U2VydmljZSB9IGZyb20gJy4uL29wZW52aWR1L29wZW52aWR1LnNlcnZpY2UnO1xuaW1wb3J0IHsgTG9nZ2VyU2VydmljZSB9IGZyb20gJy4uL2xvZ2dlci9sb2dnZXIuc2VydmljZSc7XG5pbXBvcnQgeyBTaWduYWwgfSBmcm9tICcuLi8uLi9tb2RlbHMvc2lnbmFsLm1vZGVsJztcbmltcG9ydCB7IFBhbmVsU2VydmljZSB9IGZyb20gJy4uL3BhbmVsL3BhbmVsLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGFydGljaXBhbnRTZXJ2aWNlIH0gZnJvbSAnLi4vcGFydGljaXBhbnQvcGFydGljaXBhbnQuc2VydmljZSc7XG5pbXBvcnQgeyBQYW5lbFR5cGUgfSBmcm9tICcuLi8uLi9tb2RlbHMvcGFuZWwubW9kZWwnO1xuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5ASW5qZWN0YWJsZSh7XG5cdHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBDaGF0U2VydmljZSB7XG5cdG1lc3NhZ2VzT2JzOiBPYnNlcnZhYmxlPENoYXRNZXNzYWdlW10+O1xuXHRwcml2YXRlIG1lc3NhZ2VTb3VuZDogSFRNTEF1ZGlvRWxlbWVudDtcblx0cHJvdGVjdGVkIF9tZXNzYWdlTGlzdCA9IDxCZWhhdmlvclN1YmplY3Q8Q2hhdE1lc3NhZ2VbXT4+bmV3IEJlaGF2aW9yU3ViamVjdChbXSk7XG5cdHByb3RlY3RlZCBtZXNzYWdlTGlzdDogQ2hhdE1lc3NhZ2VbXSA9IFtdO1xuXHRwcm90ZWN0ZWQgbG9nOiBJTG9nZ2VyO1xuXHRjb25zdHJ1Y3Rvcihcblx0XHRwcm90ZWN0ZWQgbG9nZ2VyU3J2OiBMb2dnZXJTZXJ2aWNlLFxuXHRcdHByb3RlY3RlZCBvcGVudmlkdVNlcnZpY2U6IE9wZW5WaWR1U2VydmljZSxcblx0XHRwcm90ZWN0ZWQgcGFydGljaXBhbnRTZXJ2aWNlOiBQYXJ0aWNpcGFudFNlcnZpY2UsXG5cdFx0cHJvdGVjdGVkIHBhbmVsU2VydmljZTogUGFuZWxTZXJ2aWNlLFxuXHRcdHByb3RlY3RlZCBhY3Rpb25TZXJ2aWNlOiBBY3Rpb25TZXJ2aWNlXG5cdCkge1xuXHRcdHRoaXMubG9nID0gdGhpcy5sb2dnZXJTcnYuZ2V0KCdDaGF0U2VydmljZScpO1xuXHRcdHRoaXMubWVzc2FnZXNPYnMgPSB0aGlzLl9tZXNzYWdlTGlzdC5hc09ic2VydmFibGUoKTtcblx0XHR0aGlzLm1lc3NhZ2VTb3VuZCA9IG5ldyBBdWRpbygnZGF0YTphdWRpby93YXY7YmFzZTY0LFNVUXpBd0FBQUFBQWVrTlBUVTBBQUFBbUFBQUFBQUFBQUZKbFkyOXlaR1ZrSUc5dUlESTNMakF4TGpJd01qRWdhVzRnUldScGMyOXVMa05QVFUwQUFBQW1BQUFBV0ZoWUFGSmxZMjl5WkdWa0lHOXVJREkzTGpBeExqSXdNakVnYVc0Z1JXUnBjMjl1TGxSWVdGZ0FBQUFRQUFBQVUyOW1kSGRoY21VQVJXUnBjMjl1Ly91UXhBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQVdHbHVad0FBQUE4QUFBQUpBQUFMTkFCTVRFeE1URXhNVEV4TVRHeHNiR3hzYkd4c2JHeHNpSWlJaUlpSWlJaUlpSWlqbzZPam82T2pvNk9qbzc2K3ZyNit2cjYrdnI2KzFOVFUxTlRVMU5UVTFOVGs1T1RrNU9UazVPVGs1UFgxOWZYMTlmWDE5ZlgxLy8vLy8vLy8vLy8vLy84QUFBQThURUZOUlRNdU1UQXdCSzhBQUFBQUFBQUFBQlVnSkFhZFFRQUJ6QUFBQ3pRZVNPMDVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQS8vdkF4QUFBQnNBRGI3UVFBQ09PTFczL05hQlF6Y0tOYklBQ1JVNElQaCtIMUJoeCtEN3hRSDRJSEJJY0xoK0QvS09rNFB3UWNVT2Z5Ny81Yy9JUVFkclA4cDFnKy8vLy8vNFltb2FKSXdVeEFGRVNucUlreWVkdHlIQm9JQkJEOHhSVkZJTEJWWEJBOE9LR3VXbXBMQWlJQWdjTUhnQWlRTTh1QldCSGxNcDl4eFd5b3hDYWtzdWRWaDhLQng1MFlFMGFLMHN5WmJSNzA0Y2d1T3BvWFlBcWNXR3AyTER4Ri9ZRlNVRmtZV0RwZkZxaUlDWXNNWDduWUJlQndxV1Z1L2VXa1c5c3hYVmxSc3RkVFVqWnAyUjFxV1hTU25vb0lkR0hYWmxWdC9WQTdrU2tPTXNnVEhkelZxcmRzNVNxZTNLcWFtcTh5dFJSMlYydW5KNStVYTVUVjhxVzVqbG5XM3U3RE92dTVaMWExckM1aFd3enkxckQ4S1hXZVcveTNoanJQTGU2MU52S1ZXaXg2MXFsek1wWEFSQVNBQVM5d2VWWUZyS0JyTVdxdTZqalVaN2ZUYmZVUlZZYS9NN3lzd0hFRmNTTEtMeHFtc2xBNkJlUjdyb0tqNkpxT2luMHpwY09zZ3JSK3gwa1Vpa28wU05VRHBMT3VTcHJTTWpWSk56Ni9ycE9wTkhSVWxSTlZJbUpxNmxKUGQzZEUxYjBsZEV4UEZiZ1pNZ1lPd2FCUjk0Mks5WHNDbjltOWx3Z29RZ0FBQ1p1M3lJTGNSQVFhVXB3a3ZQcithNis2S2RWdXE5Z1FJYjFVN3k0SGpUYTdIR3NjSWlzVk9NNWxYWUZrV3lkeURCWW1qcDdvS2dPVVlVYWNxSU5kSXFJRU1kMEZCQVdpei9VeU1xYk16TWNoZjdYT3RLRm9TWE04UWNmUWFObG1BOEhRMHRiWHNENTZsS0RJdlozWFl4UzN2dWxGME1BUVFudnduQlhRZlpQd0x3VkFNa1lvU2doU2tJcGNrRkpPQkJOSlptWWhFNEU3UDU4U0dRQWdqVlJaMVp0Tm1vMnJIcTduejNtUzJVNk9pWEd0a2haZWhXbWlqQnQvM2QxVEdjUUVxNDJzeHFPVUZFUVZEd1dCWTB0UnNBaW9aS3c2V0poZzY5TzZwSnJhM1hhU3A3OTFtQjJJQVNRbGRoWkxmT0FrN0RJZ0NYeFRIbzBuV0JzaHFOMFk4NHpNR3pDTUtSdFlHYlZ2ejdXQVZDNU56cm15a1FMSWxyZk4ycUhYUTZaL3FVbURLWC8rM0RFMWdBUHRROWIvWWFBSWVBaXF2MkdGYXpBVG5jb2JrYzlFQUFrdmI5cG5NalZzazN3UWhNOUxsaCtIQ0lSRkVSZDRzTFJPZ1RQT0syakhmekhwVTM4Mm5RRklBZ0FDYzJmR0dCT0R0TmtUUXFoSXpKSHJINE5Ga0lFY3c2UEt4Z29jRlNtM0NyZ2lEWXAxdE1SU3pqd0NWYVZEajQzdldyN2pXaUM0b2FIc0hhMjd6VUt4SktETmVmL2pYZUd1eGxLVFkyZFR3T0ZLQSt5NmwyVG5SaEltREtoWVFnRWlhODIyeDVadDZ5NWI5Nm5nWVlqSUJEZXVDRlF3bm93RUhGY3AzRjNRMnlGRlpMdlM1NEpkV0NuK2xWSlhqczFWMXUzcW50UnB5VThJN1VxMy9heTAzYlcxbmRMZjkyL3VVeHBFTElPNDRmM0tyNkNCYkVZVzVkT2xXbzVMS3dSbk1iUkhzVUlkOEtGVmdVRlhnK0dFcFdnOVZ2NDFZeGJOMXR1eW1mRDVDci8zSE1WVWhBTExkdERMUXBCT3Yxci8vdGd4TzBBRG5EM1YrZWtUZUcrRzZxOWhZMzBxTURVMVNTTk9lZ2N5T3hCb1E2Rk5DZEx2eEhyMjN0YTBzVTl5c1IwV2JHcDh4TTBqMXJteTZacjYxdkZiVmkxOTIwd0RqZXhaRDFaK1RwWGFBbkdDKzFnZkdsUllTZ1lVWlNlYXNvaVhrRGRTOEE3ejJDSmRvOFgzK001TkF4VGhkUDl2TzVPcEFDb3E3S0E4aTZDbWdzaUJOUStCa01nOXlWa0ZLazVEaVNwUFZUR1pKSjBYQ3R2R3MwZktZaEoxU2IrTVlmYnJtdGFadytmNjE5VFZ4dkc1bXNvbkdhVWN6akdkYUpvWTZPY3VCY0dpNVJZYVNoWXhoMVROZ1pHSk5DemdvWElONHJkUjFwVjBKV2hGbWZ5bGRYdi9KY0poZ0JUY3R1RFBGR09kRkFtQ2VDNGg5bmNKS2NndVZ6WS8vdGd4UE9BRGhEZFVlZWxEU0hYSDZvOWd3clVxRDdnTFZKaE9GbkNJb3Y2bEZNWUN5THo1T3RFblAwT0Nzc29VT3hvS1lxMU5ScU1wSTdFNzVMa1Y4aktkSXlPQ2tuUUVMalNRU0l1YWhFME9qZlN5U1VuMVc2M0Q3L0htRVhDSnE4M2N4d2gxS0oyL0FBTmswSi9GK3ZzZ2NsMVFSdFRZMWlEWk1GMGVUdE92NEtuY1JQV2UwYjB4R2xiVGpYU2liNFczQWxENVR5cElzMmUzYXFyeWl5SWtwY3hPTWVOM0d0R0gxMnVZcWtXaE8wZHFTbEE5YXE2dXdobU5wM2NBQWluRmVPQzZsbWNlUjJFaUdVandNMTRXSkU1Y1ZqMFNzMHpXMXZZNVpqbnBTU0wzRnMvVjJrdm0zVk45MHY0Wm44L21sUm9WWkYwN3VpRlJWM25iK014ejlMSS8vdGd4UGdBRGp5dFQrdzhiZUhGRmVuODhadUUwbDNad1JCRUpKd0FBVmR4d25JVmhvUXlYVkdBV3BLWUlROFZoZnh1cmF0ZnNVNUlENys0SU9lb1lqMHMzdnJlclFZdDFvbzhGUEE1WWkvaitpZzdDcHJteDNpemlqaTc2eGlsYXBtS0pFUUNWSlFBQkxZVkJUeHlSbXNYTXY1QUMvQzJUbXdUUXZpR1ljNUlMQVNCYWtwV3kxSTRBczVaKytDUW10YjNVVE1OdjFvcHVzOEpKelNweDhQZ3Y4VWw2a3RMWjNPeTdRRUk2Q0lrVkh5WG1FK3R0NjkvUDBWMGxJdUxRR21oQ1NBUUNKRWlWYTlWVkVpU1FWK1FVMjZLeC9Udi9FR0c1UEJRb2FwTVFVMUZNeTR4TURDcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcS8vdFF4UDRBRFJqUFQrZWtiU0ZYRnFpOWg1azBxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXBNUVUxRk15NHhNRENxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXF2LzdNTVQ4QUFtb20wSHNNVEpwS1JMbVBQWWlVS3FxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxdi83TU1UemdFbE1tVGZucE5KbzFBaW1mUFNaZ2FxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXYvN0VNVFdBOEFBQWFRQUFBQWdBQUEwZ0FBQUJLcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXEnKTtcblx0XHR0aGlzLm1lc3NhZ2VTb3VuZC52b2x1bWUgPSAwLjY7XG5cdH1cblxuXHRzdWJzY3JpYmVUb0NoYXQoKSB7XG5cdFx0Y29uc3Qgc2Vzc2lvbiA9IHRoaXMub3BlbnZpZHVTZXJ2aWNlLmdldFdlYmNhbVNlc3Npb24oKTtcblx0XHRzZXNzaW9uLm9uKGBzaWduYWw6JHtTaWduYWwuQ0hBVH1gLCAoZXZlbnQ6IGFueSkgPT4ge1xuXHRcdFx0Y29uc3QgY29ubmVjdGlvbklkID0gZXZlbnQuZnJvbS5jb25uZWN0aW9uSWQ7XG5cdFx0XHRjb25zdCBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcblx0XHRcdGNvbnN0IGlzTXlPd25Db25uZWN0aW9uID0gdGhpcy5vcGVudmlkdVNlcnZpY2UuaXNNeU93bkNvbm5lY3Rpb24oY29ubmVjdGlvbklkKTtcblx0XHRcdHRoaXMubWVzc2FnZUxpc3QucHVzaCh7XG5cdFx0XHRcdGlzTG9jYWw6IGlzTXlPd25Db25uZWN0aW9uLFxuXHRcdFx0XHRuaWNrbmFtZTogZGF0YS5uaWNrbmFtZSxcblx0XHRcdFx0bWVzc2FnZTogZGF0YS5tZXNzYWdlXG5cdFx0XHR9KTtcblx0XHRcdGlmICghdGhpcy5wYW5lbFNlcnZpY2UuaXNDaGF0UGFuZWxPcGVuZWQoKSkge1xuXHRcdFx0XHRjb25zdCBub3RpZmljYXRpb25PcHRpb25zOiBJTm90aWZpY2F0aW9uT3B0aW9ucyA9IHtcblx0XHRcdFx0XHRtZXNzYWdlOiBgJHtkYXRhLm5pY2tuYW1lLnRvVXBwZXJDYXNlKCl9IHNlbnQgYSBtZXNzYWdlYCxcblx0XHRcdFx0XHRjc3NDbGFzc05hbWU6ICdtZXNzYWdlU25hY2tiYXInLFxuXHRcdFx0XHRcdGJ1dHRvbkFjdGlvblRleHQ6ICdSRUFEJ1xuXHRcdFx0XHR9O1xuXHRcdFx0XHR0aGlzLmxhdW5jaE5vdGlmaWNhdGlvbihub3RpZmljYXRpb25PcHRpb25zKTtcblx0XHRcdFx0dGhpcy5tZXNzYWdlU291bmQucGxheSgpLmNhdGNoKCgpID0+IHt9KTtcblxuXHRcdFx0fVxuXHRcdFx0dGhpcy5fbWVzc2FnZUxpc3QubmV4dCh0aGlzLm1lc3NhZ2VMaXN0KTtcblx0XHR9KTtcblx0fVxuXG5cdHNlbmRNZXNzYWdlKG1lc3NhZ2U6IHN0cmluZykge1xuXHRcdG1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UoLyArKD89ICkvZywgJycpO1xuXHRcdGlmIChtZXNzYWdlICE9PSAnJyAmJiBtZXNzYWdlICE9PSAnICcpIHtcblx0XHRcdGNvbnN0IGRhdGEgPSB7XG5cdFx0XHRcdG1lc3NhZ2U6IG1lc3NhZ2UsXG5cdFx0XHRcdG5pY2tuYW1lOiB0aGlzLnBhcnRpY2lwYW50U2VydmljZS5nZXRNeU5pY2tuYW1lKClcblx0XHRcdH07XG5cblx0XHRcdHRoaXMub3BlbnZpZHVTZXJ2aWNlLnNlbmRTaWduYWwoU2lnbmFsLkNIQVQsIHVuZGVmaW5lZCwgZGF0YSk7XG5cdFx0fVxuXHR9XG5cblx0cHJvdGVjdGVkIGxhdW5jaE5vdGlmaWNhdGlvbihvcHRpb25zOiBJTm90aWZpY2F0aW9uT3B0aW9ucykge1xuXHRcdHRoaXMuYWN0aW9uU2VydmljZS5sYXVuY2hOb3RpZmljYXRpb24ob3B0aW9ucywgdGhpcy5wYW5lbFNlcnZpY2UudG9nZ2xlUGFuZWwuYmluZCh0aGlzLnBhbmVsU2VydmljZSwgUGFuZWxUeXBlLkNIQVQpKTtcblx0fVxufVxuIl19