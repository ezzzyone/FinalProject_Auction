import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { RecordingStatus } from '../../models/recording.model';
import * as i0 from "@angular/core";
import * as i1 from "../action/action.service";
import * as i2 from "@angular/platform-browser";
export class RecordingService {
    /**
     * @internal
     * @param actionService
     * @param sanitizer
     */
    constructor(actionService, sanitizer) {
        this.actionService = actionService;
        this.sanitizer = sanitizer;
        this.currentRecording = { status: RecordingStatus.STOPPED };
        this.recordingStatus = new BehaviorSubject(null);
        this.baseUrl = '/' + (!!window.location.pathname.split('/')[1] ? window.location.pathname.split('/')[1] + '/' : '');
        this.recordingStatusObs = this.recordingStatus.asObservable();
    }
    /**
     * @internal
     * @param status
     */
    updateStatus(status) {
        this.currentRecording = {
            status: status
        };
        this.recordingStatus.next({ info: this.currentRecording });
    }
    /**
     * @internal
     * @param event
     */
    startRecording(event) {
        this.currentRecording = {
            status: RecordingStatus.STARTED,
            id: event.id,
            name: event.name,
            reason: event.reason
        };
        this.startRecordingTime();
        this.recordingStatus.next({ info: this.currentRecording, time: this.recordingTime });
    }
    /**
     * @internal
     * @param event
     */
    stopRecording(event) {
        this.currentRecording.status = RecordingStatus.STOPPED;
        this.currentRecording.reason = event.reason;
        this.recordingStatus.next({ info: this.currentRecording, time: null });
        this.stopRecordingTime();
    }
    /**
     * @internal
     * Play the recording blob received as parameter. This parameter must be obtained from backend using the OpenVidu REST API
     */
    playRecording(recording) {
        const recordingId = recording.id;
        // Only COMPOSED recording is supported. The extension will allways be 'mp4'.
        const extension = 'mp4'; //recording.url?.split('.').pop()  || 'mp4';
        this.actionService.openRecordingPlayerDialog(`${this.baseUrl}recordings/${recordingId}/${recordingId}.${extension}`);
    }
    /**
     * @internal
     * Download the the recording file received .
     * @param recording
     */
    downloadRecording(recording) {
        const recordingId = recording.id;
        // Only COMPOSED recording is supported. The extension will allways be 'mp4'.
        const extension = 'mp4'; //recording.url?.split('.').pop()  || 'mp4';
        const link = document.createElement('a');
        link.href = `/recordings/${recordingId}/${recordingId}.${extension}`;
        link.download = `${recordingId}.${extension}`;
        link.dispatchEvent(new MouseEvent('click', {
            bubbles: true,
            cancelable: true,
            view: window
        }));
        setTimeout(() => {
            // For Firefox it is necessary to delay revoking the ObjectURL
            link.remove();
        }, 100);
    }
    startRecordingTime() {
        this.recordingTime = new Date();
        this.recordingTime.setHours(0, 0, 0, 0);
        this.recordingTimeInterval = setInterval(() => {
            this.recordingTime.setSeconds(this.recordingTime.getSeconds() + 1);
            this.recordingTime = new Date(this.recordingTime.getTime());
            this.recordingStatus.next({ info: this.currentRecording, time: this.recordingTime });
        }, 1000);
    }
    stopRecordingTime() {
        clearInterval(this.recordingTimeInterval);
        this.recordingTime = null;
    }
}
RecordingService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: RecordingService, deps: [{ token: i1.ActionService }, { token: i2.DomSanitizer }], target: i0.ɵɵFactoryTarget.Injectable });
RecordingService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: RecordingService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: RecordingService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.ActionService }, { type: i2.DomSanitizer }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVjb3JkaW5nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9vcGVudmlkdS1hbmd1bGFyL3NyYy9saWIvc2VydmljZXMvcmVjb3JkaW5nL3JlY29yZGluZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHM0MsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNuRCxPQUFPLEVBQWlCLGVBQWUsRUFBRSxNQUFNLDhCQUE4QixDQUFDOzs7O0FBTTlFLE1BQU0sT0FBTyxnQkFBZ0I7SUFhNUI7Ozs7T0FJRztJQUNILFlBQW9CLGFBQTRCLEVBQVUsU0FBdUI7UUFBN0Qsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFjO1FBVnpFLHFCQUFnQixHQUFrQixFQUFFLE1BQU0sRUFBRSxlQUFlLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDdEUsb0JBQWUsR0FBMEQsSUFBSSxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkcsWUFBTyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBU3RILElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQy9ELENBQUM7SUFFRDs7O09BR0c7SUFDSCxZQUFZLENBQUMsTUFBdUI7UUFDbkMsSUFBSSxDQUFDLGdCQUFnQixHQUFH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QyxhQUFhLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDbkUsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDNUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQztRQUN0RixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDVixDQUFDO0lBRU8saUJBQWlCO1FBQ3hCLGFBQWEsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUMxQyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztJQUMzQixDQUFDOzs2R0E5R1csZ0JBQWdCO2lIQUFoQixnQkFBZ0IsY0FGaEIsTUFBTTsyRkFFTixnQkFBZ0I7a0JBSDVCLFVBQVU7bUJBQUM7b0JBQ1gsVUFBVSxFQUFFLE1BQU07aUJBQ2xCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQgeyBSZWNvcmRpbmdFdmVudCB9IGZyb20gJ29wZW52aWR1LWJyb3dzZXInO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBSZWNvcmRpbmdJbmZvLCBSZWNvcmRpbmdTdGF0dXMgfSBmcm9tICcuLi8uLi9tb2RlbHMvcmVjb3JkaW5nLm1vZGVsJztcbmltcG9ydCB7IEFjdGlvblNlcnZpY2UgfSBmcm9tICcuLi9hY3Rpb24vYWN0aW9uLnNlcnZpY2UnO1xuXG5ASW5qZWN0YWJsZSh7XG5cdHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBSZWNvcmRpbmdTZXJ2aWNlIHtcblx0LyoqXG5cdCAqIFJlY29yZGluZyBzdGF0dXMgT2JzZXJ2YWJsZSB3aGljaCBwdXNoZXMgdGhlIHJlY29yZGluZyBzdGF0ZSBpbiBldmVyeSB1cGRhdGUuXG5cdCAqL1xuXHRyZWNvcmRpbmdTdGF0dXNPYnM6IE9ic2VydmFibGU8eyBpbmZvOiBSZWNvcmRpbmdJbmZvOyB0aW1lPzogRGF0ZSB9PjtcblxuXHRwcml2YXRlIHJlY29yZGluZ1RpbWU6IERhdGU7XG5cdHByaXZhdGUgcmVjb3JkaW5nVGltZUludGVydmFsOiBOb2RlSlMuVGltZXI7XG5cdHByaXZhdGUgY3VycmVudFJlY29yZGluZzogUmVjb3JkaW5nSW5mbyA9IHsgc3RhdHVzOiBSZWNvcmRpbmdTdGF0dXMuU1RPUFBFRCB9O1xuXHRwcml2YXRlIHJlY29yZGluZ1N0YXR1cyA9IDxCZWhhdmlvclN1YmplY3Q8eyBpbmZvOiBSZWNvcmRpbmdJbmZvOyB0aW1lPzogRGF0ZSB9Pj5uZXcgQmVoYXZpb3JTdWJqZWN0KG51bGwpO1xuXHRwcml2YXRlIGJhc2VVcmwgPSAnLycgKyAoISF3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKVsxXSA/IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpWzFdICsgJy8nIDogJycpO1xuXG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gYWN0aW9uU2VydmljZVxuXHQgKiBAcGFyYW0gc2FuaXRpemVyXG5cdCAqL1xuXHRjb25zdHJ1Y3Rvcihwcml2YXRlIGFjdGlvblNlcnZpY2U6IEFjdGlvblNlcnZpY2UsIHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIpIHtcblx0XHR0aGlzLnJlY29yZGluZ1N0YXR1c09icyA9IHRoaXMucmVjb3JkaW5nU3RhdHVzLmFzT2JzZXJ2YWJsZSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gc3RhdHVzXG5cdCAqL1xuXHR1cGRhdGVTdGF0dXMoc3RhdHVzOiBSZWNvcmRpbmdTdGF0dXMpIHtcblx0XHR0aGlzLmN1cnJlbnRSZWNvcmRpbmcgPSB7XG5cdFx0XHRzdGF0dXM6IHN0YXR1c1xuXHRcdH07XG5cdFx0dGhpcy5yZWNvcmRpbmdTdGF0dXMubmV4dCh7IGluZm86IHRoaXMuY3VycmVudFJlY29yZGluZyB9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGV2ZW50XG5cdCAqL1xuXHRzdGFydFJlY29yZGluZyhldmVudDogUmVjb3JkaW5nRXZlbnQpIHtcblx0XHR0aGlzLmN1cnJlbnRSZWNvcmRpbmcgPSB7XG5cdFx0XHRzdGF0dXM6IFJlY29yZGluZ1N0YXR1cy5TVEFSVEVELFxuXHRcdFx0aWQ6IGV2ZW50LmlkLFxuXHRcdFx0bmFtZTogZXZlbnQubmFtZSxcblx0XHRcdHJlYXNvbjogZXZlbnQucmVhc29uXG5cdFx0fTtcblx0XHR0aGlzLnN0YXJ0UmVjb3JkaW5nVGltZSgpO1xuXHRcdHRoaXMucmVjb3JkaW5nU3RhdHVzLm5leHQoeyBpbmZvOiB0aGlzLmN1cnJlbnRSZWNvcmRpbmcsIHRpbWU6IHRoaXMucmVjb3JkaW5nVGltZSB9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGV2ZW50XG5cdCAqL1xuXHRzdG9wUmVjb3JkaW5nKGV2ZW50OiBSZWNvcmRpbmdFdmVudCkge1xuXHRcdHRoaXMuY3VycmVudFJlY29yZGluZy5zdGF0dXMgPSBSZWNvcmRpbmdTdGF0dXMuU1RPUFBFRDtcblx0XHR0aGlzLmN1cnJlbnRSZWNvcmRpbmcucmVhc29uID0gZXZlbnQucmVhc29uO1xuXHRcdHRoaXMucmVjb3JkaW5nU3RhdHVzLm5leHQoeyBpbmZvOiB0aGlzLmN1cnJlbnRSZWNvcmRpbmcsIHRpbWU6IG51bGwgfSk7XG5cdFx0dGhpcy5zdG9wUmVjb3JkaW5nVGltZSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBQbGF5IHRoZSByZWNvcmRpbmcgYmxvYiByZWNlaXZlZCBhcyBwYXJhbWV0ZXIuIFRoaXMgcGFyYW1ldGVyIG11c3QgYmUgb2J0YWluZWQgZnJvbSBiYWNrZW5kIHVzaW5nIHRoZSBPcGVuVmlkdSBSRVNUIEFQSVxuXHQgKi9cblx0cGxheVJlY29yZGluZyhyZWNvcmRpbmc6IFJlY29yZGluZ0luZm8pIHtcblx0XHRjb25zdCByZWNvcmRpbmdJZCA9IHJlY29yZGluZy5pZDtcblx0XHQvLyBPbmx5IENPTVBPU0VEIHJlY29yZGluZyBpcyBzdXBwb3J0ZWQuIFRoZSBleHRlbnNpb24gd2lsbCBhbGx3YXlzIGJlICdtcDQnLlxuXHRcdGNvbnN0IGV4dGVuc2lvbiA9ICdtcDQnOyAvL3JlY29yZGluZy51cmw/LnNwbGl0KCcuJykucG9wKCkgIHx8ICdtcDQnO1xuXHRcdHRoaXMuYWN0aW9uU2VydmljZS5vcGVuUmVjb3JkaW5nUGxheWVyRGlhbG9nKGAke3RoaXMuYmFzZVVybH1yZWNvcmRpbmdzLyR7cmVjb3JkaW5nSWR9LyR7cmVjb3JkaW5nSWR9LiR7ZXh0ZW5zaW9ufWApO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBEb3dubG9hZCB0aGUgdGhlIHJlY29yZGluZyBmaWxlIHJlY2VpdmVkIC5cblx0ICogQHBhcmFtIHJlY29yZGluZ1xuXHQgKi9cblx0ZG93bmxvYWRSZWNvcmRpbmcocmVjb3JkaW5nOiBSZWNvcmRpbmdJbmZvKSB7XG5cdFx0Y29uc3QgcmVjb3JkaW5nSWQgPSByZWNvcmRpbmcuaWQ7XG5cdFx0Ly8gT25seSBDT01QT1NFRCByZWNvcmRpbmcgaXMgc3VwcG9ydGVkLiBUaGUgZXh0ZW5zaW9uIHdpbGwgYWxsd2F5cyBiZSAnbXA0Jy5cblx0XHRjb25zdCBleHRlbnNpb24gPSAnbXA0JzsgLy9yZWNvcmRpbmcudXJsPy5zcGxpdCgnLicpLnBvcCgpICB8fCAnbXA0JztcblxuXHRcdGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG5cdFx0bGluay5ocmVmID0gYC9yZWNvcmRpbmdzLyR7cmVjb3JkaW5nSWR9LyR7cmVjb3JkaW5nSWR9LiR7ZXh0ZW5zaW9ufWA7XG5cdFx0bGluay5kb3dubG9hZCA9IGAke3JlY29yZGluZ0lkfS4ke2V4dGVuc2lvbn1gO1xuXHRcdGxpbmsuZGlzcGF0Y2hFdmVudChcblx0XHRcdG5ldyBNb3VzZUV2ZW50KCdjbGljaycsIHtcblx0XHRcdFx0YnViYmxlczogdHJ1ZSxcblx0XHRcdFx0Y2FuY2VsYWJsZTogdHJ1ZSxcblx0XHRcdFx0dmlldzogd2luZG93XG5cdFx0XHR9KVxuXHRcdCk7XG5cblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdC8vIEZvciBGaXJlZm94IGl0IGlzIG5lY2Vzc2FyeSB0byBkZWxheSByZXZva2luZyB0aGUgT2JqZWN0VVJMXG5cdFx0XHRsaW5rLnJlbW92ZSgpO1xuXHRcdH0sIDEwMCk7XG5cdH1cblxuXHRwcml2YXRlIHN0YXJ0UmVjb3JkaW5nVGltZSgpIHtcblx0XHR0aGlzLnJlY29yZGluZ1RpbWUgPSBuZXcgRGF0ZSgpO1xuXHRcdHRoaXMucmVjb3JkaW5nVGltZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcblx0XHR0aGlzLnJlY29yZGluZ1RpbWVJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcblx0XHRcdHRoaXMucmVjb3JkaW5nVGltZS5zZXRTZWNvbmRzKHRoaXMucmVjb3JkaW5nVGltZS5nZXRTZWNvbmRzKCkgKyAxKTtcblx0XHRcdHRoaXMucmVjb3JkaW5nVGltZSA9IG5ldyBEYXRlKHRoaXMucmVjb3JkaW5nVGltZS5nZXRUaW1lKCkpO1xuXHRcdFx0dGhpcy5yZWNvcmRpbmdTdGF0dXMubmV4dCh7IGluZm86IHRoaXMuY3VycmVudFJlY29yZGluZywgdGltZTogdGhpcy5yZWNvcmRpbmdUaW1lIH0pO1xuXHRcdH0sIDEwMDApO1xuXHR9XG5cblx0cHJpdmF0ZSBzdG9wUmVjb3JkaW5nVGltZSgpIHtcblx0XHRjbGVhckludGVydmFsKHRoaXMucmVjb3JkaW5nVGltZUludGVydmFsKTtcblx0XHR0aGlzLnJlY29yZGluZ1RpbWUgPSBudWxsO1xuXHR9XG59XG4iXX0=