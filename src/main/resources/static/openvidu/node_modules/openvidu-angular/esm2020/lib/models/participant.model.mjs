import { VideoType } from './video-type.model';
/**
 * @internal
 */
export var OpenViduRole;
(function (OpenViduRole) {
    OpenViduRole["MODERATOR"] = "MODERATOR";
    OpenViduRole["PUBLISHER"] = "PUBLISHER";
})(OpenViduRole || (OpenViduRole = {}));
export class ParticipantAbstractModel {
    constructor(props, model) {
        this.streams = new Map();
        this.id = props.id ? props.id : new Date().getTime().toString();
        this.local = props.local;
        this.nickname = props.nickname;
        this.colorProfile = !!props.colorProfile ? props.colorProfile : `hsl(${Math.random() * 360}, 100%, 80%)`;
        this.isMutedForcibly = typeof props.isMutedForcibly === 'boolean' ? props.isMutedForcibly : false;
        let streamModel = {
            connected: model ? model.connected : true,
            type: model ? model.type : VideoType.CAMERA,
            streamManager: model ? model.streamManager : null,
            videoEnlarged: model ? model.videoEnlarged : false,
            connectionId: model ? model.connectionId : null,
            participant: this
        };
        this.streams.set(streamModel.type, streamModel);
    }
    /**
     * @internal
     */
    addConnection(streamModel) {
        streamModel.participant = this;
        this.streams.set(streamModel.type, streamModel);
    }
    /**
     * @internal
     */
    hasAudioActive() {
        const cameraConnection = this.getCameraConnection();
        const screenConnection = this.getScreenConnection();
        if (cameraConnection.connected) {
            return this.isCameraAudioActive();
        }
        else if (screenConnection.connected) {
            return this.isScreenAudioActive();
        }
        return false;
    }
    /**
     * @internal
     */
    isCameraAudioActive() {
        const cameraConnection = this.getCameraConnection();
        if (cameraConnection?.connected) {
            return cameraConnection.streamManager?.stream?.audioActive;
        }
        return false;
    }
    /**
     * @internal
     */
    isCameraVideoActive() {
        const cameraConnection = this.getCameraConnection();
        return cameraConnection?.connected && cameraConnection?.streamManager?.stream?.videoActive;
    }
    /**
     * @internal
     */
    isScreenAudioActive() {
        const screenConnection = this.getScreenConnection();
        if (screenConnection?.connected) {
            return screenConnection?.streamManager?.stream?.audioActive;
        }
        return false;
    }
    /**
     * @internal
     */
    hasConnectionType(type) {
        return this.streams.has(type);
    }
    /**
     * @internal
     */
    getCameraConnection() {
        return this.streams.get(VideoType.CAMERA);
    }
    /**
     * @internal
     */
    getScreenConnection() {
        return this.streams.get(VideoType.SCREEN);
    }
    /**
     * @internal
     */
    getConnectionTypesActive() {
        let connType = [];
        if (this.isCameraActive())
            connType.push(VideoType.CAMERA);
        if (this.isScreenActive())
            connType.push(VideoType.SCREEN);
        return connType;
    }
    /**
     * @internal
     */
    setCameraConnectionId(connectionId) {
        this.getCameraConnection().connectionId = connectionId;
    }
    /**
     * @internal
     */
    setScreenConnectionId(connectionId) {
        this.getScreenConnection().connectionId = connectionId;
    }
    /**
     * @internal
     */
    removeConnection(connectionId) {
        const removeStream = this.getConnectionById(connectionId);
        this.streams.delete(removeStream.type);
        return removeStream;
    }
    /**
     * @internal
     */
    hasConnectionId(connectionId) {
        return Array.from(this.streams.values()).some((conn) => conn.connectionId === connectionId);
    }
    /**
     * @internal
     */
    getConnectionById(connectionId) {
        return Array.from(this.streams.values()).find((conn) => conn.connectionId === connectionId);
    }
    /**
     * @internal
     */
    getAvailableConnections() {
        return Array.from(this.streams.values()).filter((conn) => conn.connected);
    }
    /**
     * @internal
     */
    isLocal() {
        return this.local;
        // return Array.from(this.streams.values()).every((conn) => conn.local);
    }
    /**
     * @internal
     */
    setNickname(nickname) {
        this.nickname = nickname;
    }
    /**
     * @internal
     */
    getNickname() {
        return this.nickname;
    }
    /**
     * @internal
     */
    setCameraPublisher(publisher) {
        const cameraConnection = this.getCameraConnection();
        if (cameraConnection)
            cameraConnection.streamManager = publisher;
    }
    /**
     * @internal
     */
    setScreenPublisher(publisher) {
        const screenConnection = this.getScreenConnection();
        if (screenConnection)
            screenConnection.streamManager = publisher;
    }
    /**
     * @internal
     */
    setPublisher(connType, publisher) {
        const connection = this.streams.get(connType);
        if (connection) {
            connection.streamManager = publisher;
        }
    }
    /**
     * @internal
     */
    isCameraActive() {
        return this.getCameraConnection()?.connected;
    }
    /**
     * @internal
     */
    enableCamera() {
        const cameraConnection = this.getCameraConnection();
        if (cameraConnection)
            cameraConnection.connected = true;
    }
    /**
     * @internal
     */
    disableCamera() {
        const cameraConnection = this.getCameraConnection();
        if (cameraConnection)
            cameraConnection.connected = false;
    }
    /**
     * @internal
     */
    isScreenActive() {
        return this.getScreenConnection()?.connected;
    }
    /**
     * @internal
     */
    enableScreen() {
        const screenConnection = this.getScreenConnection();
        if (screenConnection)
            screenConnection.connected = true;
    }
    /**
     * @internal
     */
    disableScreen() {
        const screenConnection = this.getScreenConnection();
        if (screenConnection)
            screenConnection.connected = false;
    }
    /**
     * @internal
     */
    setAllVideoEnlarged(enlarged) {
        this.streams.forEach((conn) => (conn.videoEnlarged = enlarged));
    }
    /**
     * @internal
     */
    setCameraEnlarged(enlarged) {
        this.streams.get(VideoType.CAMERA).videoEnlarged = enlarged;
    }
    /**
     * @internal
     */
    setScreenEnlarged(enlarged) {
        this.streams.get(VideoType.SCREEN).videoEnlarged = enlarged;
    }
    /**
     * @internal
     */
    toggleVideoEnlarged(connectionId) {
        this.streams.forEach((conn) => {
            if (conn.connectionId === connectionId) {
                conn.videoEnlarged = !conn.videoEnlarged;
            }
        });
    }
    /**
     * @internal
     */
    someHasVideoEnlarged() {
        return Array.from(this.streams.values()).some((conn) => conn.videoEnlarged);
    }
    /**
     * @internal
     */
    setMutedForcibly(muted) {
        this.isMutedForcibly = muted;
    }
    /**
     * @internal
     */
    getRole() {
        return this.streams.get(VideoType.CAMERA)?.streamManager?.stream?.connection?.role;
    }
}
/**
 * @internal
 */
export class ParticipantModel extends ParticipantAbstractModel {
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFydGljaXBhbnQubW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9vcGVudmlkdS1hbmd1bGFyL3NyYy9saWIvbW9kZWxzL3BhcnRpY2lwYW50Lm1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUUvQzs7R0FFRztBQUNILE1BQU0sQ0FBTixJQUFZLFlBR1g7QUFIRCxXQUFZLFlBQVk7SUFDdkIsdUNBQXVCLENBQUE7SUFDdkIsdUNBQXVCLENBQUE7QUFDeEIsQ0FBQyxFQUhXLFlBQVksS0FBWixZQUFZLFFBR3ZCO0FBb0RELE1BQU0sT0FBZ0Isd0JBQXdCO0lBUTdDLFlBQVksS0FBNEIsRUFBRSxLQUFtQjtRQVA3RCxZQUFPLEdBQWdDLElBQUksR0FBRyxFQUFFLENBQUM7UUFRaEQsSUFBSSxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hFLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7UUFDL0IsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxjQUFjLENBQUM7UUFDekcsSUFBSSxDQUFDLGVBQWUsR0FBRyxPQUFPLEtBQUssQ0FBQyxlQUFlLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxL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TUFBTSxPQUFPLGdCQUFpQixTQUFRLHdCQUF3QjtDQUFHIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHVibGlzaGVyLCBTdHJlYW1NYW5hZ2VyIH0gZnJvbSAnb3BlbnZpZHUtYnJvd3Nlcic7XG5pbXBvcnQgeyBWaWRlb1R5cGUgfSBmcm9tICcuL3ZpZGVvLXR5cGUubW9kZWwnO1xuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZW51bSBPcGVuVmlkdVJvbGUge1xuXHRNT0RFUkFUT1IgPSAnTU9ERVJBVE9SJyxcblx0UFVCTElTSEVSID0gJ1BVQkxJU0hFUidcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdHJlYW1Nb2RlbCB7XG5cdC8qKlxuXHQgKiBXaGV0aGVyIHRoZSBzdHJlYW0gaXMgYXZhaWxhYmxlIG9yIG5vdFxuXHQgKi9cblx0Y29ubmVjdGVkOiBib29sZWFuO1xuXHQvKipcblx0ICogVGhlIHN0cmVhbSB0eXBlLntAbGluayBWaWRlb1R5cGV9XG5cdCAqL1xuXHR0eXBlOiBWaWRlb1R5cGU7XG5cdC8qKlxuXHQgKiBUaGUgc3RyZWFtTWFuYWdlciBvYmplY3QgZnJvbSBvcGVudmlkdS1icm93c2VyIGxpYnJhcnkue0BsaW5rIGh0dHBzOi8vZG9jcy5vcGVudmlkdS5pby9lbi9zdGFibGUvYXBpL29wZW52aWR1LWJyb3dzZXIvY2xhc3Nlcy9TdHJlYW1NYW5hZ2VyLmh0bWx9XG5cdCAqL1xuXHRzdHJlYW1NYW5hZ2VyOiBTdHJlYW1NYW5hZ2VyO1xuXHQvKipcblx0ICogV2hldGhlciB0aGUgc3RyZWFtIGlzIGVubGFyZ2VkIG9yIG5vdFxuXHQgKi9cblx0dmlkZW9FbmxhcmdlZDogYm9vbGVhbjtcblx0LyoqXG5cdCAqIFVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBzdHJlYW1cblx0ICovXG5cdGNvbm5lY3Rpb25JZDogc3RyaW5nO1xuXHQvKipcblx0ICogVGhlIHBhcnRpY2lwYW50IG9iamVjdFxuXHQgKi9cblx0cGFydGljaXBhbnQ/OiBQYXJ0aWNpcGFudEFic3RyYWN0TW9kZWw7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFydGljaXBhbnRQcm9wZXJ0aWVzIHtcblx0LyoqXG5cdCAqIFdoZXRoZXIgdGhlIHBhcnRpY2lwYW50IGlzIGxvY2FsIG9yIG5vdFxuXHQgKi9cblx0bG9jYWw6IGJvb2xlYW47XG5cdC8qKlxuXHQgKiBUaGUgcGFydGljaXBhbnQgbmlja25hbWVcblx0ICovXG5cdG5pY2tuYW1lOiBzdHJpbmc7XG5cdC8qKlxuXHQgKiBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgcGFydGljaXBhbnRcblx0ICovXG5cdGlkPzogc3RyaW5nO1xuXHQvKipcblx0ICogVGhlIHBhcnRpY2lwYW50IGNvbG9yIHByb2ZpbGVcblx0ICovXG5cdGNvbG9yUHJvZmlsZT86IHN0cmluZztcblx0LyoqXG5cdCAqIFdoZXRoZXIgdGhlIHBhcnRpY2lwYW50IGlzIG11dGVkIGZvcmNpYmx5IG9yIG5vdFxuXHQgKi9cblx0aXNNdXRlZEZvcmNpYmx5PzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFBhcnRpY2lwYW50QWJzdHJhY3RNb2RlbCB7XG5cdHN0cmVhbXM6IE1hcDxWaWRlb1R5cGUsIFN0cmVhbU1vZGVsPiA9IG5ldyBNYXAoKTtcblx0aWQ6IHN0cmluZztcblx0bG9jYWw6IGJvb2xlYW47XG5cdG5pY2tuYW1lOiBzdHJpbmc7XG5cdGNvbG9yUHJvZmlsZTogc3RyaW5nO1xuXHRpc011dGVkRm9yY2libHk6IGJvb2xlYW47XG5cblx0Y29uc3RydWN0b3IocHJvcHM6IFBhcnRpY2lwYW50UHJvcGVydGllcywgbW9kZWw/OiBTdHJlYW1Nb2RlbCkge1xuXHRcdHRoaXMuaWQgPSBwcm9wcy5pZCA/IHByb3BzLmlkIDogbmV3IERhdGUoKS5nZXRUaW1lKCkudG9TdHJpbmcoKTtcblx0XHR0aGlzLmxvY2FsID0gcHJvcHMubG9jYWw7XG5cdFx0dGhpcy5uaWNrbmFtZSA9IHByb3BzLm5pY2tuYW1lO1xuXHRcdHRoaXMuY29sb3JQcm9maWxlID0gISFwcm9wcy5jb2xvclByb2ZpbGUgPyBwcm9wcy5jb2xvclByb2ZpbGUgOiBgaHNsKCR7TWF0aC5yYW5kb20oKSAqIDM2MH0sIDEwMCUsIDgwJSlgO1xuXHRcdHRoaXMuaXNNdXRlZEZvcmNpYmx5ID0gdHlwZW9mIHByb3BzLmlzTXV0ZWRGb3JjaWJseSA9PT0gJ2Jvb2xlYW4nID8gcHJvcHMuaXNNdXRlZEZvcmNpYmx5IDogZmFsc2U7XG5cdFx0bGV0IHN0cmVhbU1vZGVsOiBTdHJlYW1Nb2RlbCA9IHtcblx0XHRcdGNvbm5lY3RlZDogbW9kZWwgPyBtb2RlbC5jb25uZWN0ZWQgOiB0cnVlLFxuXHRcdFx0dHlwZTogbW9kZWwgPyBtb2RlbC50eXBlIDogVmlkZW9UeXBlLkNBTUVSQSxcblx0XHRcdHN0cmVhbU1hbmFnZXI6IG1vZGVsID8gbW9kZWwuc3RyZWFtTWFuYWdlciA6IG51bGwsXG5cdFx0XHR2aWRlb0VubGFyZ2VkOiBtb2RlbCA/IG1vZGVsLnZpZGVvRW5sYXJnZWQgOiBmYWxzZSxcblx0XHRcdGNvbm5lY3Rpb25JZDogbW9kZWwgPyBtb2RlbC5jb25uZWN0aW9uSWQgOiBudWxsLFxuXHRcdFx0cGFydGljaXBhbnQ6IHRoaXNcblx0XHR9O1xuXHRcdHRoaXMuc3RyZWFtcy5zZXQoc3RyZWFtTW9kZWwudHlwZSwgc3RyZWFtTW9kZWwpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi9cblx0YWRkQ29ubmVjdGlvbihzdHJlYW1Nb2RlbDogU3RyZWFtTW9kZWwpIHtcblx0XHRzdHJlYW1Nb2RlbC5wYXJ0aWNpcGFudCA9IHRoaXM7XG5cdFx0dGhpcy5zdHJlYW1zLnNldChzdHJlYW1Nb2RlbC50eXBlLCBzdHJlYW1Nb2RlbCk7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRoYXNBdWRpb0FjdGl2ZSgpOiBib29sZWFuIHtcblx0XHRjb25zdCBjYW1lcmFDb25uZWN0aW9uID0gdGhpcy5nZXRDYW1lcmFDb25uZWN0aW9uKCk7XG5cdFx0Y29uc3Qgc2NyZWVuQ29ubmVjdGlvbiA9IHRoaXMuZ2V0U2NyZWVuQ29ubmVjdGlvbigpO1xuXG5cdFx0aWYgKGNhbWVyYUNvbm5lY3Rpb24uY29ubmVjdGVkKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5pc0NhbWVyYUF1ZGlvQWN0aXZlKCk7XG5cdFx0fSBlbHNlIGlmIChzY3JlZW5Db25uZWN0aW9uLmNvbm5lY3RlZCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuaXNTY3JlZW5BdWRpb0FjdGl2ZSgpO1xuXHRcdH1cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRwcml2YXRlIGlzQ2FtZXJhQXVkaW9BY3RpdmUoKTogYm9vbGVhbiB7XG5cdFx0Y29uc3QgY2FtZXJhQ29ubmVjdGlvbiA9IHRoaXMuZ2V0Q2FtZXJhQ29ubmVjdGlvbigpO1xuXHRcdGlmIChjYW1lcmFDb25uZWN0aW9uPy5jb25uZWN0ZWQpIHtcblx0XHRcdHJldHVybiBjYW1lcmFDb25uZWN0aW9uLnN0cmVhbU1hbmFnZXI/LnN0cmVhbT8uYXVkaW9BY3RpdmU7XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHB1YmxpYyBpc0NhbWVyYVZpZGVvQWN0aXZlKCk6IGJvb2xlYW4ge1xuXHRcdGNvbnN0IGNhbWVyYUNvbm5lY3Rpb24gPSB0aGlzLmdldENhbWVyYUNvbm5lY3Rpb24oKTtcblx0XHRyZXR1cm4gY2FtZXJhQ29ubmVjdGlvbj8uY29ubmVjdGVkICYmIGNhbWVyYUNvbm5lY3Rpb24/LnN0cmVhbU1hbmFnZXI/LnN0cmVhbT8udmlkZW9BY3RpdmU7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRpc1NjcmVlbkF1ZGlvQWN0aXZlKCk6IGJvb2xlYW4ge1xuXHRcdGNvbnN0IHNjcmVlbkNvbm5lY3Rpb24gPSB0aGlzLmdldFNjcmVlbkNvbm5lY3Rpb24oKTtcblx0XHRpZiAoc2NyZWVuQ29ubmVjdGlvbj8uY29ubmVjdGVkKSB7XG5cdFx0XHRyZXR1cm4gc2NyZWVuQ29ubmVjdGlvbj8uc3RyZWFtTWFuYWdlcj8uc3RyZWFtPy5hdWRpb0FjdGl2ZTtcblx0XHR9XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi9cblx0aGFzQ29ubmVjdGlvblR5cGUodHlwZTogVmlkZW9UeXBlKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuc3RyZWFtcy5oYXModHlwZSk7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRwdWJsaWMgZ2V0Q2FtZXJhQ29ubmVjdGlvbigpOiBTdHJlYW1Nb2RlbCB7XG5cdFx0cmV0dXJuIHRoaXMuc3RyZWFtcy5nZXQoVmlkZW9UeXBlLkNBTUVSQSk7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRwdWJsaWMgZ2V0U2NyZWVuQ29ubmVjdGlvbigpOiBTdHJlYW1Nb2RlbCB7XG5cdFx0cmV0dXJuIHRoaXMuc3RyZWFtcy5nZXQoVmlkZW9UeXBlLlNDUkVFTik7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRnZXRDb25uZWN0aW9uVHlwZXNBY3RpdmUoKTogVmlkZW9UeXBlW10ge1xuXHRcdGxldCBjb25uVHlwZSA9IFtdO1xuXHRcdGlmICh0aGlzLmlzQ2FtZXJhQWN0aXZlKCkpIGNvbm5UeXBlLnB1c2goVmlkZW9UeXBlLkNBTUVSQSk7XG5cdFx0aWYgKHRoaXMuaXNTY3JlZW5BY3RpdmUoKSkgY29ublR5cGUucHVzaChWaWRlb1R5cGUuU0NSRUVOKTtcblxuXHRcdHJldHVybiBjb25uVHlwZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHNldENhbWVyYUNvbm5lY3Rpb25JZChjb25uZWN0aW9uSWQ6IHN0cmluZykge1xuXHRcdHRoaXMuZ2V0Q2FtZXJhQ29ubmVjdGlvbigpLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHNldFNjcmVlbkNvbm5lY3Rpb25JZChjb25uZWN0aW9uSWQ6IHN0cmluZykge1xuXHRcdHRoaXMuZ2V0U2NyZWVuQ29ubmVjdGlvbigpLmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHJlbW92ZUNvbm5lY3Rpb24oY29ubmVjdGlvbklkOiBzdHJpbmcpOiBTdHJlYW1Nb2RlbCB7XG5cdFx0Y29uc3QgcmVtb3ZlU3RyZWFtID0gdGhpcy5nZXRDb25uZWN0aW9uQnlJZChjb25uZWN0aW9uSWQpO1xuXHRcdHRoaXMuc3RyZWFtcy5kZWxldGUocmVtb3ZlU3RyZWFtLnR5cGUpO1xuXHRcdHJldHVybiByZW1vdmVTdHJlYW07XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRoYXNDb25uZWN0aW9uSWQoY29ubmVjdGlvbklkOiBzdHJpbmcpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnN0cmVhbXMudmFsdWVzKCkpLnNvbWUoKGNvbm4pID0+IGNvbm4uY29ubmVjdGlvbklkID09PSBjb25uZWN0aW9uSWQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi9cblx0Z2V0Q29ubmVjdGlvbkJ5SWQoY29ubmVjdGlvbklkOiBzdHJpbmcpOiBTdHJlYW1Nb2RlbCB7XG5cdFx0cmV0dXJuIEFycmF5LmZyb20odGhpcy5zdHJlYW1zLnZhbHVlcygpKS5maW5kKChjb25uKSA9PiBjb25uLmNvbm5lY3Rpb25JZCA9PT0gY29ubmVjdGlvbklkKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdGdldEF2YWlsYWJsZUNvbm5lY3Rpb25zKCk6IFN0cmVhbU1vZGVsW10ge1xuXHRcdHJldHVybiBBcnJheS5mcm9tKHRoaXMuc3RyZWFtcy52YWx1ZXMoKSkuZmlsdGVyKChjb25uKSA9PiBjb25uLmNvbm5lY3RlZCk7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRpc0xvY2FsKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLmxvY2FsO1xuXHRcdC8vIHJldHVybiBBcnJheS5mcm9tKHRoaXMuc3RyZWFtcy52YWx1ZXMoKSkuZXZlcnkoKGNvbm4pID0+IGNvbm4ubG9jYWwpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi9cblx0c2V0Tmlja25hbWUobmlja25hbWU6IHN0cmluZykge1xuXHRcdHRoaXMubmlja25hbWUgPSBuaWNrbmFtZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdGdldE5pY2tuYW1lKCkge1xuXHRcdHJldHVybiB0aGlzLm5pY2tuYW1lO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi9cblx0c2V0Q2FtZXJhUHVibGlzaGVyKHB1Ymxpc2hlcjogUHVibGlzaGVyKSB7XG5cdFx0Y29uc3QgY2FtZXJhQ29ubmVjdGlvbiA9IHRoaXMuZ2V0Q2FtZXJhQ29ubmVjdGlvbigpO1xuXHRcdGlmIChjYW1lcmFDb25uZWN0aW9uKSBjYW1lcmFDb25uZWN0aW9uLnN0cmVhbU1hbmFnZXIgPSBwdWJsaXNoZXI7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRzZXRTY3JlZW5QdWJsaXNoZXIocHVibGlzaGVyOiBQdWJsaXNoZXIpIHtcblx0XHRjb25zdCBzY3JlZW5Db25uZWN0aW9uID0gdGhpcy5nZXRTY3JlZW5Db25uZWN0aW9uKCk7XG5cdFx0aWYgKHNjcmVlbkNvbm5lY3Rpb24pIHNjcmVlbkNvbm5lY3Rpb24uc3RyZWFtTWFuYWdlciA9IHB1Ymxpc2hlcjtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHNldFB1Ymxpc2hlcihjb25uVHlwZTogVmlkZW9UeXBlLCBwdWJsaXNoZXI6IFN0cmVhbU1hbmFnZXIpIHtcblx0XHRjb25zdCBjb25uZWN0aW9uID0gdGhpcy5zdHJlYW1zLmdldChjb25uVHlwZSk7XG5cdFx0aWYgKGNvbm5lY3Rpb24pIHtcblx0XHRcdGNvbm5lY3Rpb24uc3RyZWFtTWFuYWdlciA9IHB1Ymxpc2hlcjtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRpc0NhbWVyYUFjdGl2ZSgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5nZXRDYW1lcmFDb25uZWN0aW9uKCk/LmNvbm5lY3RlZDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdGVuYWJsZUNhbWVyYSgpIHtcblx0XHRjb25zdCBjYW1lcmFDb25uZWN0aW9uID0gdGhpcy5nZXRDYW1lcmFDb25uZWN0aW9uKCk7XG5cdFx0aWYgKGNhbWVyYUNvbm5lY3Rpb24pIGNhbWVyYUNvbm5lY3Rpb24uY29ubmVjdGVkID0gdHJ1ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdGRpc2FibGVDYW1lcmEoKSB7XG5cdFx0Y29uc3QgY2FtZXJhQ29ubmVjdGlvbiA9IHRoaXMuZ2V0Q2FtZXJhQ29ubmVjdGlvbigpO1xuXHRcdGlmIChjYW1lcmFDb25uZWN0aW9uKSBjYW1lcmFDb25uZWN0aW9uLmNvbm5lY3RlZCA9IGZhbHNlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi9cblx0aXNTY3JlZW5BY3RpdmUoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuZ2V0U2NyZWVuQ29ubmVjdGlvbigpPy5jb25uZWN0ZWQ7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRlbmFibGVTY3JlZW4oKSB7XG5cdFx0Y29uc3Qgc2NyZWVuQ29ubmVjdGlvbiA9IHRoaXMuZ2V0U2NyZWVuQ29ubmVjdGlvbigpO1xuXHRcdGlmIChzY3JlZW5Db25uZWN0aW9uKSBzY3JlZW5Db25uZWN0aW9uLmNvbm5lY3RlZCA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRkaXNhYmxlU2NyZWVuKCkge1xuXHRcdGNvbnN0IHNjcmVlbkNvbm5lY3Rpb24gPSB0aGlzLmdldFNjcmVlbkNvbm5lY3Rpb24oKTtcblx0XHRpZiAoc2NyZWVuQ29ubmVjdGlvbikgc2NyZWVuQ29ubmVjdGlvbi5jb25uZWN0ZWQgPSBmYWxzZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHNldEFsbFZpZGVvRW5sYXJnZWQoZW5sYXJnZWQ6IGJvb2xlYW4pIHtcblx0XHR0aGlzLnN0cmVhbXMuZm9yRWFjaCgoY29ubikgPT4gKGNvbm4udmlkZW9FbmxhcmdlZCA9IGVubGFyZ2VkKSk7XG5cdH1cblxuXHQvKipcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRzZXRDYW1lcmFFbmxhcmdlZChlbmxhcmdlZDogYm9vbGVhbikge1xuXHRcdHRoaXMuc3RyZWFtcy5nZXQoVmlkZW9UeXBlLkNBTUVSQSkudmlkZW9FbmxhcmdlZCA9IGVubGFyZ2VkO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi9cblx0c2V0U2NyZWVuRW5sYXJnZWQoZW5sYXJnZWQ6IGJvb2xlYW4pIHtcblx0XHR0aGlzLnN0cmVhbXMuZ2V0KFZpZGVvVHlwZS5TQ1JFRU4pLnZpZGVvRW5sYXJnZWQgPSBlbmxhcmdlZDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHRvZ2dsZVZpZGVvRW5sYXJnZWQoY29ubmVjdGlvbklkOiBzdHJpbmcpIHtcblx0XHR0aGlzLnN0cmVhbXMuZm9yRWFjaCgoY29ubikgPT4ge1xuXHRcdFx0aWYgKGNvbm4uY29ubmVjdGlvbklkID09PSBjb25uZWN0aW9uSWQpIHtcblx0XHRcdFx0Y29ubi52aWRlb0VubGFyZ2VkID0gIWNvbm4udmlkZW9FbmxhcmdlZDtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHNvbWVIYXNWaWRlb0VubGFyZ2VkKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiBBcnJheS5mcm9tKHRoaXMuc3RyZWFtcy52YWx1ZXMoKSkuc29tZSgoY29ubikgPT4gY29ubi52aWRlb0VubGFyZ2VkKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHNldE11dGVkRm9yY2libHkobXV0ZWQ6IGJvb2xlYW4pIHtcblx0XHR0aGlzLmlzTXV0ZWRGb3JjaWJseSA9IG11dGVkO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi9cblx0Z2V0Um9sZSgpOiBPcGVuVmlkdVJvbGUge1xuXHRcdHJldHVybiA8T3BlblZpZHVSb2xlPnRoaXMuc3RyZWFtcy5nZXQoVmlkZW9UeXBlLkNBTUVSQSk/LnN0cmVhbU1hbmFnZXI/LnN0cmVhbT8uY29ubmVjdGlvbj8ucm9sZTtcblx0fVxufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgY2xhc3MgUGFydGljaXBhbnRNb2RlbCBleHRlbmRzIFBhcnRpY2lwYW50QWJzdHJhY3RNb2RlbCB7fVxuIl19