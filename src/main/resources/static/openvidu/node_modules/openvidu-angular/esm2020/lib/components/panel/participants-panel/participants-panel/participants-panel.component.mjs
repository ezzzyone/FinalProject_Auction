import { ChangeDetectionStrategy, Component, ContentChild, TemplateRef, ViewChild } from '@angular/core';
import { ParticipantPanelItemDirective } from '../../../../directives/template/openvidu-angular.directive';
import * as i0 from "@angular/core";
import * as i1 from "../../../../services/participant/participant.service";
import * as i2 from "../../../..//services/panel/panel.service";
import * as i3 from "@angular/common";
import * as i4 from "@angular/material/button";
import * as i5 from "@angular/material/icon";
import * as i6 from "@angular/material/tooltip";
import * as i7 from "@angular/material/divider";
import * as i8 from "../participant-panel-item/participant-panel-item.component";
import * as i9 from "../../../../pipes/translate.pipe";
/**
 *
 * The **ParticipantsPanelComponent** is hosted inside of the {@link PanelComponent}.
 * It is in charge of displaying the participants connected to the session.
 * This component is composed by the {@link ParticipantPanelItemComponent}.
 *
 * <div class="custom-table-container">
 * <div>
 *
 * <h3>OpenVidu Angular Directives</h3>
 *
 * The ParticipantsPanelComponent can be replaced with a custom component. It provides us the following {@link https://angular.io/guide/structural-directives Angular structural directives}
 * for doing this.
 *
 * |            **Directive**           |                 **Reference**                 |
 * |:----------------------------------:|:---------------------------------------------:|
 * |       ***ovParticipantsPanel**      |       {@link ParticipantsPanelDirective}      |
 *
 * </br>
 *
 * As the ParticipantsPanelComponent is composed by ParticipantPanelItemComponent, it is also providing us a way to **replace the participant item** with a custom one.
 * It will recognise the following directive in a child element.
 *
 * |            **Directive**           |                 **Reference**                 |
 * |:----------------------------------:|:---------------------------------------------:|
 * |     ***ovParticipantPanelItem**     |     {@link ParticipantPanelItemDirective}     |
 *
 * <p class="component-link-text">
 * 	<span class="italic">See all {@link OpenViduAngularDirectiveModule OpenVidu Angular Directives}</span>
 * </p>
 * </div>
 * </div>
 */
export class ParticipantsPanelComponent {
    /**
     * @ignore
     */
    constructor(participantService, panelService, cd) {
        this.participantService = participantService;
        this.panelService = panelService;
        this.cd = cd;
        this.remoteParticipants = [];
    }
    set externalParticipantPanelItem(externalParticipantPanelItem) {
        // This directive will has value only when PARTICIPANT PANEL ITEM component tagged with '*ovParticipantPanelItem'
        // is inside of the PARTICIPANTS PANEL component tagged with '*ovParticipantsPanel'
        if (externalParticipantPanelItem) {
            this.participantPanelItemTemplate = externalParticipantPanelItem.template;
        }
    }
    ngOnInit() {
        this.localParticipantSubs = this.participantService.localParticipantObs.subscribe((p) => {
            this.localParticipant = p;
            // Mark for re-rendering using an impure pipe 'streamsTypesEnabled'
            this.cd.markForCheck();
        });
        this.remoteParticipantsSubs = this.participantService.remoteParticipantsObs.subscribe((p) => {
            // Workaround which forc the objects references update
            // After one entirely day trying to make it works, this is the only way
            const remoteParticipantsAux = [];
            p.forEach((par) => {
                remoteParticipantsAux.push(Object.create(par));
            });
            this.remoteParticipants = remoteParticipantsAux;
            // Mark for re-rendering using an impure pipe 'streamsTypesEnabled'
            this.cd.markForCheck();
        });
    }
    ngOnDestroy() {
        if (this.localParticipantSubs)
            this.localParticipantSubs.unsubscribe();
        if (this.remoteParticipantsSubs)
            this.remoteParticipantsSubs.unsubscribe;
    }
    ngAfterViewInit() {
        if (!this.participantPanelItemTemplate) {
            // the user has override the default participants panel but not the 'participant-panel-item'
            // so the default component must be injected
            this.participantPanelItemTemplate = this.defaultParticipantPanelItemTemplate;
            this.cd.detectChanges();
        }
    }
    close() {
        this.panelService.closePanel();
    }
}
ParticipantsPanelComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: ParticipantsPanelComponent, deps: [{ token: i1.ParticipantService }, { token: i2.PanelService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
ParticipantsPanelComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.8", type: ParticipantsPanelComponent, selector: "ov-participants-panel", queries: [{ propertyName: "participantPanelItemTemplate", first: true, predicate: ["participantPanelItem"], descendants: true, read: TemplateRef }, { propertyName: "externalParticipantPanelItem", first: true, predicate: ParticipantPanelItemDirective, descendants: true }], viewQueries: [{ propertyName: "defaultParticipantPanelItemTemplate", first: true, predicate: ["defaultParticipantPanelItem"], descendants: true, read: TemplateRef }], ngImport: i0, template: "<div class=\"panel-container\" id=\"participants-container\">\n\t<div class=\"panel-header-container\">\n\t\t<h3 class=\"panel-title\">{{ 'PANEL.PARTICIPANTS.TITLE' | translate }}</h3>\n\t\t<button class=\"panel-close-button\" mat-icon-button matTooltip=\"{{ 'PANEL.CLOSE' | translate }}\" (click)=\"close()\">\n\t\t\t<mat-icon>close</mat-icon>\n\t\t</button>\n\t</div>\n\n\t<div class=\"scrollable\">\n\n\t\t<div class=\"local-participant-container\" *ngIf=\"localParticipant\">\n\t\t\t<ng-container *ngTemplateOutlet=\"participantPanelItemTemplate; context: { $implicit: localParticipant }\"></ng-container>\n\t\t\t<mat-divider *ngIf=\"true\"></mat-divider>\n\t\t</div>\n\n\t\t<div class=\"remote-participants-container\" id=\"remote-participants-container\" *ngIf=\"remoteParticipants.length > 0\">\n\n\t\t\t<div *ngFor=\"let participant of this.remoteParticipants\" id=\"remote-participant-item\">\n\t\t\t\t<ng-container *ngTemplateOutlet=\"participantPanelItemTemplate; context: { $implicit: participant }\"></ng-container>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<ng-template #defaultParticipantPanelItem let-participant>\n\t<ov-participant-panel-item [participant]=\"participant\" id=\"default-participant-panel-item\"></ov-participant-panel-item>\n</ng-template>\n", styles: [".panel-container{margin:20px;background-color:var(--ov-panel-background);border-radius:var(--ov-panel-radius);max-height:calc(100% - 40px);min-height:calc(100% - 40px)}.panel-header-container{padding:10px;display:flex}.panel-title{margin-left:5px;margin-top:auto;margin-bottom:auto}.panel-close-button{margin-left:auto;border-radius:var(--ov-buttons-radius)}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-thumb{background:#a7a7a7;border-radius:4px}::-webkit-scrollbar-thumb:hover{background:#7c7c7c}::-webkit-scrollbar-track{background:var(--ov-light-color);border-radius:4px}\n", ".local-participant-container,.remote-participants-container{margin:5px 10px}.scrollable{height:calc(100% - 60px);max-height:calc(100% - 60px);overflow:auto}.message-container{padding:5px;background-color:var(--ov-light-color);color:var(--ov-panel-text-color);text-align:center;margin:5px;font-size:12px}.message-container p{margin:0}\n"], dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: i4.MatButton, selector: "button[mat-button], button[mat-raised-button], button[mat-icon-button],             button[mat-fab], button[mat-mini-fab], button[mat-stroked-button],             button[mat-flat-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "component", type: i5.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "directive", type: i6.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }, { kind: "component", type: i7.MatDivider, selector: "mat-divider", inputs: ["vertical", "inset"] }, { kind: "component", type: i8.ParticipantPanelItemComponent, selector: "ov-participant-panel-item", inputs: ["participant"] }, { kind: "pipe", type: i9.TranslatePipe, name: "translate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.8", ngImport: i0, type: ParticipantsPanelComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ov-participants-panel', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"panel-container\" id=\"participants-container\">\n\t<div class=\"panel-header-container\">\n\t\t<h3 class=\"panel-title\">{{ 'PANEL.PARTICIPANTS.TITLE' | translate }}</h3>\n\t\t<button class=\"panel-close-button\" mat-icon-button matTooltip=\"{{ 'PANEL.CLOSE' | translate }}\" (click)=\"close()\">\n\t\t\t<mat-icon>close</mat-icon>\n\t\t</button>\n\t</div>\n\n\t<div class=\"scrollable\">\n\n\t\t<div class=\"local-participant-container\" *ngIf=\"localParticipant\">\n\t\t\t<ng-container *ngTemplateOutlet=\"participantPanelItemTemplate; context: { $implicit: localParticipant }\"></ng-container>\n\t\t\t<mat-divider *ngIf=\"true\"></mat-divider>\n\t\t</div>\n\n\t\t<div class=\"remote-participants-container\" id=\"remote-participants-container\" *ngIf=\"remoteParticipants.length > 0\">\n\n\t\t\t<div *ngFor=\"let participant of this.remoteParticipants\" id=\"remote-participant-item\">\n\t\t\t\t<ng-container *ngTemplateOutlet=\"participantPanelItemTemplate; context: { $implicit: participant }\"></ng-container>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<ng-template #defaultParticipantPanelItem let-participant>\n\t<ov-participant-panel-item [participant]=\"participant\" id=\"default-participant-panel-item\"></ov-participant-panel-item>\n</ng-template>\n", styles: [".panel-container{margin:20px;background-color:var(--ov-panel-background);border-radius:var(--ov-panel-radius);max-height:calc(100% - 40px);min-height:calc(100% - 40px)}.panel-header-container{padding:10px;display:flex}.panel-title{margin-left:5px;margin-top:auto;margin-bottom:auto}.panel-close-button{margin-left:auto;border-radius:var(--ov-buttons-radius)}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-thumb{background:#a7a7a7;border-radius:4px}::-webkit-scrollbar-thumb:hover{background:#7c7c7c}::-webkit-scrollbar-track{background:var(--ov-light-color);border-radius:4px}\n", ".local-participant-container,.remote-participants-container{margin:5px 10px}.scrollable{height:calc(100% - 60px);max-height:calc(100% - 60px);overflow:auto}.message-container{padding:5px;background-color:var(--ov-light-color);color:var(--ov-panel-text-color);text-align:center;margin:5px;font-size:12px}.message-container p{margin:0}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ParticipantService }, { type: i2.PanelService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { defaultParticipantPanelItemTemplate: [{
                type: ViewChild,
                args: ['defaultParticipantPanelItem', { static: false, read: TemplateRef }]
            }], participantPanelItemTemplate: [{
                type: ContentChild,
                args: ['participantPanelItem', { read: TemplateRef }]
            }], externalParticipantPanelItem: [{
                type: ContentChild,
                args: [ParticipantPanelItemDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFydGljaXBhbnRzLXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL29wZW52aWR1LWFuZ3VsYXIvc3JjL2xpYi9jb21wb25lbnRzL3BhbmVsL3BhcnRpY2lwYW50cy1wYW5lbC9wYXJ0aWNpcGFudHMtcGFuZWwvcGFydGljaXBhbnRzLXBhbmVsLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL29wZW52aWR1LWFuZ3VsYXIvc3JjL2xpYi9jb21wb25lbnRzL3BhbmVsL3BhcnRpY2lwYW50cy1wYW5lbC9wYXJ0aWNpcGFudHMtcGFuZWwvcGFydGljaXBhbnRzLXBhbmVsLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBaUIsdUJBQXVCLEVBQXFCLFNBQVMsRUFBRSxZQUFZLEVBQXFCLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFJOUosT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sNERBQTRELENBQUM7Ozs7Ozs7Ozs7O0FBRzNHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQWdDRztBQU9ILE1BQU0sT0FBTywwQkFBMEI7SUEwQnRDOztPQUVHO0lBQ0gsWUFDVyxrQkFBc0MsRUFDdEMsWUFBMEIsRUFDNUIsRUFBcUI7UUFGbkIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUN0QyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUM1QixPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQTlCOUIsdUJBQWtCLEdBQStCLEVBQUUsQ0FBQztJQStCakQsQ0FBQztJQW5CSixJQUNJLDRCQUE0QixDQUFDLDRCQUEyRDtRQUMzRixpSEFBaUg7UUFDakgsbUZBQW1GO1FBQ25GLElBQUksNEJBQTRCLEVBQUU7WUFDakMsSUFBSSxDQUFDLDRCQUE0QixHQUFHLDRCQUE0QixDQUFDLFFBQVEsQ0FBQztTQUMxRTtJQUNGLENBQUM7SUFjRCxRQUFRO1FBQ1AsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUEyQixFQUFFLEVBQUU7WUFDakgsSUFBSSxDQUFDLGdCQUFnQixHQUFHLENBQUMsQ0FBQztZQUMxQixtRUFBbUU7WUFDbkUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxzQkFBc0IsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMscUJBQXFCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBNkIsRUFBRSxFQUFFO1lBQ3ZILHNEQUFzRDtZQUN0RCx1RUFBdUU7WUFDdkUsTUFBTSxxQkFBcUIsR0FBRyxFQUFFLENBQUM7WUFDakMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO2dCQUNqQixxQkFBcUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2hELENBQUMsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLGtCQUFrQixHQUFHLHFCQUFxQixDQUFDO1lBQ2hELG1FQUFtRTtZQUNuRSxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVELFdBQVc7UUFDVixJQUFJLElBQUksQ0FBQyxvQkFBb0I7WUFBRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDdkUsSUFBSSxJQUFJLENBQUMsc0JBQXNCO1lBQUUsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFdBQVcsQ0FBQztJQUMxRSxDQUFDO0lBRUQsZUFBZTtRQUNkLElBQUcsQ0FBQyxJQUFJLENBQUMsNEJBQTRCLEVBQUU7WUFDdEMsNEZBQTRGO1lBQzVGLDRDQUE0QztZQUM1QyxJQUFJLENBQUMsNEJBQTRCLEdBQUcsSUFBSSxDQUFDLG1DQUFtQyxDQUFBO1lBQzVFLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDeEI7SUFDRixDQUFDO0lBRUQsS0FBSztRQUNKLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDaEMsQ0FBQzs7dUhBdkVXLDBCQUEwQjsyR0FBMUIsMEJBQTBCLDBLQVlRLFdBQVcsNEVBRTNDLDZCQUE2QiwrS0FQc0IsV0FBVyw2QkNyRDdFLGl3Q0EyQkE7MkZEbUJhLDBCQUEwQjtrQkFOdEMsU0FBUzsrQkFDQyx1QkFBdUIsbUJBR2hCLHVCQUF1QixDQUFDLE1BQU07b0tBU2lDLG1DQUFtQztzQkFBbEgsU0FBUzt1QkFBQyw2QkFBNkIsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRTtnQkFLakIsNEJBQTRCO3NCQUF4RixZQUFZO3VCQUFDLHNCQUFzQixFQUFFLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRTtnQkFHdkQsNEJBQTRCO3NCQUQvQixZQUFZO3VCQUFDLDZCQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb250ZW50Q2hpbGQsIE9uRGVzdHJveSwgT25Jbml0LCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQYXJ0aWNpcGFudEFic3RyYWN0TW9kZWwgfSBmcm9tICcuLi8uLi8uLi8uLi9tb2RlbHMvcGFydGljaXBhbnQubW9kZWwnO1xuaW1wb3J0IHsgUGFydGljaXBhbnRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2VydmljZXMvcGFydGljaXBhbnQvcGFydGljaXBhbnQuc2VydmljZSc7XG5pbXBvcnQgeyBQYW5lbFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi8vc2VydmljZXMvcGFuZWwvcGFuZWwuc2VydmljZSc7XG5pbXBvcnQgeyBQYXJ0aWNpcGFudFBhbmVsSXRlbURpcmVjdGl2ZSB9IGZyb20gJy4uLy4uLy4uLy4uL2RpcmVjdGl2ZXMvdGVtcGxhdGUvb3BlbnZpZHUtYW5ndWxhci5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbi8qKlxuICpcbiAqIFRoZSAqKlBhcnRpY2lwYW50c1BhbmVsQ29tcG9uZW50KiogaXMgaG9zdGVkIGluc2lkZSBvZiB0aGUge0BsaW5rIFBhbmVsQ29tcG9uZW50fS5cbiAqIEl0IGlzIGluIGNoYXJnZSBvZiBkaXNwbGF5aW5nIHRoZSBwYXJ0aWNpcGFudHMgY29ubmVjdGVkIHRvIHRoZSBzZXNzaW9uLlxuICogVGhpcyBjb21wb25lbnQgaXMgY29tcG9zZWQgYnkgdGhlIHtAbGluayBQYXJ0aWNpcGFudFBhbmVsSXRlbUNvbXBvbmVudH0uXG4gKlxuICogPGRpdiBjbGFzcz1cImN1c3RvbS10YWJsZS1jb250YWluZXJcIj5cbiAqIDxkaXY+XG4gKlxuICogPGgzPk9wZW5WaWR1IEFuZ3VsYXIgRGlyZWN0aXZlczwvaDM+XG4gKlxuICogVGhlIFBhcnRpY2lwYW50c1BhbmVsQ29tcG9uZW50IGNhbiBiZSByZXBsYWNlZCB3aXRoIGEgY3VzdG9tIGNvbXBvbmVudC4gSXQgcHJvdmlkZXMgdXMgdGhlIGZvbGxvd2luZyB7QGxpbmsgaHR0cHM6Ly9hbmd1bGFyLmlvL2d1aWRlL3N0cnVjdHVyYWwtZGlyZWN0aXZlcyBBbmd1bGFyIHN0cnVjdHVyYWwgZGlyZWN0aXZlc31cbiAqIGZvciBkb2luZyB0aGlzLlxuICpcbiAqIHwgICAgICAgICAgICAqKkRpcmVjdGl2ZSoqICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAqKlJlZmVyZW5jZSoqICAgICAgICAgICAgICAgICB8XG4gKiB8Oi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS06fDotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS06fFxuICogfCAgICAgICAqKipvdlBhcnRpY2lwYW50c1BhbmVsKiogICAgICB8ICAgICAgIHtAbGluayBQYXJ0aWNpcGFudHNQYW5lbERpcmVjdGl2ZX0gICAgICB8XG4gKlxuICogPC9icj5cbiAqXG4gKiBBcyB0aGUgUGFydGljaXBhbnRzUGFuZWxDb21wb25lbnQgaXMgY29tcG9zZWQgYnkgUGFydGljaXBhbnRQYW5lbEl0ZW1Db21wb25lbnQsIGl0IGlzIGFsc28gcHJvdmlkaW5nIHVzIGEgd2F5IHRvICoqcmVwbGFjZSB0aGUgcGFydGljaXBhbnQgaXRlbSoqIHdpdGggYSBjdXN0b20gb25lLlxuICogSXQgd2lsbCByZWNvZ25pc2UgdGhlIGZvbGxvd2luZyBkaXJlY3RpdmUgaW4gYSBjaGlsZCBlbGVtZW50LlxuICpcbiAqIHwgICAgICAgICAgICAqKkRpcmVjdGl2ZSoqICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAqKlJlZmVyZW5jZSoqICAgICAgICAgICAgICAgICB8XG4gKiB8Oi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS06fDotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS06fFxuICogfCAgICAgKioqb3ZQYXJ0aWNpcGFudFBhbmVsSXRlbSoqICAgICB8ICAgICB7QGxpbmsgUGFydGljaXBhbnRQYW5lbEl0ZW1EaXJlY3RpdmV9ICAgICB8XG4gKlxuICogPHAgY2xhc3M9XCJjb21wb25lbnQtbGluay10ZXh0XCI+XG4gKiBcdDxzcGFuIGNsYXNzPVwiaXRhbGljXCI+U2VlIGFsbCB7QGxpbmsgT3BlblZpZHVBbmd1bGFyRGlyZWN0aXZlTW9kdWxlIE9wZW5WaWR1IEFuZ3VsYXIgRGlyZWN0aXZlc308L3NwYW4+XG4gKiA8L3A+XG4gKiA8L2Rpdj5cbiAqIDwvZGl2PlxuICovXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6ICdvdi1wYXJ0aWNpcGFudHMtcGFuZWwnLFxuXHR0ZW1wbGF0ZVVybDogJy4vcGFydGljaXBhbnRzLXBhbmVsLmNvbXBvbmVudC5odG1sJyxcblx0c3R5bGVVcmxzOiBbJy4uLy4uL3BhbmVsLmNvbXBvbmVudC5jc3MnLCcuL3BhcnRpY2lwYW50cy1wYW5lbC5jb21wb25lbnQuY3NzJ10sXG5cdGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFBhcnRpY2lwYW50c1BhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQge1xuXHRsb2NhbFBhcnRpY2lwYW50OiBhbnk7XG5cdHJlbW90ZVBhcnRpY2lwYW50czogUGFydGljaXBhbnRBYnN0cmFjdE1vZGVsW10gPSBbXTtcblxuXHQvKipcblx0ICogQGlnbm9yZVxuXHQgKi9cblx0QFZpZXdDaGlsZCgnZGVmYXVsdFBhcnRpY2lwYW50UGFuZWxJdGVtJywgeyBzdGF0aWM6IGZhbHNlLCByZWFkOiBUZW1wbGF0ZVJlZiB9KSBkZWZhdWx0UGFydGljaXBhbnRQYW5lbEl0ZW1UZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuXHQvKipcblx0ICogQGlnbm9yZVxuXHQgKi9cblx0QENvbnRlbnRDaGlsZCgncGFydGljaXBhbnRQYW5lbEl0ZW0nLCB7IHJlYWQ6IFRlbXBsYXRlUmVmIH0pIHBhcnRpY2lwYW50UGFuZWxJdGVtVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG5cblx0QENvbnRlbnRDaGlsZChQYXJ0aWNpcGFudFBhbmVsSXRlbURpcmVjdGl2ZSlcblx0c2V0IGV4dGVybmFsUGFydGljaXBhbnRQYW5lbEl0ZW0oZXh0ZXJuYWxQYXJ0aWNpcGFudFBhbmVsSXRlbTogUGFydGljaXBhbnRQYW5lbEl0ZW1EaXJlY3RpdmUpIHtcblx0XHQvLyBUaGlzIGRpcmVjdGl2ZSB3aWxsIGhhcyB2YWx1ZSBvbmx5IHdoZW4gUEFSVElDSVBBTlQgUEFORUwgSVRFTSBjb21wb25lbnQgdGFnZ2VkIHdpdGggJypvdlBhcnRpY2lwYW50UGFuZWxJdGVtJ1xuXHRcdC8vIGlzIGluc2lkZSBvZiB0aGUgUEFSVElDSVBBTlRTIFBBTkVMIGNvbXBvbmVudCB0YWdnZWQgd2l0aCAnKm92UGFydGljaXBhbnRzUGFuZWwnXG5cdFx0aWYgKGV4dGVybmFsUGFydGljaXBhbnRQYW5lbEl0ZW0pIHtcblx0XHRcdHRoaXMucGFydGljaXBhbnRQYW5lbEl0ZW1UZW1wbGF0ZSA9IGV4dGVybmFsUGFydGljaXBhbnRQYW5lbEl0ZW0udGVtcGxhdGU7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBsb2NhbFBhcnRpY2lwYW50U3ViczogU3Vic2NyaXB0aW9uO1xuXHRwcml2YXRlIHJlbW90ZVBhcnRpY2lwYW50c1N1YnM6IFN1YnNjcmlwdGlvbjtcblxuXHQvKipcblx0ICogQGlnbm9yZVxuXHQgKi9cblx0Y29uc3RydWN0b3IoXG5cdFx0cHJvdGVjdGVkIHBhcnRpY2lwYW50U2VydmljZTogUGFydGljaXBhbnRTZXJ2aWNlLFxuXHRcdHByb3RlY3RlZCBwYW5lbFNlcnZpY2U6IFBhbmVsU2VydmljZSxcblx0XHRwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZlxuXHQpIHt9XG5cblx0bmdPbkluaXQoKTogdm9pZCB7XG5cdFx0dGhpcy5sb2NhbFBhcnRpY2lwYW50U3VicyA9IHRoaXMucGFydGljaXBhbnRTZXJ2aWNlLmxvY2FsUGFydGljaXBhbnRPYnMuc3Vic2NyaWJlKChwOiBQYXJ0aWNpcGFudEFic3RyYWN0TW9kZWwpID0+IHtcblx0XHRcdHRoaXMubG9jYWxQYXJ0aWNpcGFudCA9IHA7XG5cdFx0XHQvLyBNYXJrIGZvciByZS1yZW5kZXJpbmcgdXNpbmcgYW4gaW1wdXJlIHBpcGUgJ3N0cmVhbXNUeXBlc0VuYWJsZWQnXG5cdFx0XHR0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5yZW1vdGVQYXJ0aWNpcGFudHNTdWJzID0gdGhpcy5wYXJ0aWNpcGFudFNlcnZpY2UucmVtb3RlUGFydGljaXBhbnRzT2JzLnN1YnNjcmliZSgocDogUGFydGljaXBhbnRBYnN0cmFjdE1vZGVsW10pID0+IHtcblx0XHRcdC8vIFdvcmthcm91bmQgd2hpY2ggZm9yYyB0aGUgb2JqZWN0cyByZWZlcmVuY2VzIHVwZGF0ZVxuXHRcdFx0Ly8gQWZ0ZXIgb25lIGVudGlyZWx5IGRheSB0cnlpbmcgdG8gbWFrZSBpdCB3b3JrcywgdGhpcyBpcyB0aGUgb25seSB3YXlcblx0XHRcdGNvbnN0IHJlbW90ZVBhcnRpY2lwYW50c0F1eCA9IFtdO1xuXHRcdFx0cC5mb3JFYWNoKChwYXIpID0+IHtcblx0XHRcdFx0cmVtb3RlUGFydGljaXBhbnRzQXV4LnB1c2goT2JqZWN0LmNyZWF0ZShwYXIpKTtcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5yZW1vdGVQYXJ0aWNpcGFudHMgPSByZW1vdGVQYXJ0aWNpcGFudHNBdXg7XG5cdFx0XHQvLyBNYXJrIGZvciByZS1yZW5kZXJpbmcgdXNpbmcgYW4gaW1wdXJlIHBpcGUgJ3N0cmVhbXNUeXBlc0VuYWJsZWQnXG5cdFx0XHR0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuXHRcdH0pO1xuXHR9XG5cblx0bmdPbkRlc3Ryb3koKSB7XG5cdFx0aWYgKHRoaXMubG9jYWxQYXJ0aWNpcGFudFN1YnMpIHRoaXMubG9jYWxQYXJ0aWNpcGFudFN1YnMudW5zdWJzY3JpYmUoKTtcblx0XHRpZiAodGhpcy5yZW1vdGVQYXJ0aWNpcGFudHNTdWJzKSB0aGlzLnJlbW90ZVBhcnRpY2lwYW50c1N1YnMudW5zdWJzY3JpYmU7XG5cdH1cblxuXHRuZ0FmdGVyVmlld0luaXQoKXtcblx0XHRpZighdGhpcy5wYXJ0aWNpcGFudFBhbmVsSXRlbVRlbXBsYXRlKSB7XG5cdFx0XHQvLyB0aGUgdXNlciBoYXMgb3ZlcnJpZGUgdGhlIGRlZmF1bHQgcGFydGljaXBhbnRzIHBhbmVsIGJ1dCBub3QgdGhlICdwYXJ0aWNpcGFudC1wYW5lbC1pdGVtJ1xuXHRcdFx0Ly8gc28gdGhlIGRlZmF1bHQgY29tcG9uZW50IG11c3QgYmUgaW5qZWN0ZWRcblx0XHRcdHRoaXMucGFydGljaXBhbnRQYW5lbEl0ZW1UZW1wbGF0ZSA9IHRoaXMuZGVmYXVsdFBhcnRpY2lwYW50UGFuZWxJdGVtVGVtcGxhdGVcblx0XHRcdHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuXHRcdH1cblx0fVxuXG5cdGNsb3NlKCkge1xuXHRcdHRoaXMucGFuZWxTZXJ2aWNlLmNsb3NlUGFuZWwoKTtcblx0fVxufVxuIiwiPGRpdiBjbGFzcz1cInBhbmVsLWNvbnRhaW5lclwiIGlkPVwicGFydGljaXBhbnRzLWNvbnRhaW5lclwiPlxuXHQ8ZGl2IGNsYXNzPVwicGFuZWwtaGVhZGVyLWNvbnRhaW5lclwiPlxuXHRcdDxoMyBjbGFzcz1cInBhbmVsLXRpdGxlXCI+e3sgJ1BBTkVMLlBBUlRJQ0lQQU5UUy5USVRMRScgfCB0cmFuc2xhdGUgfX08L2gzPlxuXHRcdDxidXR0b24gY2xhc3M9XCJwYW5lbC1jbG9zZS1idXR0b25cIiBtYXQtaWNvbi1idXR0b24gbWF0VG9vbHRpcD1cInt7ICdQQU5FTC5DTE9TRScgfCB0cmFuc2xhdGUgfX1cIiAoY2xpY2spPVwiY2xvc2UoKVwiPlxuXHRcdFx0PG1hdC1pY29uPmNsb3NlPC9tYXQtaWNvbj5cblx0XHQ8L2J1dHRvbj5cblx0PC9kaXY+XG5cblx0PGRpdiBjbGFzcz1cInNjcm9sbGFibGVcIj5cblxuXHRcdDxkaXYgY2xhc3M9XCJsb2NhbC1wYXJ0aWNpcGFudC1jb250YWluZXJcIiAqbmdJZj1cImxvY2FsUGFydGljaXBhbnRcIj5cblx0XHRcdDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJwYXJ0aWNpcGFudFBhbmVsSXRlbVRlbXBsYXRlOyBjb250ZXh0OiB7ICRpbXBsaWNpdDogbG9jYWxQYXJ0aWNpcGFudCB9XCI+PC9uZy1jb250YWluZXI+XG5cdFx0XHQ8bWF0LWRpdmlkZXIgKm5nSWY9XCJ0cnVlXCI+PC9tYXQtZGl2aWRlcj5cblx0XHQ8L2Rpdj5cblxuXHRcdDxkaXYgY2xhc3M9XCJyZW1vdGUtcGFydGljaXBhbnRzLWNvbnRhaW5lclwiIGlkPVwicmVtb3RlLXBhcnRpY2lwYW50cy1jb250YWluZXJcIiAqbmdJZj1cInJlbW90ZVBhcnRpY2lwYW50cy5sZW5ndGggPiAwXCI+XG5cblx0XHRcdDxkaXYgKm5nRm9yPVwibGV0IHBhcnRpY2lwYW50IG9mIHRoaXMucmVtb3RlUGFydGljaXBhbnRzXCIgaWQ9XCJyZW1vdGUtcGFydGljaXBhbnQtaXRlbVwiPlxuXHRcdFx0XHQ8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwicGFydGljaXBhbnRQYW5lbEl0ZW1UZW1wbGF0ZTsgY29udGV4dDogeyAkaW1wbGljaXQ6IHBhcnRpY2lwYW50IH1cIj48L25nLWNvbnRhaW5lcj5cblx0XHRcdDwvZGl2PlxuXHRcdDwvZGl2PlxuXHQ8L2Rpdj5cbjwvZGl2PlxuXG48bmctdGVtcGxhdGUgI2RlZmF1bHRQYXJ0aWNpcGFudFBhbmVsSXRlbSBsZXQtcGFydGljaXBhbnQ+XG5cdDxvdi1wYXJ0aWNpcGFudC1wYW5lbC1pdGVtIFtwYXJ0aWNpcGFudF09XCJwYXJ0aWNpcGFudFwiIGlkPVwiZGVmYXVsdC1wYXJ0aWNpcGFudC1wYW5lbC1pdGVtXCI+PC9vdi1wYXJ0aWNpcGFudC1wYW5lbC1pdGVtPlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==