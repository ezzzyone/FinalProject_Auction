/**
 * @internal
 */
export var LayoutClass;
(function (LayoutClass) {
    LayoutClass["ROOT_ELEMENT"] = "OT_root";
    LayoutClass["BIG_ELEMENT"] = "OV_big";
    LayoutClass["SMALL_ELEMENT"] = "OV_small";
    LayoutClass["IGNORED_ELEMENT"] = "OV_ignored";
    LayoutClass["SIDENAV_CONTAINER"] = "sidenav-container";
    LayoutClass["NO_SIZE_ELEMENT"] = "no-size";
    LayoutClass["CLASS_NAME"] = "layout";
})(LayoutClass || (LayoutClass = {}));
/**
 * @internal
 */
export var SidenavMode;
(function (SidenavMode) {
    SidenavMode["OVER"] = "over";
    SidenavMode["SIDE"] = "side";
})(SidenavMode || (SidenavMode = {}));
export var LayoutAlignment;
(function (LayoutAlignment) {
    LayoutAlignment["START"] = "start";
    LayoutAlignment["CENTER"] = "center";
    LayoutAlignment["END"] = "end";
})(LayoutAlignment || (LayoutAlignment = {}));
/**
 * @internal
 */
export class OpenViduLayout {
    /**
     * Update the layout container
     * module export layout
     */
    updateLayout(container, opts) {
        setTimeout(() => {
            this.layoutContainer = container;
            this.opts = opts;
            if (this.css(this.layoutContainer, 'display') === 'none') {
                return;
            }
            let id = this.layoutContainer.id;
            if (!id) {
                id = 'OT_' + this.cheapUUID();
                this.layoutContainer.id = id;
            }
            opts.containerHeight =
                this.getHeight(this.layoutContainer) -
                    this.getCSSNumber(this.layoutContainer, 'border-top') -
                    this.getCSSNumber(this.layoutContainer, 'border-bottom');
            opts.containerWidth =
                this.getWidth(this.layoutContainer) -
                    this.getCSSNumber(this.layoutContainer, 'border-left') -
                    this.getCSSNumber(this.layoutContainer, 'border-right');
            const children = Array.prototype.filter.call(this.layoutContainer.querySelectorAll(`#${id}>*:not(.${LayoutClass.IGNORED_ELEMENT})`), () => this.filterDisplayNone);
            const elements = children.map((element) => {
                const res = this.getChildDims(element);
                res.big = element.classList.contains(this.opts.bigClass);
                return res;
            });
            const layout = this.getLayout(opts, elements);
            layout.boxes.forEach((box, idx) => {
                const elem = children[idx];
                this.css(elem, 'position', 'absolute');
                const actualWidth = box.width -
                    -this.getCSSNumber(elem, 'margin-left') -
                    this.getCSSNumber(elem, 'margin-right') -
                    (this.css(elem, 'box-sizing') !== 'border-box'
                        ? this.getCSSNumber(elem, 'padding-left') +
                            this.getCSSNumber(elem, 'padding-right') +
                            this.getCSSNumber(elem, 'border-left') +
                            this.getCSSNumber(elem, 'border-right')
                        : 0);
                const actualHeight = box.height -
                    -this.getCSSNumber(elem, 'margin-top') -
                    this.getCSSNumber(elem, 'margin-bottom') -
                    (this.css(elem, 'box-sizing') !== 'border-box'
                        ? this.getCSSNumber(elem, 'padding-top') +
                            this.getCSSNumber(elem, 'padding-bottom') +
                            this.getCSSNumber(elem, 'border-top') +
                            this.getCSSNumber(elem, 'border-bottom')
                        : 0);
                this.positionElement(elem, box.left, box.top, actualWidth, actualHeight, this.opts.animate);
            });
        }, 50);
    }
    /**
     * Initialize the layout inside of the container with the options required
     * @param container
     * @param opts
     */
    initLayoutContainer(container, opts) {
        // this.opts = this.defaults(opts, {
        //   maxRatio: 3 / 2,
        //   minRatio: 9 / 16,
        //   fixedRatio: false,
        //   animate: false,
        //   bigClass: LayoutClass.BIG_ELEMENT,
        //   smallClass: LayoutClass.SMALL_ELEMENT,
        //   bigPercentage: 0.8,
        //   bigFixedRatio: false,
        //   bigMaxRatio: 3 / 2,
        //   bigMinRatio: 9 / 16,
        //   bigFirst: true,
        //   alignItems: 'center',
        //   bigAlignItems: 'center',
        //   smallAlignItems: 'center'
        // });
        this.opts = opts;
        this.layoutContainer = container;
        this.updateLayout(container, opts);
    }
    getLayoutContainer() {
        return this.layoutContainer;
    }
    /**
     * Set the layout configuration
     * @param options
     */
    // private setLayoutOptions(options: OpenViduLayoutOptions) {
    // 	this.opts = options;
    // }
    css(el, propertyName, value) {
        if (!!value) {
            // We are setting one css property
            el.style[propertyName] = value;
            return NaN;
        }
        else if (typeof propertyName === 'object') {
            // We are setting several CSS properties at once
            Object.keys(propertyName).forEach((key) => {
                this.css(el, key, propertyName[key]);
            });
            return NaN;
        }
        else {
            // We are getting the css property
            var computedStyle = /*(this.opts && this.opts.window) ||*/ window.getComputedStyle(el);
            var currentValue = computedStyle.getPropertyValue(propertyName);
            if (currentValue === '') {
                currentValue = el.style[propertyName];
            }
            return currentValue;
        }
    }
    height(el) {
        if (el.offsetHeight > 0) {
            return `${el.offsetHeight}px`;
        }
        return this.css(el, 'height');
    }
    width(el) {
        if (el.offsetWidth > 0) {
            return `${el.offsetWidth}px`;
        }
        return this.css(el, 'width');
    }
    defaults(custom, defaults) {
        var res = defaults;
        Object.keys(defaults).forEach((key) => {
            if (custom.hasOwnProperty(key)) {
                res[key] = custom[key];
            }
        });
        return res;
    }
    /**
     * @hidden
     */
    fixAspectRatio(elem, width) {
        const sub = elem.querySelector(`.${LayoutClass.ROOT_ELEMENT}`);
        if (sub) {
            // If this is the parent of a subscriber or publisher then we need
            // to force the mutation observer on the publisher or subscriber to
            // trigger to get it to fix it's layout
            const oldWidth = sub.style.width;
            sub.style.width = `${width}px`;
            // sub.style.height = height + 'px';
            sub.style.width = oldWidth || '';
        }
    }
    /**
     * @hidden
     */
    positionElement(elem, x, y, width, height, animate) {
        const targetPosition = {
            left: `${x}px`,
            top: `${y}px`,
            width: `${width}px`,
            height: `${height}px`
        };
        this.fixAspectRatio(elem, width);
        if (animate) {
            setTimeout(() => {
                // animation added in css transition: all .1s linear;
                elem.style.left = targetPosition.left;
                elem.style.top = targetPosition.top;
                elem.style.width = targetPosition.width;
                elem.style.height = targetPosition.height;
                this.fixAspectRatio(elem, width);
            }, 10);
        }
        else {
            this.css(elem, targetPosition);
            if (!elem.classList.contains(LayoutClass.CLASS_NAME)) {
                elem.classList.add(LayoutClass.CLASS_NAME);
            }
        }
        this.fixAspectRatio(elem, width);
    }
    /**
     * @hidden
     */
    getChildDims(child) {
        if (child) {
            if (child.videoHeight && child.videoWidth) {
                return {
                    height: child.videoHeight,
                    width: child.videoWidth
                };
            }
            const video = child.querySelector('video');
            if (video && video.videoHeight && video.videoWidth) {
                return {
                    height: video.videoHeight,
                    width: video.videoWidth
                };
            }
        }
        return {
            height: 480,
            width: 640
        };
    }
    /**
     * @hidden
     */
    getCSSNumber(elem, prop) {
        const cssStr = this.css(elem, prop);
        return cssStr ? parseInt(cssStr.toString(), 10) : 0;
    }
    /**
     * @hidden
     */
    // Really cheap UUID function
    cheapUUID() {
        return (Math.random() * 100000000).toFixed(0);
    }
    /**
     * @hidden
     */
    getHeight(elem) {
        const heightStr = this.height(elem);
        return heightStr ? parseInt(heightStr.toString(), 10) : 0;
    }
    /**
     * @hidden
     */
    getWidth(elem) {
        const widthStr = this.width(elem);
        return widthStr ? parseInt(widthStr.toString(), 10) : 0;
    }
    /**
     * @hidden
     */
    // private arrange(
    //   children: HTMLVideoElement[],
    //   containerWidth: number,
    //   containerHeight: number,
    //   offsetLeft: number,
    //   offsetTop: number,
    //   fixedRatio: boolean,
    //   minRatio: number,
    //   maxRatio: number,
    //   animate: any
    // ) {
    // const boxes = this.getLayout(
    //   {
    //     containerWidth,
    //     containerHeight,
    //     minRatio,
    //     maxRatio,
    //     fixedRatio,
    //   },
    //   children.map((child) => this.getVideoRatio(child))
    // );
    // boxes.forEach((box, idx) => {
    //   const elem = children[idx];
    //   this.css(elem, 'position', 'absolute');
    //   const actualWidth =
    //     box.width -
    //     this.getCSSNumber(elem, 'paddingLeft') -
    //     this.getCSSNumber(elem, 'paddingRight') -
    //     this.getCSSNumber(elem, 'marginLeft') -
    //     this.getCSSNumber(elem, 'marginRight') -
    //     this.getCSSNumber(elem, 'borderLeft') -
    //     this.getCSSNumber(elem, 'borderRight');
    //   const actualHeight =
    //     box.height -
    //     this.getCSSNumber(elem, 'paddingTop') -
    //     this.getCSSNumber(elem, 'paddingBottom') -
    //     this.getCSSNumber(elem, 'marginTop') -
    //     this.getCSSNumber(elem, 'marginBottom') -
    //     this.getCSSNumber(elem, 'borderTop') -
    //     this.getCSSNumber(elem, 'borderBottom');
    //   this.positionElement(
    //     elem,
    //     box.left + offsetLeft,
    //     box.top + offsetTop,
    //     actualWidth,
    //     actualHeight,
    //     animate
    //   );
    // });
    // }
    /**
     * @hidden
     */
    // private attachElements(
    //   bigOnes: HTMLVideoElement[],
    //   normalOnes: HTMLVideoElement[],
    //   smallOnes: HTMLVideoElement[]
    // ) {
    //   const containerHeight =
    //     this.getHeight(this.layoutContainer) -
    //     this.getCSSNumber(this.layoutContainer, 'borderTop') -
    //     this.getCSSNumber(this.layoutContainer, 'borderBottom');
    //   const containerWidth =
    //     this.getWidth(this.layoutContainer) -
    //     this.getCSSNumber(this.layoutContainer, 'borderLeft') -
    //     this.getCSSNumber(this.layoutContainer, 'borderRight');
    //   const offsetLeft = 0;
    //   const offsetTop = 0;
    //   if (this.existBigAndNormalOnes(bigOnes, normalOnes, smallOnes)) {
    //     const smallOnesAux = smallOnes.length > 0 ? smallOnes : normalOnes;
    //     const bigOnesAux = bigOnes.length > 0 ? bigOnes : normalOnes;
    //     this.arrangeBigAndSmallOnes(bigOnesAux, smallOnesAux, {
    //       containerHeight,
    //       containerWidth,
    //     });
    //   } else if (this.onlyExistBigOnes(bigOnes, normalOnes, smallOnes)) {
    //     // We only have one bigOne just center it
    //     this.arrange(
    //       bigOnes,
    //       containerWidth,
    //       containerHeight,
    //       0,
    //       0,
    //       this.opts.bigFixedRatio,
    //       this.opts.bigMinRatio,
    //       this.opts.bigMaxRatio,
    //       this.opts.animate
    //     );
    //   } else if (
    //     this.existBigAndNormalAndSmallOnes(bigOnes, normalOnes, smallOnes)
    //   ) {
    //     this.arrangeBigAndSmallOnes(bigOnes, normalOnes.concat(smallOnes), {
    //       containerHeight,
    //       containerWidth,
    //     });
    //   } else {
    //     const normalOnesAux = normalOnes.concat(smallOnes);
    //     this.arrange(
    //       normalOnesAux,
    //       containerWidth - offsetLeft,
    //       containerHeight - offsetTop,
    //       offsetLeft,
    //       offsetTop,
    //       this.opts.fixedRatio,
    //       this.opts.minRatio,
    //       this.opts.maxRatio,
    //       this.opts.animate
    //     );
    //   }
    // }
    /**
     * @hidden
     */
    // private arrangeBigAndSmallOnes(
    //   bigOnesAux: HTMLVideoElement[],
    //   smallOnesAux: HTMLVideoElement[],
    //   data: { containerHeight: number; containerWidth: number }
    // ) {
    //   const { containerWidth, containerHeight } = data;
    //   let offsetLeft = 0;
    //   let offsetTop = 0;
    //   const availableRatio = containerHeight / containerWidth;
    //   let bigOffsetTop = 0;
    //   let bigOffsetLeft = 0;
    //   let bigWidth, bigHeight;
    //   if (availableRatio > this.getVideoRatio(bigOnesAux[0])) {
    //     // We are tall, going to take up the whole width and arrange small
    //     // guys at the bottom
    //     bigWidth = containerWidth;
    //     bigHeight = Math.floor(containerHeight * this.opts.bigPercentage);
    //     offsetTop = bigHeight;
    //     bigOffsetTop = containerHeight - offsetTop;
    //   } else {
    //     // We are wide, going to take up the whole height and arrange the small
    //     // guys on the right
    //     bigHeight = containerHeight;
    //     bigWidth = Math.floor(containerWidth * this.opts.bigPercentage);
    //     offsetLeft = bigWidth;
    //     bigOffsetLeft = containerWidth - offsetLeft;
    //   }
    //   if (this.opts.bigFirst) {
    //     this.arrange(
    //       bigOnesAux,
    //       bigWidth,
    //       bigHeight,
    //       0,
    //       0,
    //       this.opts.bigFixedRatio,
    //       this.opts.bigMinRatio,
    //       this.opts.bigMaxRatio,
    //       this.opts.animate
    //     );
    //     this.arrange(
    //       smallOnesAux,
    //       containerWidth - offsetLeft,
    //       containerHeight - offsetTop,
    //       offsetLeft,
    //       offsetTop,
    //       this.opts.fixedRatio,
    //       this.opts.minRatio,
    //       this.opts.maxRatio,
    //       this.opts.animate
    //     );
    //   } else {
    //     this.arrange(
    //       smallOnesAux,
    //       containerWidth - offsetLeft,
    //       containerHeight - offsetTop,
    //       0,
    //       0,
    //       this.opts.fixedRatio,
    //       this.opts.minRatio,
    //       this.opts.maxRatio,
    //       this.opts.animate
    //     );
    //     this.arrange(
    //       bigOnesAux,
    //       bigWidth,
    //       bigHeight,
    //       bigOffsetLeft,
    //       bigOffsetTop,
    //       this.opts.bigFixedRatio,
    //       this.opts.bigMinRatio,
    //       this.opts.bigMaxRatio,
    //       this.opts.animate
    //     );
    //   }
    // }
    /**
     * @hidden
     */
    // private existBigAndNormalOnes(
    //   bigOnes: HTMLVideoElement[],
    //   normalOnes: HTMLVideoElement[],
    //   smallOnes: HTMLVideoElement[]
    // ) {
    //   return (
    //     (bigOnes.length > 0 && normalOnes.length > 0 && smallOnes.length === 0) ||
    //     (bigOnes.length > 0 && normalOnes.length === 0 && smallOnes.length > 0) ||
    //     (bigOnes.length === 0 && normalOnes.length > 0 && smallOnes.length > 0)
    //   );
    // }
    /**
     * @hidden
     */
    // private onlyExistBigOnes(
    //   bigOnes: HTMLVideoElement[],
    //   normalOnes: HTMLVideoElement[],
    //   smallOnes: HTMLVideoElement[]
    // ): boolean {
    //   return (
    //     bigOnes.length > 0 && normalOnes.length === 0 && smallOnes.length === 0
    //   );
    // }
    /**
     * @hidden
     */
    // private existBigAndNormalAndSmallOnes(
    //   bigOnes: HTMLVideoElement[],
    //   normalOnes: HTMLVideoElement[],
    //   smallOnes: HTMLVideoElement[]
    // ): boolean {
    //   return bigOnes.length > 0 && normalOnes.length > 0 && smallOnes.length > 0;
    // }
    /**
     * @hidden
     */
    filterDisplayNone(element) {
        return this.css(element, 'display') !== 'none';
    }
    /**
     *
     * --------------------------------------------------------------------------------
     *
     * GET LAYOUT
     *
     *
     */
    /**
     * @hidden
     */
    getBestDimensions(minRatio, maxRatio, width, height, count, maxWidth, maxHeight) {
        let maxArea;
        let targetCols;
        let targetRows;
        let targetHeight;
        let targetWidth;
        let tWidth;
        let tHeight;
        let tRatio;
        // Iterate through every possible combination of rows and columns
        // and see which one has the least amount of whitespace
        for (let i = 1; i <= count; i++) {
            const cols = i;
            const rows = Math.ceil(count / cols);
            // Try taking up the whole height and width
            tHeight = Math.floor(height / rows);
            tWidth = Math.floor(width / cols);
            tRatio = tHeight / tWidth;
            if (tRatio > maxRatio) {
                // We went over decrease the height
                tRatio = maxRatio;
                tHeight = tWidth * tRatio;
            }
            else if (tRatio < minRatio) {
                // We went under decrease the width
                tRatio = minRatio;
                tWidth = tHeight / tRatio;
            }
            tWidth = Math.min(maxWidth, tWidth);
            tHeight = Math.min(maxHeight, tHeight);
            const area = tWidth * tHeight * count;
            // If this width and height takes up the most space then we're going with that
            if (maxArea === undefined || area >= maxArea) {
                if (!(area === maxArea && count % (cols * rows) > count % (targetRows * targetCols))) {
                    // Favour even numbers of participants in each row, eg. 2 on each row
                    // instead of 3 in one row and then 1 on the next
                    maxArea = area;
                    targetHeight = tHeight;
                    targetWidth = tWidth;
                    targetCols = cols;
                    targetRows = rows;
                }
            }
        }
        return {
            maxArea,
            targetCols,
            targetRows,
            targetHeight,
            targetWidth,
            ratio: targetHeight / targetWidth
        };
    }
    getVideoRatio(element) {
        return element.height / element.width;
    }
    getLayout(opts, elements) {
        const { maxRatio = 3 / 2, minRatio = 9 / 16, fixedRatio = false, bigPercentage = 0.8, minBigPercentage = 0, bigFixedRatio = false, bigMaxRatio = 3 / 2, bigMinRatio = 9 / 16, bigFirst = true, containerWidth = 640, containerHeight = 480, alignItems = 'center', bigAlignItems = 'center', smallAlignItems = 'center', maxWidth = Infinity, maxHeight = Infinity, smallMaxWidth = Infinity, smallMaxHeight = Infinity, bigMaxWidth = Infinity, bigMaxHeight = Infinity, scaleLastRow = true, bigScaleLastRow = true } = opts;
        const availableRatio = containerHeight / containerWidth;
        let offsetLeft = 0;
        let offsetTop = 0;
        let bigOffsetTop = 0;
        let bigOffsetLeft = 0;
        const bigIndices = [];
        let bigBoxes = [];
        let smallBoxes = [];
        let areas = { big: null, small: null };
        // Move to Get Layout
        const smallOnes = elements.filter((element) => !element.big);
        const bigOnes = elements.filter((element, idx) => {
            if (element.big) {
                bigIndices.push(idx);
                return true;
            }
            return false;
        });
        //TODO: Habia un codigo personalizado que servía para
        //TODO: tener videos grandes, pequeños y normales
        //.filter((x) => !smallOnes.includes(x));
        // const normalOnes: HTMLVideoElement[] = Array.prototype.filter
        //   .call(
        //     this.layoutContainer.querySelectorAll(
        //       `#${id}>*:not(.${this.opts.bigClass})`
        //     ),
        //     () => this.filterDisplayNone
        //   )
        //   .filter((x) => !smallOnes.includes(x));
        // this.attachElements(bigOnes, normalOnes, smallOnes);
        if (bigOnes.length > 0 && smallOnes.length > 0) {
            let bigWidth;
            let bigHeight;
            let showBigFirst = bigFirst;
            if (availableRatio > this.getVideoRatio(bigOnes[0])) {
                // We are tall, going to take up the whole width and arrange small
                // guys at the bottom
                bigWidth = containerWidth;
                bigHeight = Math.floor(containerHeight * bigPercentage);
                if (minBigPercentage > 0) {
                    // Find the best size for the big area
                    let bigDimensions;
                    if (!bigFixedRatio) {
                        bigDimensions = this.getBestDimensions(bigMinRatio, bigMaxRatio, bigWidth, bigHeight, bigOnes.length, bigMaxWidth, bigMaxHeight);
                    }
                    else {
                        // Use the ratio of the first video element we find to approximate
                        const ratio = bigOnes[0].height / bigOnes[0].width;
                        bigDimensions = this.getBestDimensions(ratio, ratio, bigWidth, bigHeight, bigOnes.length, bigMaxWidth, bigMaxHeight);
                    }
                    bigHeight = Math.max(containerHeight * minBigPercentage, Math.min(bigHeight, bigDimensions.targetHeight * bigDimensions.targetRows));
                    // Don't awkwardly scale the small area bigger than we need to and end up with floating
                    // videos in the middle
                    const smallDimensions = this.getBestDimensions(minRatio, maxRatio, containerWidth, containerHeight - bigHeight, smallOnes.length, smallMaxWidth, smallMaxHeight);
                    bigHeight = Math.max(bigHeight, containerHeight - smallDimensions.targetRows * smallDimensions.targetHeight);
                }
                offsetTop = bigHeight;
                bigOffsetTop = containerHeight - offsetTop;
                if (bigFirst === 'column') {
                    showBigFirst = false;
                }
                else if (bigFirst === 'row') {
                    showBigFirst = true;
                }
            }
            else {
                // We are wide, going to take up the whole height and arrange the small
                // guys on the right
                bigHeight = containerHeight;
                bigWidth = Math.floor(containerWidth * bigPercentage);
                if (minBigPercentage > 0) {
                    // Find the best size for the big area
                    let bigDimensions;
                    if (!bigFixedRatio) {
                        bigDimensions = this.getBestDimensions(bigMinRatio, bigMaxRatio, bigWidth, bigHeight, bigOnes.length, bigMaxWidth, bigMaxHeight);
                    }
                    else {
                        // Use the ratio of the first video element we find to approximate
                        const ratio = bigOnes[0].height / bigOnes[0].width;
                        bigDimensions = this.getBestDimensions(ratio, ratio, bigWidth, bigHeight, bigOnes.length, bigMaxWidth, bigMaxHeight);
                    }
                    bigWidth = Math.max(containerWidth * minBigPercentage, Math.min(bigWidth, bigDimensions.targetWidth * bigDimensions.targetCols));
                    // Don't awkwardly scale the small area bigger than we need to and end up with floating
                    // videos in the middle
                    const smallDimensions = this.getBestDimensions(minRatio, maxRatio, containerWidth - bigWidth, containerHeight, smallOnes.length, smallMaxWidth, smallMaxHeight);
                    bigWidth = Math.max(bigWidth, containerWidth - smallDimensions.targetCols * smallDimensions.targetWidth);
                }
                offsetLeft = bigWidth;
                bigOffsetLeft = containerWidth - offsetLeft;
                if (bigFirst === 'column') {
                    showBigFirst = true;
                }
                else if (bigFirst === 'row') {
                    showBigFirst = false;
                }
            }
            if (showBigFirst) {
                areas.big = {
                    top: 0,
                    left: 0,
                    width: bigWidth,
                    height: bigHeight
                };
                areas.small = {
                    top: offsetTop,
                    left: offsetLeft,
                    width: containerWidth - offsetLeft,
                    height: containerHeight - offsetTop
                };
            }
            else {
                areas.big = {
                    left: bigOffsetLeft,
                    top: bigOffsetTop,
                    width: bigWidth,
                    height: bigHeight
                };
                areas.small = {
                    top: 0,
                    left: 0,
                    width: containerWidth - offsetLeft,
                    height: containerHeight - offsetTop
                };
            }
        }
        else if (bigOnes.length > 0 && smallOnes.length === 0) {
            // We only have one bigOne just center it
            areas.big = {
                top: 0,
                left: 0,
                width: containerWidth,
                height: containerHeight
            };
        }
        else {
            areas.small = {
                top: offsetTop,
                left: offsetLeft,
                width: containerWidth - offsetLeft,
                height: containerHeight - offsetTop
            };
        }
        if (areas.big) {
            bigBoxes = this.getLayoutAux({
                containerWidth: areas.big.width,
                containerHeight: areas.big.height,
                offsetLeft: areas.big.left,
                offsetTop: areas.big.top,
                fixedRatio: bigFixedRatio,
                minRatio: bigMinRatio,
                maxRatio: bigMaxRatio,
                alignItems: bigAlignItems,
                maxWidth: bigMaxWidth,
                maxHeight: bigMaxHeight,
                scaleLastRow: bigScaleLastRow
            }, bigOnes);
        }
        if (areas.small) {
            smallBoxes = this.getLayoutAux({
                containerWidth: areas.small.width,
                containerHeight: areas.small.height,
                offsetLeft: areas.small.left,
                offsetTop: areas.small.top,
                fixedRatio,
                minRatio,
                maxRatio,
                alignItems: areas.big ? smallAlignItems : alignItems,
                maxWidth: areas.big ? smallMaxWidth : maxWidth,
                maxHeight: areas.big ? smallMaxHeight : maxHeight,
                scaleLastRow
            }, smallOnes);
        }
        const boxes = [];
        let bigBoxesIdx = 0;
        let smallBoxesIdx = 0;
        // Rebuild the array in the right order based on where the bigIndices should be
        elements.forEach((element, idx) => {
            if (bigIndices.indexOf(idx) > -1) {
                boxes[idx] = bigBoxes[bigBoxesIdx];
                bigBoxesIdx += 1;
            }
            else {
                boxes[idx] = smallBoxes[smallBoxesIdx];
                smallBoxesIdx += 1;
            }
        });
        return { boxes, areas };
    }
    getLayoutAux(opts, elements) {
        const { maxRatio = 3 / 2, minRatio = 9 / 16, fixedRatio = false, containerWidth = 640, containerHeight = 480, offsetLeft = 0, offsetTop = 0, alignItems = 'center', maxWidth = Infinity, maxHeight = Infinity, scaleLastRow = true } = opts;
        const ratios = elements.map((element) => element.height / element.width);
        const count = ratios.length;
        let dimensions;
        if (!fixedRatio) {
            dimensions = this.getBestDimensions(minRatio, maxRatio, containerWidth, containerHeight, count, maxWidth, maxHeight);
        }
        else {
            // Use the ratio of the first video element we find to approximate
            const ratio = ratios.length > 0 ? ratios[0] : null;
            dimensions = this.getBestDimensions(ratio, ratio, containerWidth, containerHeight, count, maxWidth, maxHeight);
        }
        // Loop through each stream in the container and place it inside
        let x = 0;
        let y = 0;
        const rows = [];
        let row;
        const boxes = [];
        // Iterate through the children and create an array with a new item for each row
        // and calculate the width of each row so that we know if we go over the size and need
        // to adjust
        for (let i = 0; i < ratios.length; i++) {
            if (i % dimensions.targetCols === 0) {
                // This is a new row
                row = {
                    ratios: [],
                    width: 0,
                    height: 0
                };
                rows.push(row);
            }
            const ratio = ratios[i];
            row.ratios.push(ratio);
            let targetWidth = dimensions.targetWidth;
            const targetHeight = dimensions.targetHeight;
            // If we're using a fixedRatio then we need to set the correct ratio for this element
            if (fixedRatio) {
                targetWidth = targetHeight / ratio;
            }
            row.width += targetWidth;
            row.height = targetHeight;
        }
        // Calculate total row height adjusting if we go too wide
        let totalRowHeight = 0;
        let remainingShortRows = 0;
        for (let i = 0; i < rows.length; i++) {
            row = rows[i];
            if (row.width > containerWidth) {
                // Went over on the width, need to adjust the height proportionally
                row.height = Math.floor(row.height * (containerWidth / row.width));
                row.width = containerWidth;
            }
            else if (row.width < containerWidth && row.height < maxHeight) {
                remainingShortRows += 1;
            }
            totalRowHeight += row.height;
        }
        if (scaleLastRow && totalRowHeight < containerHeight && remainingShortRows > 0) {
            // We can grow some of the rows, we're not taking up the whole height
            let remainingHeightDiff = containerHeight - totalRowHeight;
            totalRowHeight = 0;
            for (let i = 0; i < rows.length; i++) {
                row = rows[i];
                if (row.width < containerWidth) {
                    // Evenly distribute the extra height between the short rows
                    let extraHeight = remainingHeightDiff / remainingShortRows;
                    if (extraHeight / row.height > (containerWidth - row.width) / row.width) {
                        // We can't go that big or we'll go too wide
                        extraHeight = Math.floor(((containerWidth - row.width) / row.width) * row.height);
                    }
                    row.width += Math.floor((extraHeight / row.height) * row.width);
                    row.height += extraHeight;
                    remainingHeightDiff -= extraHeight;
                    remainingShortRows -= 1;
                }
                totalRowHeight += row.height;
            }
        }
        // vertical centering
        switch (alignItems) {
            case 'start':
                y = 0;
                break;
            case 'end':
                y = containerHeight - totalRowHeight;
                break;
            case 'center':
            default:
                y = (containerHeight - totalRowHeight) / 2;
                break;
        }
        // Iterate through each row and place each child
        for (let i = 0; i < rows.length; i++) {
            row = rows[i];
            let rowMarginLeft;
            switch (alignItems) {
                case 'start':
                    rowMarginLeft = 0;
                    break;
                case 'end':
                    rowMarginLeft = containerWidth - row.width;
                    break;
                case 'center':
                default:
                    rowMarginLeft = (containerWidth - row.width) / 2;
                    break;
            }
            x = rowMarginLeft;
            let targetHeight;
            for (let j = 0; j < row.ratios.length; j++) {
                const ratio = row.ratios[j];
                let targetWidth = dimensions.targetWidth;
                targetHeight = row.height;
                // If we're using a fixedRatio then we need to set the correct ratio for this element
                if (fixedRatio) {
                    targetWidth = Math.floor(targetHeight / ratio);
                }
                else if (targetHeight / targetWidth !== dimensions.targetHeight / dimensions.targetWidth) {
                    // We grew this row, we need to adjust the width to account for the increase in height
                    targetWidth = Math.floor((dimensions.targetWidth / dimensions.targetHeight) * targetHeight);
                }
                boxes.push({
                    left: x + offsetLeft,
                    top: y + offsetTop,
                    width: targetWidth,
                    height: targetHeight
                });
                x += targetWidth;
            }
            y += targetHeight;
        }
        return boxes;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF5b3V0Lm1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvb3BlbnZpZHUtYW5ndWxhci9zcmMvbGliL21vZGVscy9sYXlvdXQubW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0dBRUc7QUFDSCxNQUFNLENBQU4sSUFBWSxXQVFYO0FBUkQsV0FBWSxXQUFXO0lBQ3RCLHVDQUF3QixDQUFBO0lBQ3hCLHFDQUFzQixDQUFBO0lBQ3RCLHlDQUEwQixDQUFBO0lBQzFCLDZDQUE4QixDQUFBO0lBQzlCLHNEQUF1QyxDQUFBO0lBQ3ZDLDBDQUEyQixDQUFBO0lBQzNCLG9DQUFxQixDQUFBO0FBQ3RCLENBQUMsRUFSVyxXQUFXLEtBQVgsV0FBVyxRQVF0QjtBQUVEOztHQUVHO0FBQ0gsTUFBTSxDQUFOLElBQVksV0FHWDtBQUhELFdBQVksV0FBVztJQUN0Qiw0QkFBYSxDQUFBO0lBQ2IsNEJBQWEsQ0FBQTtBQUNkLENBQUMsRUFIVyxXQUFXLEtBQVgsV0FBVyxRQUd0QjtBQUVELE1BQU0sQ0FBTixJQUFZLGVBSVg7QUFKRCxXQUFZLGVBQWU7SUFDMUIsa0NBQWUsQ0FBQTtJQUNmLG9DQUFpQixDQUFBO0lBQ2pCLDhCQUFXLENBQUE7QUFDWixDQUFDLEVBSlcsZUFBZSxLQUFmLGVBQWUsUUFJMUI7QUF3R0Q7O0dBRUc7QUFDSCxNQUFNLE9BQU8sY0FBYztJQVcxQjs7O09BR0c7SUFDSCxZQUFZLENBQUMsU0FBc0IsRUFBRSxJQUFTO1FBQzdDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZixJQUFJLENBQUMsZUFBZSxHQUFHLFNBQVMsQ0FBQztZQUNqQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUVqQixJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxTQUFTLENBQUMsS0FBSyxNQUFNLEVBQUU7Z0JBQ3pELE9BQU87YUFDUDtZQUNELElBQUks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QUFHLFVBQVUsQ0FBQyxZQUFZLENBQUMsR0FBRyxZQUFZLENBQUMsQ0FBQztpQkFDNUY7Z0JBRUQsS0FBSyxDQUFDLElBQUksQ0FBQztvQkFDVixJQUFJLEVBQUUsQ0FBQyxHQUFHLFVBQVU7b0JBQ3BCLEdBQUcsRUFBRSxDQUFDLEdBQUcsU0FBUztvQkFDbEIsS0FBSyxFQUFFLFdBQVc7b0JBQ2xCLE1BQU0sRUFBRSxZQUFZO2lCQUNwQixDQUFDLENBQUM7Z0JBQ0gsQ0FBQyxJQUFJLFdBQVcsQ0FBQzthQUNqQjtZQUNELENBQUMsSUFBSSxZQUFZLENBQUM7U0FDbEI7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7Q0FDRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBlbnVtIExheW91dENsYXNzIHtcblx0Uk9PVF9FTEVNRU5UID0gJ09UX3Jvb3QnLFxuXHRCSUdfRUxFTUVOVCA9ICdPVl9iaWcnLFxuXHRTTUFMTF9FTEVNRU5UID0gJ09WX3NtYWxsJyxcblx0SUdOT1JFRF9FTEVNRU5UID0gJ09WX2lnbm9yZWQnLFxuXHRTSURFTkFWX0NPTlRBSU5FUiA9ICdzaWRlbmF2LWNvbnRhaW5lcicsXG5cdE5PX1NJWkVfRUxFTUVOVCA9ICduby1zaXplJyxcblx0Q0xBU1NfTkFNRSA9ICdsYXlvdXQnXG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBlbnVtIFNpZGVuYXZNb2RlIHtcblx0T1ZFUiA9ICdvdmVyJyxcblx0U0lERSA9ICdzaWRlJ1xufVxuXG5leHBvcnQgZW51bSBMYXlvdXRBbGlnbm1lbnQge1xuXHRTVEFSVCA9ICdzdGFydCcsXG5cdENFTlRFUiA9ICdjZW50ZXInLFxuXHRFTkQgPSAnZW5kJ1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgaW50ZXJmYWNlIE9wZW5WaWR1TGF5b3V0T3B0aW9ucyB7XG5cdC8qKlxuXHQgKiBUaGUgbmFycm93ZXN0IHJhdGlvIHRoYXQgd2lsbCBiZSB1c2VkICgqMngzKiBieSBkZWZhdWx0KVxuXHQgKi9cblx0bWF4UmF0aW86IG51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIHdpZGVzdCByYXRpbyB0aGF0IHdpbGwgYmUgdXNlZCAoKjE2eDkqIGJ5IGRlZmF1bHQpXG5cdCAqL1xuXHRtaW5SYXRpbzogbnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBJZiB0aGlzIGlzIHRydWUgdGhlbiB0aGUgYXNwZWN0IHJhdGlvIG9mIHRoZSB2aWRlbyBpcyBtYWludGFpbmVkIGFuZCBtaW5SYXRpbyBhbmQgbWF4UmF0aW8gYXJlIGlnbm9yZWQgKCpmYWxzZSogYnkgZGVmYXVsdClcblx0ICovXG5cdGZpeGVkUmF0aW86IGJvb2xlYW47XG5cdC8qKlxuXHQgKiBXaGV0aGVyIHlvdSB3YW50IHRvIGFuaW1hdGUgdGhlIHRyYW5zaXRpb25zXG5cdCAqL1xuXHRhbmltYXRlOiBhbnk7XG5cdC8qKlxuXHQgKiBUaGUgY2xhc3MgdG8gYWRkIHRvIGVsZW1lbnRzIHRoYXQgc2hvdWxkIGJlIHNpemVkIGJpZ2dlclxuXHQgKi9cblx0YmlnQ2xhc3M6IHN0cmluZztcblxuXHQvKipcblx0ICogVGhlIGNsYXNzIHRvIGFkZCB0byBlbGVtZW50cyB0aGF0IHNob3VsZCBiZSBzaXplZCBzbWFsbGVyXG5cdCAqL1xuXHRzbWFsbENsYXNzOiBzdHJpbmc7XG5cblx0LyoqXG5cdCAqIFRoZSBjbGFzcyB0byBhZGQgdG8gZWxlbWVudHMgdGhhdCBzaG91bGQgYmUgaWdub3JlZFxuXHQgKi9cblx0aWdub3JlZENsYXNzOiBzdHJpbmc7XG5cblx0LyoqXG5cdCAqIFRoZSBtYXhpbXVtIHBlcmNlbnRhZ2Ugb2Ygc3BhY2UgdGhlIGJpZyBvbmVzIHNob3VsZCB0YWtlIHVwXG5cdCAqL1xuXHRiaWdQZXJjZW50YWdlOiBhbnk7XG5cblx0LyoqXG5cdCAqIElmIHRoaXMgaXMgc2V0IHRoZW4gaXQgd2lsbCBzY2FsZSBkb3duIHRoZSBiaWcgc3BhY2UgaWYgdGhlcmUgaXMgbGVmdCBvdmVyIHdoaXRlc3BhY2UgZG93biB0byB0aGlzIG1pbmltdW0gc2l6ZVxuXHQgKi9cblx0bWluQmlnUGVyY2VudGFnZTogbnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBGaXhlZFJhdGlvIGZvciB0aGUgYmlnIG9uZXNcblx0ICovXG5cdGJpZ0ZpeGVkUmF0aW86IGFueTtcblxuXHQvKipcblx0ICogVGhlIG5hcnJvd2VzdCByYXRpbyB0byB1c2UgZm9yIHRoZSBiaWcgZWxlbWVudHMgKCoyeDMqIGJ5IGRlZmF1bHQpXG5cdCAqL1xuXHRiaWdNYXhSYXRpbzogYW55O1xuXG5cdC8qKlxuXHQgKiBUaGUgd2lkZXN0IHJhdGlvIHRvIHVzZSBmb3IgdGhlIGJpZyBlbGVtZW50cyAoKjE2eDkqIGJ5IGRlZmF1bHQpXG5cdCAqL1xuXHRiaWdNaW5SYXRpbzogYW55O1xuXG5cdC8qKlxuXHQgKiBXaGV0aGVyIHRvIHBsYWNlIHRoZSBiaWcgb25lIGluIHRoZSB0b3AgbGVmdCBgdHJ1ZWAgb3IgYm90dG9tIHJpZ2h0XG5cdCAqL1xuXHRiaWdGaXJzdDogYm9vbGVhbiB8ICdjb2x1bW4nIHwgJ3Jvdyc7XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRhbGlnbkl0ZW1zOiBMYXlvdXRBbGlnbm1lbnQ7XG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0YmlnQWxpZ25JdGVtczogTGF5b3V0QWxpZ25tZW50O1xuXHQvKipcblx0ICpcblx0ICovXG5cdHNtYWxsQWxpZ25JdGVtczogTGF5b3V0QWxpZ25tZW50O1xuXHQvKipcblx0ICogIFRoZSBtYXhpbXVtIHdpZHRoIG9mIHRoZSBlbGVtZW50c1xuXHQgKi9cblx0bWF4V2lkdGg6IG51bWJlcjtcblx0LyoqXG5cdCAqIFRoZSBtYXhpbXVtIGhlaWdodCBvZiB0aGUgZWxlbWVudHNcblx0ICovXG5cdG1heEhlaWdodDogbnVtYmVyO1xuXHRzbWFsbE1heFdpZHRoOiBudW1iZXI7XG5cdHNtYWxsTWF4SGVpZ2h0OiBudW1iZXI7XG5cdGJpZ01heFdpZHRoOiBudW1iZXI7XG5cdGJpZ01heEhlaWdodDogbnVtYmVyO1xuXG5cdC8qKlxuXHQgKiAgSWYgdGhlcmUgYXJlIGxlc3MgZWxlbWVudHMgb24gdGhlIGxhc3Qgcm93IHRoZW4gd2UgY2FuIHNjYWxlIHRoZW0gdXAgdG8gdGFrZSB1cCBtb3JlIHNwYWNlXG5cdCAqL1xuXHRzY2FsZUxhc3RSb3c/OiBib29sZWFuO1xuXHQvKipcblx0ICogU2NhbGUgbGFzdCByb3cgZm9yIHRoZSBiaWcgZWxlbWVudHNcblx0ICovXG5cdGJpZ1NjYWxlTGFzdFJvdz86IGJvb2xlYW47XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBjbGFzcyBPcGVuVmlkdUxheW91dCB7XG5cdC8qKlxuXHQgKiBAaGlkZGVuXG5cdCAqL1xuXHRwcml2YXRlIGxheW91dENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG5cblx0LyoqXG5cdCAqIEBoaWRkZW5cblx0ICovXG5cdHByaXZhdGUgb3B0czogT3BlblZpZHVMYXlvdXRPcHRpb25zO1xuXG5cdC8qKlxuXHQgKiBVcGRhdGUgdGhlIGxheW91dCBjb250YWluZXJcblx0ICogbW9kdWxlIGV4cG9ydCBsYXlvdXRcblx0ICovXG5cdHVwZGF0ZUxheW91dChjb250YWluZXI6IEhUTUxFbGVtZW50LCBvcHRzOiBhbnkpIHtcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdHRoaXMubGF5b3V0Q29udGFpbmVyID0gY29udGFpbmVyO1xuXHRcdFx0dGhpcy5vcHRzID0gb3B0cztcblxuXHRcdFx0aWYgKHRoaXMuY3NzKHRoaXMubGF5b3V0Q29udGFpbmVyLCAnZGlzcGxheScpID09PSAnbm9uZScpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0bGV0IGlkID0gdGhpcy5sYXlvdXRDb250YWluZXIuaWQ7XG5cdFx0XHRpZiAoIWlkKSB7XG5cdFx0XHRcdGlkID0gJ09UXycgKyB0aGlzLmNoZWFwVVVJRCgpO1xuXHRcdFx0XHR0aGlzLmxheW91dENvbnRhaW5lci5pZCA9IGlkO1xuXHRcdFx0fVxuXG5cdFx0XHRvcHRzLmNvbnRhaW5lckhlaWdodCA9XG5cdFx0XHRcdHRoaXMuZ2V0SGVpZ2h0KHRoaXMubGF5b3V0Q29udGFpbmVyKSAtXG5cdFx0XHRcdHRoaXMuZ2V0Q1NTTnVtYmVyKHRoaXMubGF5b3V0Q29udGFpbmVyLCAnYm9yZGVyLXRvcCcpIC1cblx0XHRcdFx0dGhpcy5nZXRDU1NOdW1iZXIodGhpcy5sYXlvdXRDb250YWluZXIsICdib3JkZXItYm90dG9tJyk7XG5cdFx0XHRvcHRzLmNvbnRhaW5lcldpZHRoID1cblx0XHRcdFx0dGhpcy5nZXRXaWR0aCh0aGlzLmxheW91dENvbnRhaW5lcikgLVxuXHRcdFx0XHR0aGlzLmdldENTU051bWJlcih0aGlzLmxheW91dENvbnRhaW5lciwgJ2JvcmRlci1sZWZ0JykgLVxuXHRcdFx0XHR0aGlzLmdldENTU051bWJlcih0aGlzLmxheW91dENvbnRhaW5lciwgJ2JvcmRlci1yaWdodCcpO1xuXG5cdFx0XHRjb25zdCBjaGlsZHJlbiA9IEFycmF5LnByb3RvdHlwZS5maWx0ZXIuY2FsbChcblx0XHRcdFx0dGhpcy5sYXlvdXRDb250YWluZXIucXVlcnlTZWxlY3RvckFsbChgIyR7aWR9Pio6bm90KC4ke0xheW91dENsYXNzLklHTk9SRURfRUxFTUVOVH0pYCksXG5cdFx0XHRcdCgpID0+IHRoaXMuZmlsdGVyRGlzcGxheU5vbmVcblx0XHRcdCk7XG5cdFx0XHRjb25zdCBlbGVtZW50cyA9IGNoaWxkcmVuLm1hcCgoZWxlbWVudCkgPT4ge1xuXHRcdFx0XHRjb25zdCByZXMgPSB0aGlzLmdldENoaWxkRGltcyhlbGVtZW50KTtcblx0XHRcdFx0cmVzLmJpZyA9IGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMub3B0cy5iaWdDbGFzcyk7XG5cdFx0XHRcdHJldHVybiByZXM7XG5cdFx0XHR9KTtcblxuXHRcdFx0Y29uc3QgbGF5b3V0ID0gdGhpcy5nZXRMYXlvdXQob3B0cywgZWxlbWVudHMpO1xuXHRcdFx0bGF5b3V0LmJveGVzLmZvckVhY2goKGJveCwgaWR4KSA9PiB7XG5cdFx0XHRcdGNvbnN0IGVsZW0gPSBjaGlsZHJlbltpZHhdO1xuXHRcdFx0XHR0aGlzLmNzcyhlbGVtLCAncG9zaXRpb24nLCAnYWJzb2x1dGUnKTtcblx0XHRcdFx0Y29uc3QgYWN0dWFsV2lkdGggPVxuXHRcdFx0XHRcdGJveC53aWR0aCAtXG5cdFx0XHRcdFx0LXRoaXMuZ2V0Q1NTTnVtYmVyKGVsZW0sICdtYXJnaW4tbGVmdCcpIC1cblx0XHRcdFx0XHR0aGlzLmdldENTU051bWJlcihlbGVtLCAnbWFyZ2luLXJpZ2h0JykgLVxuXHRcdFx0XHRcdCh0aGlzLmNzcyhlbGVtLCAnYm94LXNpemluZycpICE9PSAnYm9yZGVyLWJveCdcblx0XHRcdFx0XHRcdD8gdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ3BhZGRpbmctbGVmdCcpICtcblx0XHRcdFx0XHRcdCAgdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ3BhZGRpbmctcmlnaHQnKSArXG5cdFx0XHRcdFx0XHQgIHRoaXMuZ2V0Q1NTTnVtYmVyKGVsZW0sICdib3JkZXItbGVmdCcpICtcblx0XHRcdFx0XHRcdCAgdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ2JvcmRlci1yaWdodCcpXG5cdFx0XHRcdFx0XHQ6IDApO1xuXG5cdFx0XHRcdGNvbnN0IGFjdHVhbEhlaWdodCA9XG5cdFx0XHRcdFx0Ym94LmhlaWdodCAtXG5cdFx0XHRcdFx0LXRoaXMuZ2V0Q1NTTnVtYmVyKGVsZW0sICdtYXJnaW4tdG9wJykgLVxuXHRcdFx0XHRcdHRoaXMuZ2V0Q1NTTnVtYmVyKGVsZW0sICdtYXJnaW4tYm90dG9tJykgLVxuXHRcdFx0XHRcdCh0aGlzLmNzcyhlbGVtLCAnYm94LXNpemluZycpICE9PSAnYm9yZGVyLWJveCdcblx0XHRcdFx0XHRcdD8gdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ3BhZGRpbmctdG9wJykgK1xuXHRcdFx0XHRcdFx0ICB0aGlzLmdldENTU051bWJlcihlbGVtLCAncGFkZGluZy1ib3R0b20nKSArXG5cdFx0XHRcdFx0XHQgIHRoaXMuZ2V0Q1NTTnVtYmVyKGVsZW0sICdib3JkZXItdG9wJykgK1xuXHRcdFx0XHRcdFx0ICB0aGlzLmdldENTU051bWJlcihlbGVtLCAnYm9yZGVyLWJvdHRvbScpXG5cdFx0XHRcdFx0XHQ6IDApO1xuXG5cdFx0XHRcdHRoaXMucG9zaXRpb25FbGVtZW50KGVsZW0sIGJveC5sZWZ0LCBib3gudG9wLCBhY3R1YWxXaWR0aCwgYWN0dWFsSGVpZ2h0LCB0aGlzLm9wdHMuYW5pbWF0ZSk7XG5cdFx0XHR9KTtcblx0XHR9LCA1MCk7XG5cdH1cblxuXHQvKipcblx0ICogSW5pdGlhbGl6ZSB0aGUgbGF5b3V0IGluc2lkZSBvZiB0aGUgY29udGFpbmVyIHdpdGggdGhlIG9wdGlvbnMgcmVxdWlyZWRcblx0ICogQHBhcmFtIGNvbnRhaW5lclxuXHQgKiBAcGFyYW0gb3B0c1xuXHQgKi9cblx0aW5pdExheW91dENvbnRhaW5lcihjb250YWluZXI6IEhUTUxFbGVtZW50LCBvcHRzOiBPcGVuVmlkdUxheW91dE9wdGlvbnMpIHtcblx0XHQvLyB0aGlzLm9wdHMgPSB0aGlzLmRlZmF1bHRzKG9wdHMsIHtcblx0XHQvLyAgIG1heFJhdGlvOiAzIC8gMixcblx0XHQvLyAgIG1pblJhdGlvOiA5IC8gMTYsXG5cdFx0Ly8gICBmaXhlZFJhdGlvOiBmYWxzZSxcblx0XHQvLyAgIGFuaW1hdGU6IGZhbHNlLFxuXHRcdC8vICAgYmlnQ2xhc3M6IExheW91dENsYXNzLkJJR19FTEVNRU5ULFxuXHRcdC8vICAgc21hbGxDbGFzczogTGF5b3V0Q2xhc3MuU01BTExfRUxFTUVOVCxcblx0XHQvLyAgIGJpZ1BlcmNlbnRhZ2U6IDAuOCxcblx0XHQvLyAgIGJpZ0ZpeGVkUmF0aW86IGZhbHNlLFxuXHRcdC8vICAgYmlnTWF4UmF0aW86IDMgLyAyLFxuXHRcdC8vICAgYmlnTWluUmF0aW86IDkgLyAxNixcblx0XHQvLyAgIGJpZ0ZpcnN0OiB0cnVlLFxuXHRcdC8vICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG5cdFx0Ly8gICBiaWdBbGlnbkl0ZW1zOiAnY2VudGVyJyxcblx0XHQvLyAgIHNtYWxsQWxpZ25JdGVtczogJ2NlbnRlcidcblx0XHQvLyB9KTtcblx0XHR0aGlzLm9wdHMgPSBvcHRzO1xuXHRcdHRoaXMubGF5b3V0Q29udGFpbmVyID0gY29udGFpbmVyO1xuXHRcdHRoaXMudXBkYXRlTGF5b3V0KGNvbnRhaW5lciwgb3B0cyk7XG5cdH1cblxuXHRnZXRMYXlvdXRDb250YWluZXIoKTogSFRNTEVsZW1lbnQge1xuXHRcdHJldHVybiB0aGlzLmxheW91dENvbnRhaW5lcjtcblx0fVxuXG5cdC8qKlxuXHQgKiBTZXQgdGhlIGxheW91dCBjb25maWd1cmF0aW9uXG5cdCAqIEBwYXJhbSBvcHRpb25zXG5cdCAqL1xuXHQvLyBwcml2YXRlIHNldExheW91dE9wdGlvbnMob3B0aW9uczogT3BlblZpZHVMYXlvdXRPcHRpb25zKSB7XG5cdC8vIFx0dGhpcy5vcHRzID0gb3B0aW9ucztcblx0Ly8gfVxuXG5cdHByaXZhdGUgY3NzKGVsOiBIVE1MVmlkZW9FbGVtZW50IHwgSFRNTEVsZW1lbnQsIHByb3BlcnR5TmFtZTogYW55LCB2YWx1ZT86IHN0cmluZykge1xuXHRcdGlmICghIXZhbHVlKSB7XG5cdFx0XHQvLyBXZSBhcmUgc2V0dGluZyBvbmUgY3NzIHByb3BlcnR5XG5cdFx0XHRlbC5zdHlsZVtwcm9wZXJ0eU5hbWVdID0gdmFsdWU7XG5cdFx0XHRyZXR1cm4gTmFOO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mIHByb3BlcnR5TmFtZSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdC8vIFdlIGFyZSBzZXR0aW5nIHNldmVyYWwgQ1NTIHByb3BlcnRpZXMgYXQgb25jZVxuXHRcdFx0T2JqZWN0LmtleXMocHJvcGVydHlOYW1lKS5mb3JFYWNoKChrZXkpID0+IHtcblx0XHRcdFx0dGhpcy5jc3MoZWwsIGtleSwgcHJvcGVydHlOYW1lW2tleV0pO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gTmFOO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBXZSBhcmUgZ2V0dGluZyB0aGUgY3NzIHByb3BlcnR5XG5cdFx0XHR2YXIgY29tcHV0ZWRTdHlsZSA9IC8qKHRoaXMub3B0cyAmJiB0aGlzLm9wdHMud2luZG93KSB8fCovIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKTtcblx0XHRcdHZhciBjdXJyZW50VmFsdWUgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUocHJvcGVydHlOYW1lKTtcblxuXHRcdFx0aWYgKGN1cnJlbnRWYWx1ZSA9PT0gJycpIHtcblx0XHRcdFx0Y3VycmVudFZhbHVlID0gZWwuc3R5bGVbcHJvcGVydHlOYW1lXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGN1cnJlbnRWYWx1ZTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGhlaWdodChlbCkge1xuXHRcdGlmIChlbC5vZmZzZXRIZWlnaHQgPiAwKSB7XG5cdFx0XHRyZXR1cm4gYCR7ZWwub2Zmc2V0SGVpZ2h0fXB4YDtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuY3NzKGVsLCAnaGVpZ2h0Jyk7XG5cdH1cblx0cHJpdmF0ZSB3aWR0aChlbCkge1xuXHRcdGlmIChlbC5vZmZzZXRXaWR0aCA+IDApIHtcblx0XHRcdHJldHVybiBgJHtlbC5vZmZzZXRXaWR0aH1weGA7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLmNzcyhlbCwgJ3dpZHRoJyk7XG5cdH1cblx0cHJpdmF0ZSBkZWZhdWx0cyhjdXN0b206IE9wZW5WaWR1TGF5b3V0T3B0aW9ucywgZGVmYXVsdHM6IE9wZW5WaWR1TGF5b3V0T3B0aW9ucyk6IE9wZW5WaWR1TGF5b3V0T3B0aW9ucyB7XG5cdFx0dmFyIHJlcyA9IGRlZmF1bHRzO1xuXHRcdE9iamVjdC5rZXlzKGRlZmF1bHRzKS5mb3JFYWNoKChrZXkpID0+IHtcblx0XHRcdGlmIChjdXN0b20uaGFzT3duUHJvcGVydHkoa2V5KSkge1xuXHRcdFx0XHRyZXNba2V5XSA9IGN1c3RvbVtrZXldO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdHJldHVybiByZXM7XG5cdH1cblxuXHQvKipcblx0ICogQGhpZGRlblxuXHQgKi9cblx0cHJpdmF0ZSBmaXhBc3BlY3RSYXRpbyhlbGVtOiBIVE1MVmlkZW9FbGVtZW50LCB3aWR0aDogbnVtYmVyKSB7XG5cdFx0Y29uc3Qgc3ViOiBIVE1MVmlkZW9FbGVtZW50ID0gPEhUTUxWaWRlb0VsZW1lbnQ+ZWxlbS5xdWVyeVNlbGVjdG9yKGAuJHtMYXlvdXRDbGFzcy5ST09UX0VMRU1FTlR9YCk7XG5cdFx0aWYgKHN1Yikge1xuXHRcdFx0Ly8gSWYgdGhpcyBpcyB0aGUgcGFyZW50IG9mIGEgc3Vic2NyaWJlciBvciBwdWJsaXNoZXIgdGhlbiB3ZSBuZWVkXG5cdFx0XHQvLyB0byBmb3JjZSB0aGUgbXV0YXRpb24gb2JzZXJ2ZXIgb24gdGhlIHB1Ymxpc2hlciBvciBzdWJzY3JpYmVyIHRvXG5cdFx0XHQvLyB0cmlnZ2VyIHRvIGdldCBpdCB0byBmaXggaXQncyBsYXlvdXRcblx0XHRcdGNvbnN0IG9sZFdpZHRoID0gc3ViLnN0eWxlLndpZHRoO1xuXHRcdFx0c3ViLnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgO1xuXHRcdFx0Ly8gc3ViLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7XG5cdFx0XHRzdWIuc3R5bGUud2lkdGggPSBvbGRXaWR0aCB8fCAnJztcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQGhpZGRlblxuXHQgKi9cblx0cHJpdmF0ZSBwb3NpdGlvbkVsZW1lbnQoZWxlbTogSFRNTFZpZGVvRWxlbWVudCwgeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBhbmltYXRlOiBhbnkpIHtcblx0XHRjb25zdCB0YXJnZXRQb3NpdGlvbiA9IHtcblx0XHRcdGxlZnQ6IGAke3h9cHhgLFxuXHRcdFx0dG9wOiBgJHt5fXB4YCxcblx0XHRcdHdpZHRoOiBgJHt3aWR0aH1weGAsXG5cdFx0XHRoZWlnaHQ6IGAke2hlaWdodH1weGBcblx0XHR9O1xuXG5cdFx0dGhpcy5maXhBc3BlY3RSYXRpbyhlbGVtLCB3aWR0aCk7XG5cblx0XHRpZiAoYW5pbWF0ZSkge1xuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdC8vIGFuaW1hdGlvbiBhZGRlZCBpbiBjc3MgdHJhbnNpdGlvbjogYWxsIC4xcyBsaW5lYXI7XG5cdFx0XHRcdGVsZW0uc3R5bGUubGVmdCA9IHRhcmdldFBvc2l0aW9uLmxlZnQ7XG5cdFx0XHRcdGVsZW0uc3R5bGUudG9wID0gdGFyZ2V0UG9zaXRpb24udG9wO1xuXHRcdFx0XHRlbGVtLnN0eWxlLndpZHRoID0gdGFyZ2V0UG9zaXRpb24ud2lkdGg7XG5cdFx0XHRcdGVsZW0uc3R5bGUuaGVpZ2h0ID0gdGFyZ2V0UG9zaXRpb24uaGVpZ2h0O1xuXHRcdFx0XHR0aGlzLmZpeEFzcGVjdFJhdGlvKGVsZW0sIHdpZHRoKTtcblx0XHRcdH0sIDEwKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5jc3MoZWxlbSwgdGFyZ2V0UG9zaXRpb24pO1xuXHRcdFx0aWYgKCFlbGVtLmNsYXNzTGlzdC5jb250YWlucyhMYXlvdXRDbGFzcy5DTEFTU19OQU1FKSkge1xuXHRcdFx0XHRlbGVtLmNsYXNzTGlzdC5hZGQoTGF5b3V0Q2xhc3MuQ0xBU1NfTkFNRSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHRoaXMuZml4QXNwZWN0UmF0aW8oZWxlbSwgd2lkdGgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBoaWRkZW5cblx0ICovXG5cdHByaXZhdGUgZ2V0Q2hpbGREaW1zKGNoaWxkOiBIVE1MVmlkZW9FbGVtZW50KToge1xuXHRcdGhlaWdodDogbnVtYmVyO1xuXHRcdHdpZHRoOiBudW1iZXI7XG5cdFx0YmlnPzogYm9vbGVhbjtcblx0fSB7XG5cdFx0aWYgKGNoaWxkKSB7XG5cdFx0XHRpZiAoY2hpbGQudmlkZW9IZWlnaHQgJiYgY2hpbGQudmlkZW9XaWR0aCkge1xuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdGhlaWdodDogY2hpbGQudmlkZW9IZWlnaHQsXG5cdFx0XHRcdFx0d2lkdGg6IGNoaWxkLnZpZGVvV2lkdGhcblx0XHRcdFx0fTtcblx0XHRcdH1cblx0XHRcdGNvbnN0IHZpZGVvOiBIVE1MVmlkZW9FbGVtZW50ID0gPEhUTUxWaWRlb0VsZW1lbnQ+Y2hpbGQucXVlcnlTZWxlY3RvcigndmlkZW8nKTtcblx0XHRcdGlmICh2aWRlbyAmJiB2aWRlby52aWRlb0hlaWdodCAmJiB2aWRlby52aWRlb1dpZHRoKSB7XG5cdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0aGVpZ2h0OiB2aWRlby52aWRlb0hlaWdodCxcblx0XHRcdFx0XHR3aWR0aDogdmlkZW8udmlkZW9XaWR0aFxuXHRcdFx0XHR9O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4ge1xuXHRcdFx0aGVpZ2h0OiA0ODAsXG5cdFx0XHR3aWR0aDogNjQwXG5cdFx0fTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaGlkZGVuXG5cdCAqL1xuXHRwcml2YXRlIGdldENTU051bWJlcihlbGVtOiBIVE1MRWxlbWVudCwgcHJvcDogc3RyaW5nKSB7XG5cdFx0Y29uc3QgY3NzU3RyID0gdGhpcy5jc3MoZWxlbSwgcHJvcCk7XG5cblx0XHRyZXR1cm4gY3NzU3RyID8gcGFyc2VJbnQoY3NzU3RyLnRvU3RyaW5nKCksIDEwKSA6IDA7XG5cdH1cblxuXHQvKipcblx0ICogQGhpZGRlblxuXHQgKi9cblx0Ly8gUmVhbGx5IGNoZWFwIFVVSUQgZnVuY3Rpb25cblx0cHJpdmF0ZSBjaGVhcFVVSUQoKSB7XG5cdFx0cmV0dXJuIChNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwKS50b0ZpeGVkKDApO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBoaWRkZW5cblx0ICovXG5cdHByaXZhdGUgZ2V0SGVpZ2h0KGVsZW06IEhUTUxFbGVtZW50KSB7XG5cdFx0Y29uc3QgaGVpZ2h0U3RyID0gdGhpcy5oZWlnaHQoZWxlbSk7XG5cdFx0cmV0dXJuIGhlaWdodFN0ciA/IHBhcnNlSW50KGhlaWdodFN0ci50b1N0cmluZygpLCAxMCkgOiAwO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBoaWRkZW5cblx0ICovXG5cdHByaXZhdGUgZ2V0V2lkdGgoZWxlbTogSFRNTEVsZW1lbnQpIHtcblx0XHRjb25zdCB3aWR0aFN0ciA9IHRoaXMud2lkdGgoZWxlbSk7XG5cdFx0cmV0dXJuIHdpZHRoU3RyID8gcGFyc2VJbnQod2lkdGhTdHIudG9TdHJpbmcoKSwgMTApIDogMDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaGlkZGVuXG5cdCAqL1xuXHQvLyBwcml2YXRlIGFycmFuZ2UoXG5cdC8vICAgY2hpbGRyZW46IEhUTUxWaWRlb0VsZW1lbnRbXSxcblx0Ly8gICBjb250YWluZXJXaWR0aDogbnVtYmVyLFxuXHQvLyAgIGNvbnRhaW5lckhlaWdodDogbnVtYmVyLFxuXHQvLyAgIG9mZnNldExlZnQ6IG51bWJlcixcblx0Ly8gICBvZmZzZXRUb3A6IG51bWJlcixcblx0Ly8gICBmaXhlZFJhdGlvOiBib29sZWFuLFxuXHQvLyAgIG1pblJhdGlvOiBudW1iZXIsXG5cdC8vICAgbWF4UmF0aW86IG51bWJlcixcblx0Ly8gICBhbmltYXRlOiBhbnlcblx0Ly8gKSB7XG5cdC8vIGNvbnN0IGJveGVzID0gdGhpcy5nZXRMYXlvdXQoXG5cdC8vICAge1xuXHQvLyAgICAgY29udGFpbmVyV2lkdGgsXG5cdC8vICAgICBjb250YWluZXJIZWlnaHQsXG5cdC8vICAgICBtaW5SYXRpbyxcblx0Ly8gICAgIG1heFJhdGlvLFxuXHQvLyAgICAgZml4ZWRSYXRpbyxcblx0Ly8gICB9LFxuXHQvLyAgIGNoaWxkcmVuLm1hcCgoY2hpbGQpID0+IHRoaXMuZ2V0VmlkZW9SYXRpbyhjaGlsZCkpXG5cdC8vICk7XG5cblx0Ly8gYm94ZXMuZm9yRWFjaCgoYm94LCBpZHgpID0+IHtcblx0Ly8gICBjb25zdCBlbGVtID0gY2hpbGRyZW5baWR4XTtcblx0Ly8gICB0aGlzLmNzcyhlbGVtLCAncG9zaXRpb24nLCAnYWJzb2x1dGUnKTtcblx0Ly8gICBjb25zdCBhY3R1YWxXaWR0aCA9XG5cdC8vICAgICBib3gud2lkdGggLVxuXHQvLyAgICAgdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ3BhZGRpbmdMZWZ0JykgLVxuXHQvLyAgICAgdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ3BhZGRpbmdSaWdodCcpIC1cblx0Ly8gICAgIHRoaXMuZ2V0Q1NTTnVtYmVyKGVsZW0sICdtYXJnaW5MZWZ0JykgLVxuXHQvLyAgICAgdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ21hcmdpblJpZ2h0JykgLVxuXHQvLyAgICAgdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ2JvcmRlckxlZnQnKSAtXG5cdC8vICAgICB0aGlzLmdldENTU051bWJlcihlbGVtLCAnYm9yZGVyUmlnaHQnKTtcblxuXHQvLyAgIGNvbnN0IGFjdHVhbEhlaWdodCA9XG5cdC8vICAgICBib3guaGVpZ2h0IC1cblx0Ly8gICAgIHRoaXMuZ2V0Q1NTTnVtYmVyKGVsZW0sICdwYWRkaW5nVG9wJykgLVxuXHQvLyAgICAgdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ3BhZGRpbmdCb3R0b20nKSAtXG5cdC8vICAgICB0aGlzLmdldENTU051bWJlcihlbGVtLCAnbWFyZ2luVG9wJykgLVxuXHQvLyAgICAgdGhpcy5nZXRDU1NOdW1iZXIoZWxlbSwgJ21hcmdpbkJvdHRvbScpIC1cblx0Ly8gICAgIHRoaXMuZ2V0Q1NTTnVtYmVyKGVsZW0sICdib3JkZXJUb3AnKSAtXG5cdC8vICAgICB0aGlzLmdldENTU051bWJlcihlbGVtLCAnYm9yZGVyQm90dG9tJyk7XG5cblx0Ly8gICB0aGlzLnBvc2l0aW9uRWxlbWVudChcblx0Ly8gICAgIGVsZW0sXG5cdC8vICAgICBib3gubGVmdCArIG9mZnNldExlZnQsXG5cdC8vICAgICBib3gudG9wICsgb2Zmc2V0VG9wLFxuXHQvLyAgICAgYWN0dWFsV2lkdGgsXG5cdC8vICAgICBhY3R1YWxIZWlnaHQsXG5cdC8vICAgICBhbmltYXRlXG5cdC8vICAgKTtcblx0Ly8gfSk7XG5cdC8vIH1cblxuXHQvKipcblx0ICogQGhpZGRlblxuXHQgKi9cblx0Ly8gcHJpdmF0ZSBhdHRhY2hFbGVtZW50cyhcblx0Ly8gICBiaWdPbmVzOiBIVE1MVmlkZW9FbGVtZW50W10sXG5cdC8vICAgbm9ybWFsT25lczogSFRNTFZpZGVvRWxlbWVudFtdLFxuXHQvLyAgIHNtYWxsT25lczogSFRNTFZpZGVvRWxlbWVudFtdXG5cdC8vICkge1xuXHQvLyAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9XG5cdC8vICAgICB0aGlzLmdldEhlaWdodCh0aGlzLmxheW91dENvbnRhaW5lcikgLVxuXHQvLyAgICAgdGhpcy5nZXRDU1NOdW1iZXIodGhpcy5sYXlvdXRDb250YWluZXIsICdib3JkZXJUb3AnKSAtXG5cdC8vICAgICB0aGlzLmdldENTU051bWJlcih0aGlzLmxheW91dENvbnRhaW5lciwgJ2JvcmRlckJvdHRvbScpO1xuXHQvLyAgIGNvbnN0IGNvbnRhaW5lcldpZHRoID1cblx0Ly8gICAgIHRoaXMuZ2V0V2lkdGgodGhpcy5sYXlvdXRDb250YWluZXIpIC1cblx0Ly8gICAgIHRoaXMuZ2V0Q1NTTnVtYmVyKHRoaXMubGF5b3V0Q29udGFpbmVyLCAnYm9yZGVyTGVmdCcpIC1cblx0Ly8gICAgIHRoaXMuZ2V0Q1NTTnVtYmVyKHRoaXMubGF5b3V0Q29udGFpbmVyLCAnYm9yZGVyUmlnaHQnKTtcblx0Ly8gICBjb25zdCBvZmZzZXRMZWZ0ID0gMDtcblx0Ly8gICBjb25zdCBvZmZzZXRUb3AgPSAwO1xuXHQvLyAgIGlmICh0aGlzLmV4aXN0QmlnQW5kTm9ybWFsT25lcyhiaWdPbmVzLCBub3JtYWxPbmVzLCBzbWFsbE9uZXMpKSB7XG5cdC8vICAgICBjb25zdCBzbWFsbE9uZXNBdXggPSBzbWFsbE9uZXMubGVuZ3RoID4gMCA/IHNtYWxsT25lcyA6IG5vcm1hbE9uZXM7XG5cdC8vICAgICBjb25zdCBiaWdPbmVzQXV4ID0gYmlnT25lcy5sZW5ndGggPiAwID8gYmlnT25lcyA6IG5vcm1hbE9uZXM7XG5cdC8vICAgICB0aGlzLmFycmFuZ2VCaWdBbmRTbWFsbE9uZXMoYmlnT25lc0F1eCwgc21hbGxPbmVzQXV4LCB7XG5cdC8vICAgICAgIGNvbnRhaW5lckhlaWdodCxcblx0Ly8gICAgICAgY29udGFpbmVyV2lkdGgsXG5cdC8vICAgICB9KTtcblx0Ly8gICB9IGVsc2UgaWYgKHRoaXMub25seUV4aXN0QmlnT25lcyhiaWdPbmVzLCBub3JtYWxPbmVzLCBzbWFsbE9uZXMpKSB7XG5cdC8vICAgICAvLyBXZSBvbmx5IGhhdmUgb25lIGJpZ09uZSBqdXN0IGNlbnRlciBpdFxuXHQvLyAgICAgdGhpcy5hcnJhbmdlKFxuXHQvLyAgICAgICBiaWdPbmVzLFxuXHQvLyAgICAgICBjb250YWluZXJXaWR0aCxcblx0Ly8gICAgICAgY29udGFpbmVySGVpZ2h0LFxuXHQvLyAgICAgICAwLFxuXHQvLyAgICAgICAwLFxuXHQvLyAgICAgICB0aGlzLm9wdHMuYmlnRml4ZWRSYXRpbyxcblx0Ly8gICAgICAgdGhpcy5vcHRzLmJpZ01pblJhdGlvLFxuXHQvLyAgICAgICB0aGlzLm9wdHMuYmlnTWF4UmF0aW8sXG5cdC8vICAgICAgIHRoaXMub3B0cy5hbmltYXRlXG5cdC8vICAgICApO1xuXHQvLyAgIH0gZWxzZSBpZiAoXG5cdC8vICAgICB0aGlzLmV4aXN0QmlnQW5kTm9ybWFsQW5kU21hbGxPbmVzKGJpZ09uZXMsIG5vcm1hbE9uZXMsIHNtYWxsT25lcylcblx0Ly8gICApIHtcblx0Ly8gICAgIHRoaXMuYXJyYW5nZUJpZ0FuZFNtYWxsT25lcyhiaWdPbmVzLCBub3JtYWxPbmVzLmNvbmNhdChzbWFsbE9uZXMpLCB7XG5cdC8vICAgICAgIGNvbnRhaW5lckhlaWdodCxcblx0Ly8gICAgICAgY29udGFpbmVyV2lkdGgsXG5cdC8vICAgICB9KTtcblx0Ly8gICB9IGVsc2Uge1xuXHQvLyAgICAgY29uc3Qgbm9ybWFsT25lc0F1eCA9IG5vcm1hbE9uZXMuY29uY2F0KHNtYWxsT25lcyk7XG5cdC8vICAgICB0aGlzLmFycmFuZ2UoXG5cdC8vICAgICAgIG5vcm1hbE9uZXNBdXgsXG5cdC8vICAgICAgIGNvbnRhaW5lcldpZHRoIC0gb2Zmc2V0TGVmdCxcblx0Ly8gICAgICAgY29udGFpbmVySGVpZ2h0IC0gb2Zmc2V0VG9wLFxuXHQvLyAgICAgICBvZmZzZXRMZWZ0LFxuXHQvLyAgICAgICBvZmZzZXRUb3AsXG5cdC8vICAgICAgIHRoaXMub3B0cy5maXhlZFJhdGlvLFxuXHQvLyAgICAgICB0aGlzLm9wdHMubWluUmF0aW8sXG5cdC8vICAgICAgIHRoaXMub3B0cy5tYXhSYXRpbyxcblx0Ly8gICAgICAgdGhpcy5vcHRzLmFuaW1hdGVcblx0Ly8gICAgICk7XG5cdC8vICAgfVxuXHQvLyB9XG5cblx0LyoqXG5cdCAqIEBoaWRkZW5cblx0ICovXG5cdC8vIHByaXZhdGUgYXJyYW5nZUJpZ0FuZFNtYWxsT25lcyhcblx0Ly8gICBiaWdPbmVzQXV4OiBIVE1MVmlkZW9FbGVtZW50W10sXG5cdC8vICAgc21hbGxPbmVzQXV4OiBIVE1MVmlkZW9FbGVtZW50W10sXG5cdC8vICAgZGF0YTogeyBjb250YWluZXJIZWlnaHQ6IG51bWJlcjsgY29udGFpbmVyV2lkdGg6IG51bWJlciB9XG5cdC8vICkge1xuXHQvLyAgIGNvbnN0IHsgY29udGFpbmVyV2lkdGgsIGNvbnRhaW5lckhlaWdodCB9ID0gZGF0YTtcblx0Ly8gICBsZXQgb2Zmc2V0TGVmdCA9IDA7XG5cdC8vICAgbGV0IG9mZnNldFRvcCA9IDA7XG5cdC8vICAgY29uc3QgYXZhaWxhYmxlUmF0aW8gPSBjb250YWluZXJIZWlnaHQgLyBjb250YWluZXJXaWR0aDtcblx0Ly8gICBsZXQgYmlnT2Zmc2V0VG9wID0gMDtcblx0Ly8gICBsZXQgYmlnT2Zmc2V0TGVmdCA9IDA7XG5cdC8vICAgbGV0IGJpZ1dpZHRoLCBiaWdIZWlnaHQ7XG5cdC8vICAgaWYgKGF2YWlsYWJsZVJhdGlvID4gdGhpcy5nZXRWaWRlb1JhdGlvKGJpZ09uZXNBdXhbMF0pKSB7XG5cdC8vICAgICAvLyBXZSBhcmUgdGFsbCwgZ29pbmcgdG8gdGFrZSB1cCB0aGUgd2hvbGUgd2lkdGggYW5kIGFycmFuZ2Ugc21hbGxcblx0Ly8gICAgIC8vIGd1eXMgYXQgdGhlIGJvdHRvbVxuXHQvLyAgICAgYmlnV2lkdGggPSBjb250YWluZXJXaWR0aDtcblx0Ly8gICAgIGJpZ0hlaWdodCA9IE1hdGguZmxvb3IoY29udGFpbmVySGVpZ2h0ICogdGhpcy5vcHRzLmJpZ1BlcmNlbnRhZ2UpO1xuXHQvLyAgICAgb2Zmc2V0VG9wID0gYmlnSGVpZ2h0O1xuXHQvLyAgICAgYmlnT2Zmc2V0VG9wID0gY29udGFpbmVySGVpZ2h0IC0gb2Zmc2V0VG9wO1xuXHQvLyAgIH0gZWxzZSB7XG5cdC8vICAgICAvLyBXZSBhcmUgd2lkZSwgZ29pbmcgdG8gdGFrZSB1cCB0aGUgd2hvbGUgaGVpZ2h0IGFuZCBhcnJhbmdlIHRoZSBzbWFsbFxuXHQvLyAgICAgLy8gZ3V5cyBvbiB0aGUgcmlnaHRcblx0Ly8gICAgIGJpZ0hlaWdodCA9IGNvbnRhaW5lckhlaWdodDtcblx0Ly8gICAgIGJpZ1dpZHRoID0gTWF0aC5mbG9vcihjb250YWluZXJXaWR0aCAqIHRoaXMub3B0cy5iaWdQZXJjZW50YWdlKTtcblx0Ly8gICAgIG9mZnNldExlZnQgPSBiaWdXaWR0aDtcblx0Ly8gICAgIGJpZ09mZnNldExlZnQgPSBjb250YWluZXJXaWR0aCAtIG9mZnNldExlZnQ7XG5cdC8vICAgfVxuXHQvLyAgIGlmICh0aGlzLm9wdHMuYmlnRmlyc3QpIHtcblx0Ly8gICAgIHRoaXMuYXJyYW5nZShcblx0Ly8gICAgICAgYmlnT25lc0F1eCxcblx0Ly8gICAgICAgYmlnV2lkdGgsXG5cdC8vICAgICAgIGJpZ0hlaWdodCxcblx0Ly8gICAgICAgMCxcblx0Ly8gICAgICAgMCxcblx0Ly8gICAgICAgdGhpcy5vcHRzLmJpZ0ZpeGVkUmF0aW8sXG5cdC8vICAgICAgIHRoaXMub3B0cy5iaWdNaW5SYXRpbyxcblx0Ly8gICAgICAgdGhpcy5vcHRzLmJpZ01heFJhdGlvLFxuXHQvLyAgICAgICB0aGlzLm9wdHMuYW5pbWF0ZVxuXHQvLyAgICAgKTtcblx0Ly8gICAgIHRoaXMuYXJyYW5nZShcblx0Ly8gICAgICAgc21hbGxPbmVzQXV4LFxuXHQvLyAgICAgICBjb250YWluZXJXaWR0aCAtIG9mZnNldExlZnQsXG5cdC8vICAgICAgIGNvbnRhaW5lckhlaWdodCAtIG9mZnNldFRvcCxcblx0Ly8gICAgICAgb2Zmc2V0TGVmdCxcblx0Ly8gICAgICAgb2Zmc2V0VG9wLFxuXHQvLyAgICAgICB0aGlzLm9wdHMuZml4ZWRSYXRpbyxcblx0Ly8gICAgICAgdGhpcy5vcHRzLm1pblJhdGlvLFxuXHQvLyAgICAgICB0aGlzLm9wdHMubWF4UmF0aW8sXG5cdC8vICAgICAgIHRoaXMub3B0cy5hbmltYXRlXG5cdC8vICAgICApO1xuXHQvLyAgIH0gZWxzZSB7XG5cdC8vICAgICB0aGlzLmFycmFuZ2UoXG5cdC8vICAgICAgIHNtYWxsT25lc0F1eCxcblx0Ly8gICAgICAgY29udGFpbmVyV2lkdGggLSBvZmZzZXRMZWZ0LFxuXHQvLyAgICAgICBjb250YWluZXJIZWlnaHQgLSBvZmZzZXRUb3AsXG5cdC8vICAgICAgIDAsXG5cdC8vICAgICAgIDAsXG5cdC8vICAgICAgIHRoaXMub3B0cy5maXhlZFJhdGlvLFxuXHQvLyAgICAgICB0aGlzLm9wdHMubWluUmF0aW8sXG5cdC8vICAgICAgIHRoaXMub3B0cy5tYXhSYXRpbyxcblx0Ly8gICAgICAgdGhpcy5vcHRzLmFuaW1hdGVcblx0Ly8gICAgICk7XG5cdC8vICAgICB0aGlzLmFycmFuZ2UoXG5cdC8vICAgICAgIGJpZ09uZXNBdXgsXG5cdC8vICAgICAgIGJpZ1dpZHRoLFxuXHQvLyAgICAgICBiaWdIZWlnaHQsXG5cdC8vICAgICAgIGJpZ09mZnNldExlZnQsXG5cdC8vICAgICAgIGJpZ09mZnNldFRvcCxcblx0Ly8gICAgICAgdGhpcy5vcHRzLmJpZ0ZpeGVkUmF0aW8sXG5cdC8vICAgICAgIHRoaXMub3B0cy5iaWdNaW5SYXRpbyxcblx0Ly8gICAgICAgdGhpcy5vcHRzLmJpZ01heFJhdGlvLFxuXHQvLyAgICAgICB0aGlzLm9wdHMuYW5pbWF0ZVxuXHQvLyAgICAgKTtcblx0Ly8gICB9XG5cdC8vIH1cblxuXHQvKipcblx0ICogQGhpZGRlblxuXHQgKi9cblx0Ly8gcHJpdmF0ZSBleGlzdEJpZ0FuZE5vcm1hbE9uZXMoXG5cdC8vICAgYmlnT25lczogSFRNTFZpZGVvRWxlbWVudFtdLFxuXHQvLyAgIG5vcm1hbE9uZXM6IEhUTUxWaWRlb0VsZW1lbnRbXSxcblx0Ly8gICBzbWFsbE9uZXM6IEhUTUxWaWRlb0VsZW1lbnRbXVxuXHQvLyApIHtcblx0Ly8gICByZXR1cm4gKFxuXHQvLyAgICAgKGJpZ09uZXMubGVuZ3RoID4gMCAmJiBub3JtYWxPbmVzLmxlbmd0aCA+IDAgJiYgc21hbGxPbmVzLmxlbmd0aCA9PT0gMCkgfHxcblx0Ly8gICAgIChiaWdPbmVzLmxlbmd0aCA+IDAgJiYgbm9ybWFsT25lcy5sZW5ndGggPT09IDAgJiYgc21hbGxPbmVzLmxlbmd0aCA+IDApIHx8XG5cdC8vICAgICAoYmlnT25lcy5sZW5ndGggPT09IDAgJiYgbm9ybWFsT25lcy5sZW5ndGggPiAwICYmIHNtYWxsT25lcy5sZW5ndGggPiAwKVxuXHQvLyAgICk7XG5cdC8vIH1cblxuXHQvKipcblx0ICogQGhpZGRlblxuXHQgKi9cblx0Ly8gcHJpdmF0ZSBvbmx5RXhpc3RCaWdPbmVzKFxuXHQvLyAgIGJpZ09uZXM6IEhUTUxWaWRlb0VsZW1lbnRbXSxcblx0Ly8gICBub3JtYWxPbmVzOiBIVE1MVmlkZW9FbGVtZW50W10sXG5cdC8vICAgc21hbGxPbmVzOiBIVE1MVmlkZW9FbGVtZW50W11cblx0Ly8gKTogYm9vbGVhbiB7XG5cdC8vICAgcmV0dXJuIChcblx0Ly8gICAgIGJpZ09uZXMubGVuZ3RoID4gMCAmJiBub3JtYWxPbmVzLmxlbmd0aCA9PT0gMCAmJiBzbWFsbE9uZXMubGVuZ3RoID09PSAwXG5cdC8vICAgKTtcblx0Ly8gfVxuXG5cdC8qKlxuXHQgKiBAaGlkZGVuXG5cdCAqL1xuXHQvLyBwcml2YXRlIGV4aXN0QmlnQW5kTm9ybWFsQW5kU21hbGxPbmVzKFxuXHQvLyAgIGJpZ09uZXM6IEhUTUxWaWRlb0VsZW1lbnRbXSxcblx0Ly8gICBub3JtYWxPbmVzOiBIVE1MVmlkZW9FbGVtZW50W10sXG5cdC8vICAgc21hbGxPbmVzOiBIVE1MVmlkZW9FbGVtZW50W11cblx0Ly8gKTogYm9vbGVhbiB7XG5cdC8vICAgcmV0dXJuIGJpZ09uZXMubGVuZ3RoID4gMCAmJiBub3JtYWxPbmVzLmxlbmd0aCA+IDAgJiYgc21hbGxPbmVzLmxlbmd0aCA+IDA7XG5cdC8vIH1cblxuXHQvKipcblx0ICogQGhpZGRlblxuXHQgKi9cblx0cHJpdmF0ZSBmaWx0ZXJEaXNwbGF5Tm9uZShlbGVtZW50OiBIVE1MRWxlbWVudCkge1xuXHRcdHJldHVybiB0aGlzLmNzcyhlbGVtZW50LCAnZGlzcGxheScpICE9PSAnbm9uZSc7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0ICpcblx0ICogR0VUIExBWU9VVFxuXHQgKlxuXHQgKlxuXHQgKi9cblxuXHQvKipcblx0ICogQGhpZGRlblxuXHQgKi9cblx0cHJpdmF0ZSBnZXRCZXN0RGltZW5zaW9ucyhcblx0XHRtaW5SYXRpbzogbnVtYmVyLFxuXHRcdG1heFJhdGlvOiBudW1iZXIsXG5cdFx0d2lkdGg6IG51bWJlcixcblx0XHRoZWlnaHQ6IG51bWJlcixcblx0XHRjb3VudDogbnVtYmVyLFxuXHRcdG1heFdpZHRoOiBudW1iZXIsXG5cdFx0bWF4SGVpZ2h0OiBudW1iZXJcblx0KSB7XG5cdFx0bGV0IG1heEFyZWE6IG51bWJlcjtcblx0XHRsZXQgdGFyZ2V0Q29sczogbnVtYmVyO1xuXHRcdGxldCB0YXJnZXRSb3dzOiBudW1iZXI7XG5cdFx0bGV0IHRhcmdldEhlaWdodDogbnVtYmVyO1xuXHRcdGxldCB0YXJnZXRXaWR0aDogbnVtYmVyO1xuXHRcdGxldCB0V2lkdGg6IG51bWJlcjtcblx0XHRsZXQgdEhlaWdodDogbnVtYmVyO1xuXHRcdGxldCB0UmF0aW86IG51bWJlcjtcblxuXHRcdC8vIEl0ZXJhdGUgdGhyb3VnaCBldmVyeSBwb3NzaWJsZSBjb21iaW5hdGlvbiBvZiByb3dzIGFuZCBjb2x1bW5zXG5cdFx0Ly8gYW5kIHNlZSB3aGljaCBvbmUgaGFzIHRoZSBsZWFzdCBhbW91bnQgb2Ygd2hpdGVzcGFjZVxuXHRcdGZvciAobGV0IGkgPSAxOyBpIDw9IGNvdW50OyBpKyspIHtcblx0XHRcdGNvbnN0IGNvbHMgPSBpO1xuXHRcdFx0Y29uc3Qgcm93cyA9IE1hdGguY2VpbChjb3VudCAvIGNvbHMpO1xuXG5cdFx0XHQvLyBUcnkgdGFraW5nIHVwIHRoZSB3aG9sZSBoZWlnaHQgYW5kIHdpZHRoXG5cdFx0XHR0SGVpZ2h0ID0gTWF0aC5mbG9vcihoZWlnaHQgLyByb3dzKTtcblx0XHRcdHRXaWR0aCA9IE1hdGguZmxvb3Iod2lkdGggLyBjb2xzKTtcblxuXHRcdFx0dFJhdGlvID0gdEhlaWdodCAvIHRXaWR0aDtcblx0XHRcdGlmICh0UmF0aW8gPiBtYXhSYXRpbykge1xuXHRcdFx0XHQvLyBXZSB3ZW50IG92ZXIgZGVjcmVhc2UgdGhlIGhlaWdodFxuXHRcdFx0XHR0UmF0aW8gPSBtYXhSYXRpbztcblx0XHRcdFx0dEhlaWdodCA9IHRXaWR0aCAqIHRSYXRpbztcblx0XHRcdH0gZWxzZSBpZiAodFJhdGlvIDwgbWluUmF0aW8pIHtcblx0XHRcdFx0Ly8gV2Ugd2VudCB1bmRlciBkZWNyZWFzZSB0aGUgd2lkdGhcblx0XHRcdFx0dFJhdGlvID0gbWluUmF0aW87XG5cdFx0XHRcdHRXaWR0aCA9IHRIZWlnaHQgLyB0UmF0aW87XG5cdFx0XHR9XG5cblx0XHRcdHRXaWR0aCA9IE1hdGgubWluKG1heFdpZHRoLCB0V2lkdGgpO1xuXHRcdFx0dEhlaWdodCA9IE1hdGgubWluKG1heEhlaWdodCwgdEhlaWdodCk7XG5cdFx0XHRjb25zdCBhcmVhID0gdFdpZHRoICogdEhlaWdodCAqIGNvdW50O1xuXG5cdFx0XHQvLyBJZiB0aGlzIHdpZHRoIGFuZCBoZWlnaHQgdGFrZXMgdXAgdGhlIG1vc3Qgc3BhY2UgdGhlbiB3ZSdyZSBnb2luZyB3aXRoIHRoYXRcblx0XHRcdGlmIChtYXhBcmVhID09PSB1bmRlZmluZWQgfHwgYXJlYSA+PSBtYXhBcmVhKSB7XG5cdFx0XHRcdGlmICghKGFyZWEgPT09IG1heEFyZWEgJiYgY291bnQgJSAoY29scyAqIHJvd3MpID4gY291bnQgJSAodGFyZ2V0Um93cyAqIHRhcmdldENvbHMpKSkge1xuXHRcdFx0XHRcdC8vIEZhdm91ciBldmVuIG51bWJlcnMgb2YgcGFydGljaXBhbnRzIGluIGVhY2ggcm93LCBlZy4gMiBvbiBlYWNoIHJvd1xuXHRcdFx0XHRcdC8vIGluc3RlYWQgb2YgMyBpbiBvbmUgcm93IGFuZCB0aGVuIDEgb24gdGhlIG5leHRcblx0XHRcdFx0XHRtYXhBcmVhID0gYXJlYTtcblx0XHRcdFx0XHR0YXJnZXRIZWlnaHQgPSB0SGVpZ2h0O1xuXHRcdFx0XHRcdHRhcmdldFdpZHRoID0gdFdpZHRoO1xuXHRcdFx0XHRcdHRhcmdldENvbHMgPSBjb2xzO1xuXHRcdFx0XHRcdHRhcmdldFJvd3MgPSByb3dzO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB7XG5cdFx0XHRtYXhBcmVhLFxuXHRcdFx0dGFyZ2V0Q29scyxcblx0XHRcdHRhcmdldFJvd3MsXG5cdFx0XHR0YXJnZXRIZWlnaHQsXG5cdFx0XHR0YXJnZXRXaWR0aCxcblx0XHRcdHJhdGlvOiB0YXJnZXRIZWlnaHQgLyB0YXJnZXRXaWR0aFxuXHRcdH07XG5cdH1cblxuXHRwcml2YXRlIGdldFZpZGVvUmF0aW8oZWxlbWVudDogeyBoZWlnaHQ6IG51bWJlcjsgd2lkdGg6IG51bWJlcjsgYmlnPzogYm9vbGVhbiB9KSB7XG5cdFx0cmV0dXJuIGVsZW1lbnQuaGVpZ2h0IC8gZWxlbWVudC53aWR0aDtcblx0fVxuXHRwcml2YXRlIGdldExheW91dChvcHRzOiBhbnksIGVsZW1lbnRzOiB7IGhlaWdodDogbnVtYmVyOyB3aWR0aDogbnVtYmVyOyBiaWc/OiBib29sZWFuIH1bXSkge1xuXHRcdGNvbnN0IHtcblx0XHRcdG1heFJhdGlvID0gMyAvIDIsXG5cdFx0XHRtaW5SYXRpbyA9IDkgLyAxNixcblx0XHRcdGZpeGVkUmF0aW8gPSBmYWxzZSxcblx0XHRcdGJpZ1BlcmNlbnRhZ2UgPSAwLjgsXG5cdFx0XHRtaW5CaWdQZXJjZW50YWdlID0gMCxcblx0XHRcdGJpZ0ZpeGVkUmF0aW8gPSBmYWxzZSxcblx0XHRcdGJpZ01heFJhdGlvID0gMyAvIDIsXG5cdFx0XHRiaWdNaW5SYXRpbyA9IDkgLyAxNixcblx0XHRcdGJpZ0ZpcnN0ID0gdHJ1ZSxcblx0XHRcdGNvbnRhaW5lcldpZHRoID0gNjQwLFxuXHRcdFx0Y29udGFpbmVySGVpZ2h0ID0gNDgwLFxuXHRcdFx0YWxpZ25JdGVtcyA9ICdjZW50ZXInLFxuXHRcdFx0YmlnQWxpZ25JdGVtcyA9ICdjZW50ZXInLFxuXHRcdFx0c21hbGxBbGlnbkl0ZW1zID0gJ2NlbnRlcicsXG5cdFx0XHRtYXhXaWR0aCA9IEluZmluaXR5LFxuXHRcdFx0bWF4SGVpZ2h0ID0gSW5maW5pdHksXG5cdFx0XHRzbWFsbE1heFdpZHRoID0gSW5maW5pdHksXG5cdFx0XHRzbWFsbE1heEhlaWdodCA9IEluZmluaXR5LFxuXHRcdFx0YmlnTWF4V2lkdGggPSBJbmZpbml0eSxcblx0XHRcdGJpZ01heEhlaWdodCA9IEluZmluaXR5LFxuXHRcdFx0c2NhbGVMYXN0Um93ID0gdHJ1ZSxcblx0XHRcdGJpZ1NjYWxlTGFzdFJvdyA9IHRydWVcblx0XHR9ID0gb3B0cztcblx0XHRjb25zdCBhdmFpbGFibGVSYXRpbyA9IGNvbnRhaW5lckhlaWdodCAvIGNvbnRhaW5lcldpZHRoO1xuXHRcdGxldCBvZmZzZXRMZWZ0ID0gMDtcblx0XHRsZXQgb2Zmc2V0VG9wID0gMDtcblx0XHRsZXQgYmlnT2Zmc2V0VG9wID0gMDtcblx0XHRsZXQgYmlnT2Zmc2V0TGVmdCA9IDA7XG5cdFx0Y29uc3QgYmlnSW5kaWNlcyA9IFtdO1xuXHRcdGxldCBiaWdCb3hlcyA9IFtdO1xuXHRcdGxldCBzbWFsbEJveGVzID0gW107XG5cdFx0bGV0IGFyZWFzOiB7IGJpZzogYW55OyBzbWFsbDogYW55IH0gPSB7IGJpZzogbnVsbCwgc21hbGw6IG51bGwgfTtcblxuXHRcdC8vIE1vdmUgdG8gR2V0IExheW91dFxuXHRcdGNvbnN0IHNtYWxsT25lcyA9IGVsZW1lbnRzLmZpbHRlcigoZWxlbWVudCkgPT4gIWVsZW1lbnQuYmlnKTtcblx0XHRjb25zdCBiaWdPbmVzID0gZWxlbWVudHMuZmlsdGVyKChlbGVtZW50LCBpZHgpID0+IHtcblx0XHRcdGlmIChlbGVtZW50LmJpZykge1xuXHRcdFx0XHRiaWdJbmRpY2VzLnB1c2goaWR4KTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fSk7XG5cdFx0Ly9UT0RPOiBIYWJpYSB1biBjb2RpZ28gcGVyc29uYWxpemFkbyBxdWUgc2VydsOtYSBwYXJhXG5cdFx0Ly9UT0RPOiB0ZW5lciB2aWRlb3MgZ3JhbmRlcywgcGVxdWXDsW9zIHkgbm9ybWFsZXNcblx0XHQvLy5maWx0ZXIoKHgpID0+ICFzbWFsbE9uZXMuaW5jbHVkZXMoeCkpO1xuXG5cdFx0Ly8gY29uc3Qgbm9ybWFsT25lczogSFRNTFZpZGVvRWxlbWVudFtdID0gQXJyYXkucHJvdG90eXBlLmZpbHRlclxuXHRcdC8vICAgLmNhbGwoXG5cdFx0Ly8gICAgIHRoaXMubGF5b3V0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXG5cdFx0Ly8gICAgICAgYCMke2lkfT4qOm5vdCguJHt0aGlzLm9wdHMuYmlnQ2xhc3N9KWBcblx0XHQvLyAgICAgKSxcblx0XHQvLyAgICAgKCkgPT4gdGhpcy5maWx0ZXJEaXNwbGF5Tm9uZVxuXHRcdC8vICAgKVxuXHRcdC8vICAgLmZpbHRlcigoeCkgPT4gIXNtYWxsT25lcy5pbmNsdWRlcyh4KSk7XG5cdFx0Ly8gdGhpcy5hdHRhY2hFbGVtZW50cyhiaWdPbmVzLCBub3JtYWxPbmVzLCBzbWFsbE9uZXMpO1xuXHRcdGlmIChiaWdPbmVzLmxlbmd0aCA+IDAgJiYgc21hbGxPbmVzLmxlbmd0aCA+IDApIHtcblx0XHRcdGxldCBiaWdXaWR0aDtcblx0XHRcdGxldCBiaWdIZWlnaHQ7XG5cdFx0XHRsZXQgc2hvd0JpZ0ZpcnN0ID0gYmlnRmlyc3Q7XG5cblx0XHRcdGlmIChhdmFpbGFibGVSYXRpbyA+IHRoaXMuZ2V0VmlkZW9SYXRpbyhiaWdPbmVzWzBdKSkge1xuXHRcdFx0XHQvLyBXZSBhcmUgdGFsbCwgZ29pbmcgdG8gdGFrZSB1cCB0aGUgd2hvbGUgd2lkdGggYW5kIGFycmFuZ2Ugc21hbGxcblx0XHRcdFx0Ly8gZ3V5cyBhdCB0aGUgYm90dG9tXG5cdFx0XHRcdGJpZ1dpZHRoID0gY29udGFpbmVyV2lkdGg7XG5cdFx0XHRcdGJpZ0hlaWdodCA9IE1hdGguZmxvb3IoY29udGFpbmVySGVpZ2h0ICogYmlnUGVyY2VudGFnZSk7XG5cdFx0XHRcdGlmIChtaW5CaWdQZXJjZW50YWdlID4gMCkge1xuXHRcdFx0XHRcdC8vIEZpbmQgdGhlIGJlc3Qgc2l6ZSBmb3IgdGhlIGJpZyBhcmVhXG5cdFx0XHRcdFx0bGV0IGJpZ0RpbWVuc2lvbnM7XG5cdFx0XHRcdFx0aWYgKCFiaWdGaXhlZFJhdGlvKSB7XG5cdFx0XHRcdFx0XHRiaWdEaW1lbnNpb25zID0gdGhpcy5nZXRCZXN0RGltZW5zaW9ucyhcblx0XHRcdFx0XHRcdFx0YmlnTWluUmF0aW8sXG5cdFx0XHRcdFx0XHRcdGJpZ01heFJhdGlvLFxuXHRcdFx0XHRcdFx0XHRiaWdXaWR0aCxcblx0XHRcdFx0XHRcdFx0YmlnSGVpZ2h0LFxuXHRcdFx0XHRcdFx0XHRiaWdPbmVzLmxlbmd0aCxcblx0XHRcdFx0XHRcdFx0YmlnTWF4V2lkdGgsXG5cdFx0XHRcdFx0XHRcdGJpZ01heEhlaWdodFxuXHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gVXNlIHRoZSByYXRpbyBvZiB0aGUgZmlyc3QgdmlkZW8gZWxlbWVudCB3ZSBmaW5kIHRvIGFwcHJveGltYXRlXG5cdFx0XHRcdFx0XHRjb25zdCByYXRpbyA9IGJpZ09uZXNbMF0uaGVpZ2h0IC8gYmlnT25lc1swXS53aWR0aDtcblx0XHRcdFx0XHRcdGJpZ0RpbWVuc2lvbnMgPSB0aGlzLmdldEJlc3REaW1lbnNpb25zKFxuXHRcdFx0XHRcdFx0XHRyYXRpbyxcblx0XHRcdFx0XHRcdFx0cmF0aW8sXG5cdFx0XHRcdFx0XHRcdGJpZ1dpZHRoLFxuXHRcdFx0XHRcdFx0XHRiaWdIZWlnaHQsXG5cdFx0XHRcdFx0XHRcdGJpZ09uZXMubGVuZ3RoLFxuXHRcdFx0XHRcdFx0XHRiaWdNYXhXaWR0aCxcblx0XHRcdFx0XHRcdFx0YmlnTWF4SGVpZ2h0XG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRiaWdIZWlnaHQgPSBNYXRoLm1heChcblx0XHRcdFx0XHRcdGNvbnRhaW5lckhlaWdodCAqIG1pbkJpZ1BlcmNlbnRhZ2UsXG5cdFx0XHRcdFx0XHRNYXRoLm1pbihiaWdIZWlnaHQsIGJpZ0RpbWVuc2lvbnMudGFyZ2V0SGVpZ2h0ICogYmlnRGltZW5zaW9ucy50YXJnZXRSb3dzKVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0Ly8gRG9uJ3QgYXdrd2FyZGx5IHNjYWxlIHRoZSBzbWFsbCBhcmVhIGJpZ2dlciB0aGFuIHdlIG5lZWQgdG8gYW5kIGVuZCB1cCB3aXRoIGZsb2F0aW5nXG5cdFx0XHRcdFx0Ly8gdmlkZW9zIGluIHRoZSBtaWRkbGVcblx0XHRcdFx0XHRjb25zdCBzbWFsbERpbWVuc2lvbnMgPSB0aGlzLmdldEJlc3REaW1lbnNpb25zKFxuXHRcdFx0XHRcdFx0bWluUmF0aW8sXG5cdFx0XHRcdFx0XHRtYXhSYXRpbyxcblx0XHRcdFx0XHRcdGNvbnRhaW5lcldpZHRoLFxuXHRcdFx0XHRcdFx0Y29udGFpbmVySGVpZ2h0IC0gYmlnSGVpZ2h0LFxuXHRcdFx0XHRcdFx0c21hbGxPbmVzLmxlbmd0aCxcblx0XHRcdFx0XHRcdHNtYWxsTWF4V2lkdGgsXG5cdFx0XHRcdFx0XHRzbWFsbE1heEhlaWdodFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0YmlnSGVpZ2h0ID0gTWF0aC5tYXgoYmlnSGVpZ2h0LCBjb250YWluZXJIZWlnaHQgLSBzbWFsbERpbWVuc2lvbnMudGFyZ2V0Um93cyAqIHNtYWxsRGltZW5zaW9ucy50YXJnZXRIZWlnaHQpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdG9mZnNldFRvcCA9IGJpZ0hlaWdodDtcblx0XHRcdFx0YmlnT2Zmc2V0VG9wID0gY29udGFpbmVySGVpZ2h0IC0gb2Zmc2V0VG9wO1xuXHRcdFx0XHRpZiAoYmlnRmlyc3QgPT09ICdjb2x1bW4nKSB7XG5cdFx0XHRcdFx0c2hvd0JpZ0ZpcnN0ID0gZmFsc2U7XG5cdFx0XHRcdH0gZWxzZSBpZiAoYmlnRmlyc3QgPT09ICdyb3cnKSB7XG5cdFx0XHRcdFx0c2hvd0JpZ0ZpcnN0ID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gV2UgYXJlIHdpZGUsIGdvaW5nIHRvIHRha2UgdXAgdGhlIHdob2xlIGhlaWdodCBhbmQgYXJyYW5nZSB0aGUgc21hbGxcblx0XHRcdFx0Ly8gZ3V5cyBvbiB0aGUgcmlnaHRcblx0XHRcdFx0YmlnSGVpZ2h0ID0gY29udGFpbmVySGVpZ2h0O1xuXHRcdFx0XHRiaWdXaWR0aCA9IE1hdGguZmxvb3IoY29udGFpbmVyV2lkdGggKiBiaWdQZXJjZW50YWdlKTtcblx0XHRcdFx0aWYgKG1pbkJpZ1BlcmNlbnRhZ2UgPiAwKSB7XG5cdFx0XHRcdFx0Ly8gRmluZCB0aGUgYmVzdCBzaXplIGZvciB0aGUgYmlnIGFyZWFcblx0XHRcdFx0XHRsZXQgYmlnRGltZW5zaW9ucztcblx0XHRcdFx0XHRpZiAoIWJpZ0ZpeGVkUmF0aW8pIHtcblx0XHRcdFx0XHRcdGJpZ0RpbWVuc2lvbnMgPSB0aGlzLmdldEJlc3REaW1lbnNpb25zKFxuXHRcdFx0XHRcdFx0XHRiaWdNaW5SYXRpbyxcblx0XHRcdFx0XHRcdFx0YmlnTWF4UmF0aW8sXG5cdFx0XHRcdFx0XHRcdGJpZ1dpZHRoLFxuXHRcdFx0XHRcdFx0XHRiaWdIZWlnaHQsXG5cdFx0XHRcdFx0XHRcdGJpZ09uZXMubGVuZ3RoLFxuXHRcdFx0XHRcdFx0XHRiaWdNYXhXaWR0aCxcblx0XHRcdFx0XHRcdFx0YmlnTWF4SGVpZ2h0XG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyBVc2UgdGhlIHJhdGlvIG9mIHRoZSBmaXJzdCB2aWRlbyBlbGVtZW50IHdlIGZpbmQgdG8gYXBwcm94aW1hdGVcblx0XHRcdFx0XHRcdGNvbnN0IHJhdGlvID0gYmlnT25lc1swXS5oZWlnaHQgLyBiaWdPbmVzWzBdLndpZHRoO1xuXHRcdFx0XHRcdFx0YmlnRGltZW5zaW9ucyA9IHRoaXMuZ2V0QmVzdERpbWVuc2lvbnMoXG5cdFx0XHRcdFx0XHRcdHJhdGlvLFxuXHRcdFx0XHRcdFx0XHRyYXRpbyxcblx0XHRcdFx0XHRcdFx0YmlnV2lkdGgsXG5cdFx0XHRcdFx0XHRcdGJpZ0hlaWdodCxcblx0XHRcdFx0XHRcdFx0YmlnT25lcy5sZW5ndGgsXG5cdFx0XHRcdFx0XHRcdGJpZ01heFdpZHRoLFxuXHRcdFx0XHRcdFx0XHRiaWdNYXhIZWlnaHRcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJpZ1dpZHRoID0gTWF0aC5tYXgoXG5cdFx0XHRcdFx0XHRjb250YWluZXJXaWR0aCAqIG1pbkJpZ1BlcmNlbnRhZ2UsXG5cdFx0XHRcdFx0XHRNYXRoLm1pbihiaWdXaWR0aCwgYmlnRGltZW5zaW9ucy50YXJnZXRXaWR0aCAqIGJpZ0RpbWVuc2lvbnMudGFyZ2V0Q29scylcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdC8vIERvbid0IGF3a3dhcmRseSBzY2FsZSB0aGUgc21hbGwgYXJlYSBiaWdnZXIgdGhhbiB3ZSBuZWVkIHRvIGFuZCBlbmQgdXAgd2l0aCBmbG9hdGluZ1xuXHRcdFx0XHRcdC8vIHZpZGVvcyBpbiB0aGUgbWlkZGxlXG5cdFx0XHRcdFx0Y29uc3Qgc21hbGxEaW1lbnNpb25zID0gdGhpcy5nZXRCZXN0RGltZW5zaW9ucyhcblx0XHRcdFx0XHRcdG1pblJhdGlvLFxuXHRcdFx0XHRcdFx0bWF4UmF0aW8sXG5cdFx0XHRcdFx0XHRjb250YWluZXJXaWR0aCAtIGJpZ1dpZHRoLFxuXHRcdFx0XHRcdFx0Y29udGFpbmVySGVpZ2h0LFxuXHRcdFx0XHRcdFx0c21hbGxPbmVzLmxlbmd0aCxcblx0XHRcdFx0XHRcdHNtYWxsTWF4V2lkdGgsXG5cdFx0XHRcdFx0XHRzbWFsbE1heEhlaWdodFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0YmlnV2lkdGggPSBNYXRoLm1heChiaWdXaWR0aCwgY29udGFpbmVyV2lkdGggLSBzbWFsbERpbWVuc2lvbnMudGFyZ2V0Q29scyAqIHNtYWxsRGltZW5zaW9ucy50YXJnZXRXaWR0aCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0b2Zmc2V0TGVmdCA9IGJpZ1dpZHRoO1xuXHRcdFx0XHRiaWdPZmZzZXRMZWZ0ID0gY29udGFpbmVyV2lkdGggLSBvZmZzZXRMZWZ0O1xuXHRcdFx0XHRpZiAoYmlnRmlyc3QgPT09ICdjb2x1bW4nKSB7XG5cdFx0XHRcdFx0c2hvd0JpZ0ZpcnN0ID0gdHJ1ZTtcblx0XHRcdFx0fSBlbHNlIGlmIChiaWdGaXJzdCA9PT0gJ3JvdycpIHtcblx0XHRcdFx0XHRzaG93QmlnRmlyc3QgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYgKHNob3dCaWdGaXJzdCkge1xuXHRcdFx0XHRhcmVhcy5iaWcgPSB7XG5cdFx0XHRcdFx0dG9wOiAwLFxuXHRcdFx0XHRcdGxlZnQ6IDAsXG5cdFx0XHRcdFx0d2lkdGg6IGJpZ1dpZHRoLFxuXHRcdFx0XHRcdGhlaWdodDogYmlnSGVpZ2h0XG5cdFx0XHRcdH07XG5cdFx0XHRcdGFyZWFzLnNtYWxsID0ge1xuXHRcdFx0XHRcdHRvcDogb2Zmc2V0VG9wLFxuXHRcdFx0XHRcdGxlZnQ6IG9mZnNldExlZnQsXG5cdFx0XHRcdFx0d2lkdGg6IGNvbnRhaW5lcldpZHRoIC0gb2Zmc2V0TGVmdCxcblx0XHRcdFx0XHRoZWlnaHQ6IGNvbnRhaW5lckhlaWdodCAtIG9mZnNldFRvcFxuXHRcdFx0XHR9O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0YXJlYXMuYmlnID0ge1xuXHRcdFx0XHRcdGxlZnQ6IGJpZ09mZnNldExlZnQsXG5cdFx0XHRcdFx0dG9wOiBiaWdPZmZzZXRUb3AsXG5cdFx0XHRcdFx0d2lkdGg6IGJpZ1dpZHRoLFxuXHRcdFx0XHRcdGhlaWdodDogYmlnSGVpZ2h0XG5cdFx0XHRcdH07XG5cdFx0XHRcdGFyZWFzLnNtYWxsID0ge1xuXHRcdFx0XHRcdHRvcDogMCxcblx0XHRcdFx0XHRsZWZ0OiAwLFxuXHRcdFx0XHRcdHdpZHRoOiBjb250YWluZXJXaWR0aCAtIG9mZnNldExlZnQsXG5cdFx0XHRcdFx0aGVpZ2h0OiBjb250YWluZXJIZWlnaHQgLSBvZmZzZXRUb3Bcblx0XHRcdFx0fTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKGJpZ09uZXMubGVuZ3RoID4gMCAmJiBzbWFsbE9uZXMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHQvLyBXZSBvbmx5IGhhdmUgb25lIGJpZ09uZSBqdXN0IGNlbnRlciBpdFxuXHRcdFx0YXJlYXMuYmlnID0ge1xuXHRcdFx0XHR0b3A6IDAsXG5cdFx0XHRcdGxlZnQ6IDAsXG5cdFx0XHRcdHdpZHRoOiBjb250YWluZXJXaWR0aCxcblx0XHRcdFx0aGVpZ2h0OiBjb250YWluZXJIZWlnaHRcblx0XHRcdH07XG5cdFx0fSBlbHNlIHtcblx0XHRcdGFyZWFzLnNtYWxsID0ge1xuXHRcdFx0XHR0b3A6IG9mZnNldFRvcCxcblx0XHRcdFx0bGVmdDogb2Zmc2V0TGVmdCxcblx0XHRcdFx0d2lkdGg6IGNvbnRhaW5lcldpZHRoIC0gb2Zmc2V0TGVmdCxcblx0XHRcdFx0aGVpZ2h0OiBjb250YWluZXJIZWlnaHQgLSBvZmZzZXRUb3Bcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0aWYgKGFyZWFzLmJpZykge1xuXHRcdFx0YmlnQm94ZXMgPSB0aGlzLmdldExheW91dEF1eChcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGNvbnRhaW5lcldpZHRoOiBhcmVhcy5iaWcud2lkdGgsXG5cdFx0XHRcdFx0Y29udGFpbmVySGVpZ2h0OiBhcmVhcy5iaWcuaGVpZ2h0LFxuXHRcdFx0XHRcdG9mZnNldExlZnQ6IGFyZWFzLmJpZy5sZWZ0LFxuXHRcdFx0XHRcdG9mZnNldFRvcDogYXJlYXMuYmlnLnRvcCxcblx0XHRcdFx0XHRmaXhlZFJhdGlvOiBiaWdGaXhlZFJhdGlvLFxuXHRcdFx0XHRcdG1pblJhdGlvOiBiaWdNaW5SYXRpbyxcblx0XHRcdFx0XHRtYXhSYXRpbzogYmlnTWF4UmF0aW8sXG5cdFx0XHRcdFx0YWxpZ25JdGVtczogYmlnQWxpZ25JdGVtcyxcblx0XHRcdFx0XHRtYXhXaWR0aDogYmlnTWF4V2lkdGgsXG5cdFx0XHRcdFx0bWF4SGVpZ2h0OiBiaWdNYXhIZWlnaHQsXG5cdFx0XHRcdFx0c2NhbGVMYXN0Um93OiBiaWdTY2FsZUxhc3RSb3dcblx0XHRcdFx0fSxcblx0XHRcdFx0YmlnT25lc1xuXHRcdFx0KTtcblx0XHR9XG5cdFx0aWYgKGFyZWFzLnNtYWxsKSB7XG5cdFx0XHRzbWFsbEJveGVzID0gdGhpcy5nZXRMYXlvdXRBdXgoXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRjb250YWluZXJXaWR0aDogYXJlYXMuc21hbGwud2lkdGgsXG5cdFx0XHRcdFx0Y29udGFpbmVySGVpZ2h0OiBhcmVhcy5zbWFsbC5oZWlnaHQsXG5cdFx0XHRcdFx0b2Zmc2V0TGVmdDogYXJlYXMuc21hbGwubGVmdCxcblx0XHRcdFx0XHRvZmZzZXRUb3A6IGFyZWFzLnNtYWxsLnRvcCxcblx0XHRcdFx0XHRmaXhlZFJhdGlvLFxuXHRcdFx0XHRcdG1pblJhdGlvLFxuXHRcdFx0XHRcdG1heFJhdGlvLFxuXHRcdFx0XHRcdGFsaWduSXRlbXM6IGFyZWFzLmJpZyA/IHNtYWxsQWxpZ25JdGVtcyA6IGFsaWduSXRlbXMsXG5cdFx0XHRcdFx0bWF4V2lkdGg6IGFyZWFzLmJpZyA/IHNtYWxsTWF4V2lkdGggOiBtYXhXaWR0aCxcblx0XHRcdFx0XHRtYXhIZWlnaHQ6IGFyZWFzLmJpZyA/IHNtYWxsTWF4SGVpZ2h0IDogbWF4SGVpZ2h0LFxuXHRcdFx0XHRcdHNjYWxlTGFzdFJvd1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRzbWFsbE9uZXNcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgYm94ZXMgPSBbXTtcblx0XHRsZXQgYmlnQm94ZXNJZHggPSAwO1xuXHRcdGxldCBzbWFsbEJveGVzSWR4ID0gMDtcblx0XHQvLyBSZWJ1aWxkIHRoZSBhcnJheSBpbiB0aGUgcmlnaHQgb3JkZXIgYmFzZWQgb24gd2hlcmUgdGhlIGJpZ0luZGljZXMgc2hvdWxkIGJlXG5cdFx0ZWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCwgaWR4KSA9PiB7XG5cdFx0XHRpZiAoYmlnSW5kaWNlcy5pbmRleE9mKGlkeCkgPiAtMSkge1xuXHRcdFx0XHRib3hlc1tpZHhdID0gYmlnQm94ZXNbYmlnQm94ZXNJZHhdO1xuXHRcdFx0XHRiaWdCb3hlc0lkeCArPSAxO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ym94ZXNbaWR4XSA9IHNtYWxsQm94ZXNbc21hbGxCb3hlc0lkeF07XG5cdFx0XHRcdHNtYWxsQm94ZXNJZHggKz0gMTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRyZXR1cm4geyBib3hlcywgYXJlYXMgfTtcblx0fVxuXG5cdHByaXZhdGUgZ2V0TGF5b3V0QXV4KG9wdHM6IGFueSwgZWxlbWVudHM6IHsgaGVpZ2h0OiBudW1iZXI7IHdpZHRoOiBudW1iZXI7IGJpZz86IGJvb2xlYW4gfVtdKSB7XG5cdFx0Y29uc3Qge1xuXHRcdFx0bWF4UmF0aW8gPSAzIC8gMixcblx0XHRcdG1pblJhdGlvID0gOSAvIDE2LFxuXHRcdFx0Zml4ZWRSYXRpbyA9IGZhbHNlLFxuXHRcdFx0Y29udGFpbmVyV2lkdGggPSA2NDAsXG5cdFx0XHRjb250YWluZXJIZWlnaHQgPSA0ODAsXG5cdFx0XHRvZmZzZXRMZWZ0ID0gMCxcblx0XHRcdG9mZnNldFRvcCA9IDAsXG5cdFx0XHRhbGlnbkl0ZW1zID0gJ2NlbnRlcicsXG5cdFx0XHRtYXhXaWR0aCA9IEluZmluaXR5LFxuXHRcdFx0bWF4SGVpZ2h0ID0gSW5maW5pdHksXG5cdFx0XHRzY2FsZUxhc3RSb3cgPSB0cnVlXG5cdFx0fSA9IG9wdHM7XG5cdFx0Y29uc3QgcmF0aW9zID0gZWxlbWVudHMubWFwKChlbGVtZW50KSA9PiBlbGVtZW50LmhlaWdodCAvIGVsZW1lbnQud2lkdGgpO1xuXHRcdGNvbnN0IGNvdW50ID0gcmF0aW9zLmxlbmd0aDtcblxuXHRcdGxldCBkaW1lbnNpb25zO1xuXG5cdFx0aWYgKCFmaXhlZFJhdGlvKSB7XG5cdFx0XHRkaW1lbnNpb25zID0gdGhpcy5nZXRCZXN0RGltZW5zaW9ucyhtaW5SYXRpbywgbWF4UmF0aW8sIGNvbnRhaW5lcldpZHRoLCBjb250YWluZXJIZWlnaHQsIGNvdW50LCBtYXhXaWR0aCwgbWF4SGVpZ2h0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gVXNlIHRoZSByYXRpbyBvZiB0aGUgZmlyc3QgdmlkZW8gZWxlbWVudCB3ZSBmaW5kIHRvIGFwcHJveGltYXRlXG5cdFx0XHRjb25zdCByYXRpbyA9IHJhdGlvcy5sZW5ndGggPiAwID8gcmF0aW9zWzBdIDogbnVsbDtcblx0XHRcdGRpbWVuc2lvbnMgPSB0aGlzLmdldEJlc3REaW1lbnNpb25zKHJhdGlvLCByYXRpbywgY29udGFpbmVyV2lkdGgsIGNvbnRhaW5lckhlaWdodCwgY291bnQsIG1heFdpZHRoLCBtYXhIZWlnaHQpO1xuXHRcdH1cblxuXHRcdC8vIExvb3AgdGhyb3VnaCBlYWNoIHN0cmVhbSBpbiB0aGUgY29udGFpbmVyIGFuZCBwbGFjZSBpdCBpbnNpZGVcblx0XHRsZXQgeCA9IDA7XG5cdFx0bGV0IHkgPSAwO1xuXHRcdGNvbnN0IHJvd3MgPSBbXTtcblx0XHRsZXQgcm93O1xuXHRcdGNvbnN0IGJveGVzID0gW107XG5cblx0XHQvLyBJdGVyYXRlIHRocm91Z2ggdGhlIGNoaWxkcmVuIGFuZCBjcmVhdGUgYW4gYXJyYXkgd2l0aCBhIG5ldyBpdGVtIGZvciBlYWNoIHJvd1xuXHRcdC8vIGFuZCBjYWxjdWxhdGUgdGhlIHdpZHRoIG9mIGVhY2ggcm93IHNvIHRoYXQgd2Uga25vdyBpZiB3ZSBnbyBvdmVyIHRoZSBzaXplIGFuZCBuZWVkXG5cdFx0Ly8gdG8gYWRqdXN0XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCByYXRpb3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdGlmIChpICUgZGltZW5zaW9ucy50YXJnZXRDb2xzID09PSAwKSB7XG5cdFx0XHRcdC8vIFRoaXMgaXMgYSBuZXcgcm93XG5cdFx0XHRcdHJvdyA9IHtcblx0XHRcdFx0XHRyYXRpb3M6IFtdLFxuXHRcdFx0XHRcdHdpZHRoOiAwLFxuXHRcdFx0XHRcdGhlaWdodDogMFxuXHRcdFx0XHR9O1xuXHRcdFx0XHRyb3dzLnB1c2gocm93KTtcblx0XHRcdH1cblx0XHRcdGNvbnN0IHJhdGlvID0gcmF0aW9zW2ldO1xuXHRcdFx0cm93LnJhdGlvcy5wdXNoKHJhdGlvKTtcblx0XHRcdGxldCB0YXJnZXRXaWR0aCA9IGRpbWVuc2lvbnMudGFyZ2V0V2lkdGg7XG5cdFx0XHRjb25zdCB0YXJnZXRIZWlnaHQgPSBkaW1lbnNpb25zLnRhcmdldEhlaWdodDtcblx0XHRcdC8vIElmIHdlJ3JlIHVzaW5nIGEgZml4ZWRSYXRpbyB0aGVuIHdlIG5lZWQgdG8gc2V0IHRoZSBjb3JyZWN0IHJhdGlvIGZvciB0aGlzIGVsZW1lbnRcblx0XHRcdGlmIChmaXhlZFJhdGlvKSB7XG5cdFx0XHRcdHRhcmdldFdpZHRoID0gdGFyZ2V0SGVpZ2h0IC8gcmF0aW87XG5cdFx0XHR9XG5cdFx0XHRyb3cud2lkdGggKz0gdGFyZ2V0V2lkdGg7XG5cdFx0XHRyb3cuaGVpZ2h0ID0gdGFyZ2V0SGVpZ2h0O1xuXHRcdH1cblx0XHQvLyBDYWxjdWxhdGUgdG90YWwgcm93IGhlaWdodCBhZGp1c3RpbmcgaWYgd2UgZ28gdG9vIHdpZGVcblx0XHRsZXQgdG90YWxSb3dIZWlnaHQgPSAwO1xuXHRcdGxldCByZW1haW5pbmdTaG9ydFJvd3MgPSAwO1xuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0cm93ID0gcm93c1tpXTtcblx0XHRcdGlmIChyb3cud2lkdGggPiBjb250YWluZXJXaWR0aCkge1xuXHRcdFx0XHQvLyBXZW50IG92ZXIgb24gdGhlIHdpZHRoLCBuZWVkIHRvIGFkanVzdCB0aGUgaGVpZ2h0IHByb3BvcnRpb25hbGx5XG5cdFx0XHRcdHJvdy5oZWlnaHQgPSBNYXRoLmZsb29yKHJvdy5oZWlnaHQgKiAoY29udGFpbmVyV2lkdGggLyByb3cud2lkdGgpKTtcblx0XHRcdFx0cm93LndpZHRoID0gY29udGFpbmVyV2lkdGg7XG5cdFx0XHR9IGVsc2UgaWYgKHJvdy53aWR0aCA8IGNvbnRhaW5lcldpZHRoICYmIHJvdy5oZWlnaHQgPCBtYXhIZWlnaHQpIHtcblx0XHRcdFx0cmVtYWluaW5nU2hvcnRSb3dzICs9IDE7XG5cdFx0XHR9XG5cdFx0XHR0b3RhbFJvd0hlaWdodCArPSByb3cuaGVpZ2h0O1xuXHRcdH1cblx0XHRpZiAoc2NhbGVMYXN0Um93ICYmIHRvdGFsUm93SGVpZ2h0IDwgY29udGFpbmVySGVpZ2h0ICYmIHJlbWFpbmluZ1Nob3J0Um93cyA+IDApIHtcblx0XHRcdC8vIFdlIGNhbiBncm93IHNvbWUgb2YgdGhlIHJvd3MsIHdlJ3JlIG5vdCB0YWtpbmcgdXAgdGhlIHdob2xlIGhlaWdodFxuXHRcdFx0bGV0IHJlbWFpbmluZ0hlaWdodERpZmYgPSBjb250YWluZXJIZWlnaHQgLSB0b3RhbFJvd0hlaWdodDtcblx0XHRcdHRvdGFsUm93SGVpZ2h0ID0gMDtcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRyb3cgPSByb3dzW2ldO1xuXHRcdFx0XHRpZiAocm93LndpZHRoIDwgY29udGFpbmVyV2lkdGgpIHtcblx0XHRcdFx0XHQvLyBFdmVubHkgZGlzdHJpYnV0ZSB0aGUgZXh0cmEgaGVpZ2h0IGJldHdlZW4gdGhlIHNob3J0IHJvd3Ncblx0XHRcdFx0XHRsZXQgZXh0cmFIZWlnaHQgPSByZW1haW5pbmdIZWlnaHREaWZmIC8gcmVtYWluaW5nU2hvcnRSb3dzO1xuXHRcdFx0XHRcdGlmIChleHRyYUhlaWdodCAvIHJvdy5oZWlnaHQgPiAoY29udGFpbmVyV2lkdGggLSByb3cud2lkdGgpIC8gcm93LndpZHRoKSB7XG5cdFx0XHRcdFx0XHQvLyBXZSBjYW4ndCBnbyB0aGF0IGJpZyBvciB3ZSdsbCBnbyB0b28gd2lkZVxuXHRcdFx0XHRcdFx0ZXh0cmFIZWlnaHQgPSBNYXRoLmZsb29yKCgoY29udGFpbmVyV2lkdGggLSByb3cud2lkdGgpIC8gcm93LndpZHRoKSAqIHJvdy5oZWlnaHQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyb3cud2lkdGggKz0gTWF0aC5mbG9vcigoZXh0cmFIZWlnaHQgLyByb3cuaGVpZ2h0KSAqIHJvdy53aWR0aCk7XG5cdFx0XHRcdFx0cm93LmhlaWdodCArPSBleHRyYUhlaWdodDtcblx0XHRcdFx0XHRyZW1haW5pbmdIZWlnaHREaWZmIC09IGV4dHJhSGVpZ2h0O1xuXHRcdFx0XHRcdHJlbWFpbmluZ1Nob3J0Um93cyAtPSAxO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRvdGFsUm93SGVpZ2h0ICs9IHJvdy5oZWlnaHQ7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdC8vIHZlcnRpY2FsIGNlbnRlcmluZ1xuXHRcdHN3aXRjaCAoYWxpZ25JdGVtcykge1xuXHRcdFx0Y2FzZSAnc3RhcnQnOlxuXHRcdFx0XHR5ID0gMDtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdlbmQnOlxuXHRcdFx0XHR5ID0gY29udGFpbmVySGVpZ2h0IC0gdG90YWxSb3dIZWlnaHQ7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnY2VudGVyJzpcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHkgPSAoY29udGFpbmVySGVpZ2h0IC0gdG90YWxSb3dIZWlnaHQpIC8gMjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHRcdC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIHJvdyBhbmQgcGxhY2UgZWFjaCBjaGlsZFxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0cm93ID0gcm93c1tpXTtcblx0XHRcdGxldCByb3dNYXJnaW5MZWZ0O1xuXHRcdFx0c3dpdGNoIChhbGlnbkl0ZW1zKSB7XG5cdFx0XHRcdGNhc2UgJ3N0YXJ0Jzpcblx0XHRcdFx0XHRyb3dNYXJnaW5MZWZ0ID0gMDtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSAnZW5kJzpcblx0XHRcdFx0XHRyb3dNYXJnaW5MZWZ0ID0gY29udGFpbmVyV2lkdGggLSByb3cud2lkdGg7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgJ2NlbnRlcic6XG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0cm93TWFyZ2luTGVmdCA9IChjb250YWluZXJXaWR0aCAtIHJvdy53aWR0aCkgLyAyO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdFx0eCA9IHJvd01hcmdpbkxlZnQ7XG5cdFx0XHRsZXQgdGFyZ2V0SGVpZ2h0O1xuXHRcdFx0Zm9yIChsZXQgaiA9IDA7IGogPCByb3cucmF0aW9zLmxlbmd0aDsgaisrKSB7XG5cdFx0XHRcdGNvbnN0IHJhdGlvID0gcm93LnJhdGlvc1tqXTtcblxuXHRcdFx0XHRsZXQgdGFyZ2V0V2lkdGggPSBkaW1lbnNpb25zLnRhcmdldFdpZHRoO1xuXHRcdFx0XHR0YXJnZXRIZWlnaHQgPSByb3cuaGVpZ2h0O1xuXHRcdFx0XHQvLyBJZiB3ZSdyZSB1c2luZyBhIGZpeGVkUmF0aW8gdGhlbiB3ZSBuZWVkIHRvIHNldCB0aGUgY29ycmVjdCByYXRpbyBmb3IgdGhpcyBlbGVtZW50XG5cdFx0XHRcdGlmIChmaXhlZFJhdGlvKSB7XG5cdFx0XHRcdFx0dGFyZ2V0V2lkdGggPSBNYXRoLmZsb29yKHRhcmdldEhlaWdodCAvIHJhdGlvKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0YXJnZXRIZWlnaHQgLyB0YXJnZXRXaWR0aCAhPT0gZGltZW5zaW9ucy50YXJnZXRIZWlnaHQgLyBkaW1lbnNpb25zLnRhcmdldFdpZHRoKSB7XG5cdFx0XHRcdFx0Ly8gV2UgZ3JldyB0aGlzIHJvdywgd2UgbmVlZCB0byBhZGp1c3QgdGhlIHdpZHRoIHRvIGFjY291bnQgZm9yIHRoZSBpbmNyZWFzZSBpbiBoZWlnaHRcblx0XHRcdFx0XHR0YXJnZXRXaWR0aCA9IE1hdGguZmxvb3IoKGRpbWVuc2lvbnMudGFyZ2V0V2lkdGggLyBkaW1lbnNpb25zLnRhcmdldEhlaWdodCkgKiB0YXJnZXRIZWlnaHQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ym94ZXMucHVzaCh7XG5cdFx0XHRcdFx0bGVmdDogeCArIG9mZnNldExlZnQsXG5cdFx0XHRcdFx0dG9wOiB5ICsgb2Zmc2V0VG9wLFxuXHRcdFx0XHRcdHdpZHRoOiB0YXJnZXRXaWR0aCxcblx0XHRcdFx0XHRoZWlnaHQ6IHRhcmdldEhlaWdodFxuXHRcdFx0XHR9KTtcblx0XHRcdFx0eCArPSB0YXJnZXRXaWR0aDtcblx0XHRcdH1cblx0XHRcdHkgKz0gdGFyZ2V0SGVpZ2h0O1xuXHRcdH1cblx0XHRyZXR1cm4gYm94ZXM7XG5cdH1cbn1cbiJdfQ==